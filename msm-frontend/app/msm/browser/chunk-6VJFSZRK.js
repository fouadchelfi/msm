import{a as Y}from"./chunk-O36OTMU2.js";import{$a as Se,A as u,Aa as pe,Ab as Oe,B as d,Ba as fe,Bb as Ae,C as l,Ca as he,Cb as Ne,D as r,Da as K,Db as Re,E as p,Ea as y,Eb as U,F as C,Fa as O,G as v,Ga as A,H as S,Ha as N,I as h,Ia as ge,J as f,Ja as R,K as E,Ka as mt,L as k,La as ct,M as G,Ma as H,N as se,Na as _e,Nb as He,O as s,Oa as ye,Ob as X,P as I,Pa as xe,Q as V,Qa as L,Ra as be,Ta as Q,U as ot,Ua as z,Ub as Le,Va as $,W as lt,Wa as j,Xa as Z,Ya as Ce,Z as de,Za as ve,_ as q,a as W,aa as at,ab as st,bb as $e,bc as Qe,cb as Ie,d as ie,db as M,e as ne,ec as pt,f as rt,fb as ee,g as re,gc as ft,h as oe,ib as Fe,j as le,jb as we,k as ae,kb as Ee,lb as P,n as me,nb as dt,ob as ut,p as B,pa as ze,q as ce,r as x,s as b,sb as ke,tb as Ge,ub as Te,v as c,vb as Me,w as _,wb as Be,xb as Ve,y as J,ya as D,yb as qe,za as ue,zb as De}from"./chunk-J3ZMDLLJ.js";var xt=["firstFocused"];function bt(t,a){if(t&1&&p(0,"my-global-errors",18),t&2){let o=f();d("errors",o.errors)}}function Ct(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}var et=(()=>{let a=class a{constructor(e,n,i,m,g){this.fb=e,this.dialogRef=n,this.data=i,this.ingredientsHttp=m,this.snackBar=g,this.errors=[],this.ingredientFormGroup=this.fb.group({id:[void 0],label:["",[y.required]],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(e){this.ingredientsHttp.getOneById(e).subscribe({next:n=>{this.ingredientFormGroup.patchValue({id:n.id,label:n.label,notes:n.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.ingredientFormGroup.valid==!0?this.data.mode=="creation"?this.ingredientsHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.ingredientsHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.ingredientFormGroup.markAllAsTouched()}resetForm(){this.ingredientFormGroup.reset({id:void 0,label:"",notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.ingredientFormGroup.markAsUntouched(),this.ingredientFormGroup.clearValidators(),this.ingredientFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return W({},this.ingredientFormGroup.getRawValue())}getUpdate(){return W({},this.ingredientFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};a.\u0275fac=function(n){return new(n||a)(_(L),_(Fe),_(we),_(X),_(P))},a.\u0275cmp=B({type:a,selectors:[["app-ingredient-form"]],viewQuery:function(n,i){if(n&1&&E(xt,5),n&2){let m;k(m=G())&&(i.firstFocused=m.first)}},decls:25,vars:5,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3","h-64",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"w-80"],[3,"required"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"]],template:function(n,i){if(n&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),s(3),r(),l(4,"button",3),h("click",function(){return i.closeDialog()}),p(5,"i",4),r()(),u(6,bt,1,1,"my-global-errors",5),l(7,"div",6)(8,"form",7),p(9,"input",8),l(10,"my-form-field",9)(11,"my-label",10),s(12,"Libell\xE9"),r(),p(13,"input",11,12),u(15,Ct,2,0,"my-error",13),r(),l(16,"my-form-field",9)(17,"my-label"),s(18,"Notes"),r(),p(19,"textarea",14),r()()(),l(20,"div",15)(21,"button",16),h("click",function(){return i.create()}),s(22,"Nouvelle "),r(),l(23,"button",17),h("click",function(){return i.save()}),s(24,"Sauvegarder"),r()()()),n&2){let m;c(3),V(" ",i.data.mode=="creation"?"Nouveau":"Modifier"," ingr\xE9dient "),c(3),d("ngIf",i.errors.length>0),c(2),d("formGroup",i.ingredientFormGroup),c(3),d("required",!0),c(4),d("ngIf",((m=i.ingredientFormGroup.get("label"))==null?null:m.invalid)&&(((m=i.ingredientFormGroup.get("label"))==null?null:m.dirty)||((m=i.ingredientFormGroup.get("label"))==null?null:m.touched))&&((m=i.ingredientFormGroup.get("label"))==null?null:m.getError("required")))}},dependencies:[q,N,K,ge,O,A,R,H,D,j,Ce,z,$,Z,ve],encapsulation:2});let t=a;return t})();var kt=["firstFocused"];function Gt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function Tt(t,a){if(t&1){let o=S();l(0,"div",29)(1,"div",30)(2,"span"),s(3,"Filtrer"),r(),l(4,"button",31),h("click",function(){x(o);let n=f();return b(n.toggleFilterMenu())}),p(5,"i",32),r()(),l(6,"form",33)(7,"my-form-field")(8,"my-label"),s(9,"Libell\xE9 *"),r(),p(10,"input",34,35),u(12,Gt,2,0,"my-error",36),r()(),l(13,"div",37)(14,"button",38),h("click",function(){x(o);let n=f();return b(n.resetItemsFilterForm())}),s(15,"R\xE9initialiser"),r(),l(16,"button",11),h("click",function(){x(o);let n=f();return b(n.filterItems())}),s(17,"Appliquer"),r()()()}if(t&2){let o=f(),e;c(6),d("formGroup",o.ingredientFilterFormGroup),c(6),d("ngIf",((e=o.ingredientFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=o.ingredientFilterFormGroup.get("label"))==null?null:e.dirty)||((e=o.ingredientFilterFormGroup.get("label"))==null?null:e.touched))&&((e=o.ingredientFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function Mt(t,a){if(t&1){let o=S();l(0,"button",39),h("click",function(){x(o);let n=f();return b(n.deleteSeleted())}),l(1,"div",40),p(2,"i",41),l(3,"span"),s(4),r()()()}if(t&2){let o=f();c(4),V("Supprimer (",o.selection.selected.length,")")}}function Bt(t,a){if(t&1){let o=S();l(0,"th",42)(1,"mat-checkbox",43),h("change",function(n){x(o);let i=f();return b(i.allSelectionChanged(n))}),r()()}if(t&2){let o=f();c(),d("checked",o.selection.hasValue()&&o.isAllSelected())("indeterminate",o.selection.hasValue()&&!o.isAllSelected())("aria-label",o.checkboxLabel())}}function Vt(t,a){if(t&1){let o=S();l(0,"td",44)(1,"mat-checkbox",45),h("click",function(n){return n.stopPropagation()})("change",function(n){let m=x(o).$implicit,g=f();return b(g.selectionChanged(n,m))}),r()()}if(t&2){let o=a.$implicit,e=f();c(),d("checked",e.selection.isSelected(o))("aria-label",e.checkboxLabel(o))}}function qt(t,a){t&1&&(l(0,"th",42),s(1,"Code "),r())}function Dt(t,a){if(t&1&&(l(0,"td",44),s(1),r()),t&2){let o=a.$implicit;c(),I(o.code)}}function Ot(t,a){t&1&&(l(0,"th",42),s(1,"Libell\xE9 "),r())}function At(t,a){if(t&1&&(l(0,"td",44),s(1),r()),t&2){let o=a.$implicit;c(),I(o.label)}}function Nt(t,a){t&1&&(l(0,"th",42),s(1,"Notes"),r())}function Rt(t,a){if(t&1&&(l(0,"td",44),s(1),r()),t&2){let o=a.$implicit;c(),I(o.notes)}}function Ht(t,a){t&1&&(l(0,"th",46),s(1,"Action"),r())}function Lt(t,a){if(t&1){let o=S();l(0,"td",44)(1,"div",47)(2,"button",48),p(3,"i",49),r(),l(4,"button",50),h("click",function(){let i=x(o).$implicit,m=f();return b(m.deleteItem(i))}),p(5,"i",51),r(),l(6,"button",50),h("click",function(){let i=x(o).$implicit,m=f();return b(m.newItem("edit",i.id))}),p(7,"i",52),r()()()}if(t&2){let o=a.$implicit,e=f();c(2),d("matTooltip",e.getTracabilityInfo(o))}}function Qt(t,a){t&1&&p(0,"tr",53)}function zt(t,a){if(t&1){let o=S();l(0,"tr",54),h("dblclick",function(){let i=x(o).$implicit,m=f();return b(m.newItem("edit",i.id))}),r()}}function $t(t,a){t&1&&(l(0,"div",55)(1,"p",56),s(2,"Aucune donn\xE9e \xE0 afficher"),r()())}var tt=(()=>{let a=class a{isAllSelected(){let e=this.selection.selected.length,n=this.dataSource.data.length;return e===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,n,i,m,g){this.ingredientsHttp=e,this.snackBar=n,this.fb=i,this.matDialog=m,this.traceability=g,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","notes","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new J,this.ingredientFilterChanged=new J,this.pageSize=Y.pagination.pageSize,this.ingredients=[],this.selection=new pe(!0,[]),this.showFirstLastButtons=Y.pagination.showFirstLastButtons,this.ingredientFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),re(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.ingredientFilterChanged).pipe(le({}),ae(()=>(this.isLoadingResults=!0,this.ingredientsHttp.paginate(this.getFilterQuery).pipe(oe(()=>ie(null))))),ne(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,Ie(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",n=0){this.matDialog.open(et,{data:{id:n,mode:e},disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.ingredientFilterChanged.emit()}resetItemsFilterForm(){this.ingredientFilterFormGroup.reset({label:""}),this.ingredientFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,n){e&&this.selection.toggle(n)}deleteMany(e){let n=new URLSearchParams;e.forEach(m=>{n.append("id",m.id.toString())});let i=`?${n.toString()}`;this.ingredientsHttp.deleteMany(i).subscribe({next:m=>{m.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:m=>this.snackBar.open(m.message)})}get getFilterQuery(){let e=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.ingredientFilterFormGroup.get("label")?.value};return M(n.pageIndex)&&e.append("pageIndex",n.pageIndex.toString()),M(n.pageSize)&&e.append("pageSize",n.pageSize.toString()),e.append("order","DESC"),M(n.label)&&e.append("label",n.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};a.\u0275fac=function(n){return new(n||a)(_(X),_(P),_(L),_(Ee),_(Se))},a.\u0275cmp=B({type:a,selectors:[["app-ingredients-grid"]],viewQuery:function(n,i){if(n&1&&(E(Q,5),E(U,5),E(kt,5)),n&2){let m;k(m=G())&&(i.paginator=m.first),k(m=G())&&(i.sort=m.first),k(m=G())&&(i.firstFocused=m.first)}},decls:42,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,i){if(n&1&&(l(0,"div",0)(1,"div",1)(2,"h3"),s(3,"Production / Ingredients"),r()(),l(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),l(8,"div",6),p(9,"i",7),l(10,"span"),s(11,"FILTRE"),r()()(),u(12,Tt,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),r(),l(13,"div",9),u(14,Mt,5,1,"button",10),l(15,"button",11),h("click",function(){return i.newItem()}),l(16,"div",12),p(17,"i",13),l(18,"span",14),s(19,"Ingr\xE9dient"),r()()()()(),l(20,"div")(21,"div",15)(22,"table",16),C(23,17),u(24,Bt,2,3,"th",18)(25,Vt,2,2,"td",19),v(),C(26,20),u(27,qt,2,0,"th",18)(28,Dt,2,1,"td",19),v(),C(29,21),u(30,Ot,2,0,"th",18)(31,At,2,1,"td",19),v(),C(32,22),u(33,Nt,2,0,"th",18)(34,Rt,2,1,"td",19),v(),C(35,23),u(36,Ht,2,0,"th",24)(37,Lt,8,1,"td",19),v(),u(38,Qt,1,0,"tr",25)(39,zt,1,0,"tr",26),r(),u(40,$t,3,0,"div",27),r(),p(41,"mat-paginator",28),r()()),n&2){let m=se(7);c(12),d("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),d("ngIf",i.selection.selected.length>0),c(8),d("dataSource",i.dataSource),c(16),d("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),d("matRowDefColumns",i.displayedColumns),c(),d("ngIf",i.dataSource.data.length==0),c(),d("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[q,N,K,O,A,R,H,be,D,ue,ke,Ge,Me,De,Be,Te,Oe,Ve,qe,Ae,Ne,Q,U,he,fe,j,z,$,Z],styles:[`app-ingredients-grid{display:flex;flex:1}
`],encapsulation:2});let t=a;return t})();var jt=["firstFocused"];function Pt(t,a){if(t&1&&p(0,"my-global-errors",38),t&2){let o=f();d("errors",o.errors)}}function Ut(t,a){if(t&1&&(C(0),l(1,"option",39),s(2),r(),v()),t&2){let o=a.$implicit;c(),d("value",o.id),c(),I(o.label)}}function Wt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function Jt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function Kt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function Zt(t,a){if(t&1&&(C(0),l(1,"option",39),s(2),r(),v()),t&2){let o=a.$implicit,e=f();c(),d("value",o.id),c(),I(e.getStockInfo(o))}}function Xt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function Yt(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function ei(t,a){if(t&1&&(C(0),l(1,"option",39),s(2),r(),v()),t&2){let o=a.$implicit,e=f(2);c(),d("value",o.id),c(),I(e.getStockInfo(o))}}function ti(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function ii(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function ni(t,a){t&1&&(l(0,"div",50)(1,"div",51),p(2,"div",52),r()())}function ri(t,a){if(t&1){let o=S();l(0,"button",53),h("click",function(){x(o);let n=f().index,i=f();return b(i.removeItem(n))}),p(1,"i",54),r()}}function oi(t,a){if(t&1){let o=S();l(0,"button",53),h("click",function(){x(o);let n=f().index,i=f();return b(i.recoverItem(n))}),p(1,"i",55),r()}}function li(t,a){if(t&1&&(l(0,"div",40)(1,"div",41),p(2,"input",8)(3,"input",42)(4,"input",43),l(5,"my-form-field",44)(6,"my-label",13),s(7,"Stock"),r(),l(8,"select",45),u(9,ei,3,2,"ng-container",15),r()(),l(10,"my-form-field",46)(11,"my-label",13),s(12,"Quantit\xE9"),r(),p(13,"input",23),u(14,ti,2,0,"my-error",16),r(),l(15,"my-form-field",46)(16,"my-label",13),s(17,"Montant"),r(),p(18,"input",47),u(19,ii,2,0,"my-error",16),r(),u(20,ni,3,0,"div",48),r(),u(21,ri,2,0,"button",49)(22,oi,2,0,"button",49),r()),t&2){let o=a.$implicit,e=a.index,n=f(),i,m,g,F,w;d("formGroupName",e),c(6),d("required",!0),c(3),d("ngForOf",n.stocks),c(2),d("required",!0),c(3),d("ngIf",((i=o.get("quantity"))==null?null:i.invalid)&&(((i=o.get("quantity"))==null?null:i.dirty)||((i=o.get("quantity"))==null?null:i.touched))&&((i=o.get("quantity"))==null?null:i.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((m=o.get("amount"))==null?null:m.invalid)&&(((m=o.get("amount"))==null?null:m.dirty)||((m=o.get("amount"))==null?null:m.touched))&&((m=o.get("amount"))==null?null:m.getError("required"))),c(),d("ngIf",((g=o.get("mode"))==null?null:g.value)=="deletion"),c(),d("ngIf",((F=o.get("mode"))==null?null:F.value)!="deletion"),c(),d("ngIf",((w=o.get("mode"))==null?null:w.value)=="deletion")}}function ai(t,a){if(t&1&&(C(0),l(1,"option",39),s(2),r(),v()),t&2){let o=a.$implicit;c(),d("value",o.id),c(),I(o.label)}}function mi(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function ci(t,a){t&1&&(l(0,"my-error"),s(1," Veuillez remplir ce champ. "),r())}function si(t,a){t&1&&(l(0,"div",50)(1,"div",51),p(2,"div",52),r()())}function di(t,a){if(t&1){let o=S();l(0,"button",53),h("click",function(){x(o);let n=f().index,i=f();return b(i.removeIngredient(n))}),p(1,"i",54),r()}}function ui(t,a){if(t&1){let o=S();l(0,"button",53),h("click",function(){x(o);let n=f().index,i=f();return b(i.recoverIngredient(n))}),p(1,"i",55),r()}}function pi(t,a){if(t&1&&(l(0,"div",40)(1,"div",41),p(2,"input",8)(3,"input",42)(4,"input",43),l(5,"my-form-field",56)(6,"my-label",13),s(7,"Ingr\xE9dient"),r(),l(8,"select",57),u(9,ai,3,2,"ng-container",15),r()(),l(10,"my-form-field",46)(11,"my-label",13),s(12,"Quantit\xE9"),r(),p(13,"input",23),u(14,mi,2,0,"my-error",16),r(),l(15,"my-form-field",46)(16,"my-label",13),s(17,"Montant"),r(),p(18,"input",47),u(19,ci,2,0,"my-error",16),r(),u(20,si,3,0,"div",48),r(),u(21,di,2,0,"button",49)(22,ui,2,0,"button",49),r()),t&2){let o=a.$implicit,e=a.index,n=f(),i,m,g,F,w;d("formGroupName",e),c(6),d("required",!0),c(3),d("ngForOf",n.ingredientsArr),c(2),d("required",!0),c(3),d("ngIf",((i=o.get("quantity"))==null?null:i.invalid)&&(((i=o.get("quantity"))==null?null:i.dirty)||((i=o.get("quantity"))==null?null:i.touched))&&((i=o.get("quantity"))==null?null:i.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((m=o.get("amount"))==null?null:m.invalid)&&(((m=o.get("amount"))==null?null:m.dirty)||((m=o.get("amount"))==null?null:m.touched))&&((m=o.get("amount"))==null?null:m.getError("required"))),c(),d("ngIf",((g=o.get("mode"))==null?null:g.value)=="deletion"),c(),d("ngIf",((F=o.get("mode"))==null?null:F.value)!="deletion"),c(),d("ngIf",((w=o.get("mode"))==null?null:w.value)=="deletion")}}var it=(()=>{let a=class a{get items(){return this.batchFormGroup.get("items")}get ingredients(){return this.batchFormGroup.get("ingredients")}constructor(e,n,i,m,g,F,w,T){this.fb=e,this.dialogRef=n,this.data=i,this.snackBar=m,this.batchesHttp=g,this.moneySourcesHttp=F,this.stocksHttp=w,this.ingredientsHttp=T,this.errors=[],this.moneySources=[],this.stocks=[],this.ingredientsArr=[],this.batchFormGroup=this.fb.group({id:[void 0],code:[""],totalQuantity:[{value:0,disabled:!0},[y.required]],quantity:[0,[y.required]],totalAmount:[{value:0,disabled:!0},[y.required]],moneySourceId:[void 0,[y.required]],productId:[void 0,[y.required]],date:[$e(),[y.required]],notes:[""],items:this.fb.array([]),ingredients:this.fb.array([])})}ngOnInit(){rt([this.moneySourcesHttp.getAll(),this.stocksHttp.getAll(),this.ingredientsHttp.getAll()]).subscribe({next:([e,n,i])=>{this.moneySources=e,this.stocks=n,this.ingredientsArr=i,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChaged()}loadData(e){this.batchesHttp.getOneById(e).subscribe({next:n=>{this.batchFormGroup.patchValue({id:n.id,code:n.code,quantity:n.quantity,totalQuantity:n.totalQuantity,totalAmount:n.totalAmount,moneySourceId:n.moneySourceId.id,productId:n.productId.id,date:st(n.date),notes:n.notes}),this.items.clear(),this.ingredients.clear(),n.items.forEach(i=>{this.items.push(this.fb.group({id:[i.id],stockId:[i.stockId.id,[y.required]],quantity:[i.quantity,[y.required]],amount:[{value:i.amount,disabled:!0},[y.required]],mode:["update",[y.required]],oldMode:["update",[y.required]]}))}),n.ingredients.forEach(i=>{this.ingredients.push(this.fb.group({id:[i.id],ingredientId:[i.ingredientId.id,[y.required]],quantity:[i.quantity,[y.required]],amount:[{value:i.amount,disabled:!0},[y.required]],mode:["update",[y.required]],oldMode:["update",[y.required]]}))})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.batchFormGroup.valid==!0?this.data.mode=="creation"?this.batchesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.batchesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.batchFormGroup.markAllAsTouched()}resetForm(){this.batchFormGroup.reset({id:void 0,code:"",quantity:0,totalQuantity:0,totalAmount:0,moneySourceId:0,productId:0,date:$e(),notes:""},{emitEvent:!1}),this.items.clear(),this.ingredients.clear()}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.batchFormGroup.markAsUntouched(),this.batchFormGroup.clearValidators(),this.batchFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return W({},this.batchFormGroup.getRawValue())}getUpdate(){return W({},this.batchFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}createItem(){this.items.push(this.fb.group({id:[void 0],stockId:[void 0,[y.required]],quantity:[0,[y.required]],amount:[0,[y.required]],mode:["creation",[y.required]],oldMode:["creation",[y.required]]}))}removeItem(e){this.data.mode=="edit"?this.items.at(e).get("mode")?.setValue("deletion"):this.items.removeAt(e)}recoverItem(e){let n=this.items.at(e).get("oldMode")?.value;this.items.at(e).get("mode")?.setValue(n)}createIngredient(){this.ingredients.push(this.fb.group({id:[void 0],ingredientId:[void 0,[y.required]],quantity:[0,[y.required]],amount:[0,[y.required]],mode:["creation",[y.required]],oldMode:["creation",[y.required]]}))}removeIngredient(e){this.data.mode=="edit"?this.ingredients.at(e).get("mode")?.setValue("deletion"):this.ingredients.removeAt(e)}recoverIngredient(e){let n=this.items.at(e).get("oldMode")?.value;this.items.at(e).get("mode")?.setValue(n)}getStockInfo(e){return`${e.label} - ${e.categoryId?.label} - ${e.familyId?.label} *** Un stock avec une Quantit\xE9 de ${e.quantity} KG`}handleFormChaged(){this.batchFormGroup.valueChanges.subscribe({next:e=>{let n=0,i=0;e.items.forEach((m,g)=>{n+=ee(m.quantity),i+=ee(this.items.at(g).get("amount")?.value)}),e.ingredients.forEach((m,g)=>{n+=ee(m.quantity),i+=ee(this.ingredients.at(g).get("amount")?.value)}),this.batchFormGroup.get("totalQuantity")?.setValue(n,{emitEvent:!1}),this.batchFormGroup.get("totalAmount")?.setValue(i,{emitEvent:!1})}})}};a.\u0275fac=function(n){return new(n||a)(_(L),_(Fe),_(we),_(P),_(Qe),_(Le),_(He),_(X))},a.\u0275cmp=B({type:a,selectors:[["app-batch-form"]],viewQuery:function(n,i){if(n&1&&E(jt,5),n&2){let m;k(m=G())&&(i.firstFocused=m.first)}},decls:72,vars:17,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2","w-96"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],[3,"required"],["formControlName","moneySourceId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"flex","flex-col","gap-y-2","w-64"],["formControlName","totalQuantity","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"flex","flex-col","gap-y-2"],[1,"w-64"],["formControlName","productId","myInput","","size","small"],["formControlName","quantity","type","number","myInput","","size","small"],[1,"!-mt-1"],["formControlName","notes","myTextarea","","type","text"],["dynamicHeight","","animationDuration","0ms"],["label","Stocks"],["formArrayName","items",1,"!mt-5"],[1,"flex","flex-col","mt-2"],["class","flex flex-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",1,"mt-2",3,"click"],[1,"ri-add-line","text-lg"],["label","Ingr\xE9dients"],["formArrayName","ingredients",1,"!mt-5"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"],[1,"flex","flex-row",3,"formGroupName"],[1,"relative","flex","flex-row","gap-x-2"],["formControlName","mode","type","text",1,"!hidden"],["formControlName","oldMode","type","text",1,"!hidden"],[1,"w-[450px]"],["formControlName","stockId","myInput","","size","small"],[1,"w-48"],["formControlName","amount","type","number","myInput","","size","small"],["class","absolute w-full h-full",4,"ngIf"],["class","mx-3 mt-2",3,"click",4,"ngIf"],[1,"absolute","w-full","h-full"],[1,"relative","h-full","bg-[rgba(255,0,0,0.05)]"],[1,"absolute","w-full","my-auto","top-0","bottom-0","h-[0.06rem]","bg-red-500"],[1,"mx-3","mt-2",3,"click"],[1,"ri-delete-bin-6-line","text-lg","text-red-500"],[1,"ri-device-recover-line","text-lg","text-blue-500"],[1,"w-[400px]"],["formControlName","ingredientId","myInput","","size","small"]],template:function(n,i){if(n&1&&(l(0,"div",0)(1,"div",1)(2,"div",2),s(3),r(),l(4,"button",3),h("click",function(){return i.closeDialog()}),p(5,"i",4),r()(),u(6,Pt,1,1,"my-global-errors",5),l(7,"div",6)(8,"form",7),p(9,"input",8),l(10,"div",9)(11,"div",10)(12,"my-form-field")(13,"my-label"),s(14,"Code"),r(),p(15,"input",11,12),r(),l(17,"my-form-field")(18,"my-label",13),s(19,"Source d'argent"),r(),l(20,"select",14),u(21,Ut,3,2,"ng-container",15),r(),u(22,Wt,2,0,"my-error",16),r()(),l(23,"div",17)(24,"my-form-field")(25,"my-label",13),s(26,"Quantit\xE9 totale"),r(),p(27,"input",18),u(28,Jt,2,0,"my-error",16),r(),l(29,"my-form-field")(30,"my-label",13),s(31,"Montant total"),r(),p(32,"input",19),u(33,Kt,2,0,"my-error",16),r()(),l(34,"div",20)(35,"my-form-field",21)(36,"my-label",13),s(37,"Produit"),r(),l(38,"select",22),u(39,Zt,3,2,"ng-container",15),r(),u(40,Xt,2,0,"my-error",16),r(),l(41,"my-form-field")(42,"my-label",13),s(43,"Quantit\xE9 produite"),r(),p(44,"input",23),u(45,Yt,2,0,"my-error",16),r()(),l(46,"my-form-field",24)(47,"my-label"),s(48,"Notes"),r(),p(49,"textarea",25),r()(),l(50,"mat-tab-group",26)(51,"mat-tab",27)(52,"div",28)(53,"div",29),u(54,li,23,10,"div",30),r(),l(55,"button",31),h("click",function(){return i.createItem()}),p(56,"i",32),l(57,"span"),s(58,"Stock"),r()()()(),l(59,"mat-tab",33)(60,"div",34)(61,"div",29),u(62,pi,23,10,"div",30),r(),l(63,"button",31),h("click",function(){return i.createIngredient()}),p(64,"i",32),l(65,"span"),s(66,"Ingr\xE9dient"),r()()()()()()(),l(67,"div",35)(68,"button",36),h("click",function(){return i.create()}),s(69,"Nouveau "),r(),l(70,"button",37),h("click",function(){return i.save()}),s(71,"Sauvegarder"),r()()()),n&2){let m,g,F,w,T;c(3),V(" ",i.data.mode=="creation"?"Nouveau ":"Modifier "," Lot "),c(3),d("ngIf",i.errors.length>0),c(2),d("formGroup",i.batchFormGroup),c(10),d("required",!0),c(3),d("ngForOf",i.moneySources),c(),d("ngIf",((m=i.batchFormGroup.get("moneySourceId"))==null?null:m.invalid)&&(((m=i.batchFormGroup.get("moneySourceId"))==null?null:m.dirty)||((m=i.batchFormGroup.get("moneySourceId"))==null?null:m.touched))&&((m=i.batchFormGroup.get("moneySourceId"))==null?null:m.getError("required"))),c(3),d("required",!0),c(3),d("ngIf",((g=i.batchFormGroup.get("totalQuantity"))==null?null:g.invalid)&&(((g=i.batchFormGroup.get("totalQuantity"))==null?null:g.dirty)||((g=i.batchFormGroup.get("totalQuantity"))==null?null:g.touched))&&((g=i.batchFormGroup.get("totalQuantity"))==null?null:g.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((F=i.batchFormGroup.get("totalAmount"))==null?null:F.invalid)&&(((F=i.batchFormGroup.get("totalAmount"))==null?null:F.dirty)||((F=i.batchFormGroup.get("totalAmount"))==null?null:F.touched))&&((F=i.batchFormGroup.get("totalAmount"))==null?null:F.getError("required"))),c(3),d("required",!0),c(3),d("ngForOf",i.stocks),c(),d("ngIf",((w=i.batchFormGroup.get("productId"))==null?null:w.invalid)&&(((w=i.batchFormGroup.get("productId"))==null?null:w.dirty)||((w=i.batchFormGroup.get("productId"))==null?null:w.touched))&&((w=i.batchFormGroup.get("productId"))==null?null:w.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((T=i.batchFormGroup.get("quantity"))==null?null:T.invalid)&&(((T=i.batchFormGroup.get("quantity"))==null?null:T.dirty)||((T=i.batchFormGroup.get("quantity"))==null?null:T.touched))&&((T=i.batchFormGroup.get("quantity"))==null?null:T.getError("required"))),c(9),d("ngForOf",i.items.controls),c(8),d("ngForOf",i.ingredients.controls)}},dependencies:[de,q,N,ye,xe,K,ge,_e,O,A,R,H,mt,ct,D,dt,ut,j,Ce,z,$,Z,ve,pt],encapsulation:2});let t=a;return t})();var fi=["firstFocused"];function hi(t,a){if(t&1&&(C(0),l(1,"option",44),s(2),r(),v()),t&2){let o=a.$implicit;c(),d("value",o.id),c(),I(o.label)}}function gi(t,a){if(t&1&&(C(0),l(1,"option",44),s(2),r(),v()),t&2){let o=a.$implicit;c(),d("value",o.id),c(),I(o.label)}}function _i(t,a){if(t&1){let o=S();l(0,"div",33)(1,"div",34)(2,"span"),s(3,"Filtrer"),r(),l(4,"button",35),h("click",function(){x(o);let n=f();return b(n.toggleFilterMenu())}),p(5,"i",36),r()(),l(6,"form",37)(7,"my-form-field")(8,"my-label",38),s(9,"Source d'argent"),r(),l(10,"select",39),u(11,hi,3,2,"ng-container",40),r()(),l(12,"my-form-field")(13,"my-label",38),s(14,"Produit"),r(),l(15,"select",41),u(16,gi,3,2,"ng-container",40),r()()(),l(17,"div",42)(18,"button",43),h("click",function(){x(o);let n=f();return b(n.resetItemsFilterForm())}),s(19,"R\xE9initialiser"),r(),l(20,"button",11),h("click",function(){x(o);let n=f();return b(n.filterItems())}),s(21,"Appliquer"),r()()()}if(t&2){let o=f();c(6),d("formGroup",o.batchFilterFormGroup),c(2),d("required",!0),c(3),d("ngForOf",o.moneySources),c(2),d("required",!0),c(3),d("ngForOf",o.stocks)}}function yi(t,a){if(t&1){let o=S();l(0,"button",45),h("click",function(){x(o);let n=f();return b(n.deleteSeleted())}),l(1,"div",46),p(2,"i",47),l(3,"span"),s(4),r()()()}if(t&2){let o=f();c(4),V("Supprimer (",o.selection.selected.length,")")}}function xi(t,a){if(t&1){let o=S();l(0,"th",48)(1,"mat-checkbox",49),h("change",function(n){x(o);let i=f();return b(i.allSelectionChanged(n))}),r()()}if(t&2){let o=f();c(),d("checked",o.selection.hasValue()&&o.isAllSelected())("indeterminate",o.selection.hasValue()&&!o.isAllSelected())("aria-label",o.checkboxLabel())}}function bi(t,a){if(t&1){let o=S();l(0,"td",50)(1,"mat-checkbox",51),h("click",function(n){return n.stopPropagation()})("change",function(n){let m=x(o).$implicit,g=f();return b(g.selectionChanged(n,m))}),r()()}if(t&2){let o=a.$implicit,e=f();c(),d("checked",e.selection.isSelected(o))("aria-label",e.checkboxLabel(o))}}function Ci(t,a){t&1&&(l(0,"th",48),s(1,"Code "),r())}function vi(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.code)}}function Si(t,a){t&1&&(l(0,"th",48),s(1,"Produit "),r())}function Ii(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.productId.label)}}function Fi(t,a){t&1&&(l(0,"th",48),s(1,"Quantit\xE9 Produite"),r())}function wi(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.quantity)}}function Ei(t,a){t&1&&(l(0,"th",48),s(1,"Source d'argent "),r())}function ki(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.moneySourceId.label)}}function Gi(t,a){t&1&&(l(0,"th",48),s(1,"Quantit\xE9 (Stock & Ingr\xE9dients)"),r())}function Ti(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.totalQuantity)}}function Mi(t,a){t&1&&(l(0,"th",48),s(1,"Montant"),r())}function Bi(t,a){if(t&1&&(l(0,"td",50),s(1),r()),t&2){let o=a.$implicit;c(),I(o.totalAmount)}}function Vi(t,a){t&1&&(l(0,"th",48),s(1,"Date"),r())}function qi(t,a){if(t&1&&(l(0,"td",50),s(1),ot(2,"date"),r()),t&2){let o=a.$implicit;c(),I(lt(2,1,o.date,"dd/MM/yyyy"))}}function Di(t,a){t&1&&(l(0,"th",52),s(1,"Action"),r())}function Oi(t,a){if(t&1){let o=S();l(0,"td",50)(1,"div",53)(2,"button",54),p(3,"i",55),r(),l(4,"button",56),h("click",function(){let i=x(o).$implicit,m=f();return b(m.deleteItem(i))}),p(5,"i",57),r(),l(6,"button",56),h("click",function(){let i=x(o).$implicit,m=f();return b(m.newItem("edit",i.id))}),p(7,"i",58),r()()()}if(t&2){let o=a.$implicit,e=f();c(2),d("matTooltip",e.getTracabilityInfo(o))}}function Ai(t,a){t&1&&p(0,"tr",59)}function Ni(t,a){if(t&1){let o=S();l(0,"tr",60),h("dblclick",function(){let i=x(o).$implicit,m=f();return b(m.newItem("edit",i.id))}),r()}}function Ri(t,a){t&1&&(l(0,"div",61)(1,"p",62),s(2,"Aucune donn\xE9e \xE0 afficher"),r()())}var nt=(()=>{let a=class a{isAllSelected(){let e=this.selection.selected.length,n=this.dataSource.data.length;return e===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,n,i,m,g,F,w){this.batchesHttp=e,this.snackBar=n,this.fb=i,this.matDialog=m,this.traceability=g,this.moneySourcesHttp=F,this.stocksHttp=w,this.dataSource=new Re([]),this.displayedColumns=["select","code","moneySourceId.label","productId.label","quantity","totalQuantity","totalAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new J,this.batchFilterChanged=new J,this.pageSize=Y.pagination.pageSize,this.batches=[],this.selection=new pe(!0,[]),this.showFirstLastButtons=Y.pagination.showFirstLastButtons,this.moneySources=[],this.stocks=[],this.batchFilterFormGroup=this.fb.group({moneySourceId:[void 0],productId:[void 0]})}ngOnInit(){this.moneySourcesHttp.getAll().subscribe({next:e=>{this.moneySources=e}}),this.stocksHttp.getAll().subscribe({next:e=>{this.stocks=e}})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),re(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.batchFilterChanged).pipe(le({}),ae(()=>(this.isLoadingResults=!0,this.batchesHttp.paginate(this.getFilterQuery).pipe(oe(()=>ie(null))))),ne(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,Ie(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",n=0){this.matDialog.open(it,{data:{id:n,mode:e},minWidth:"97vw",minHeight:"97vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.batchFilterChanged.emit()}resetItemsFilterForm(){this.batchFilterFormGroup.reset({moneySourceId:void 0,productId:void 0}),this.batchFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,n){e&&this.selection.toggle(n)}deleteMany(e){let n=new URLSearchParams;e.forEach(m=>{n.append("id",m.id.toString())});let i=`?${n.toString()}`;this.batchesHttp.deleteMany(i).subscribe({next:m=>{m.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:m=>this.snackBar.open(m.message)})}get getFilterQuery(){let e=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,moneySourceId:this.batchFilterFormGroup.get("moneySourceId")?.value,productId:this.batchFilterFormGroup.get("productId")?.value};return M(n.pageIndex)&&e.append("pageIndex",n.pageIndex.toString()),M(n.pageSize)&&e.append("pageSize",n.pageSize.toString()),e.append("order","DESC"),M(n.moneySourceId)&&e.append("moneySourceId",n.moneySourceId),M(n.productId)&&e.append("productId",n.productId),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};a.\u0275fac=function(n){return new(n||a)(_(Qe),_(P),_(L),_(Ee),_(Se),_(Le),_(He))},a.\u0275cmp=B({type:a,selectors:[["app-batches-grid"]],viewQuery:function(n,i){if(n&1&&(E(Q,5),E(U,5),E(fi,5)),n&2){let m;k(m=G())&&(i.paginator=m.first),k(m=G())&&(i.sort=m.first),k(m=G())&&(i.firstFocused=m.first)}},decls:54,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","productId.label"],["matColumnDef","quantity"],["matColumnDef","moneySourceId.label"],["matColumnDef","totalQuantity"],["matColumnDef","totalAmount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],[3,"required"],["formControlName","moneySourceId","myInput","","size","small"],[4,"ngFor","ngForOf"],["formControlName","productId","myInput","","size","small"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,i){if(n&1&&(l(0,"div",0)(1,"div",1)(2,"h3"),s(3,"Production / Lots"),r()(),l(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),l(8,"div",6),p(9,"i",7),l(10,"span"),s(11,"FILTRE"),r()()(),u(12,_i,22,5,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),r(),l(13,"div",9),u(14,yi,5,1,"button",10),l(15,"button",11),h("click",function(){return i.newItem()}),l(16,"div",12),p(17,"i",13),l(18,"span",14),s(19,"Lot"),r()()()()(),l(20,"div")(21,"div",15)(22,"table",16),C(23,17),u(24,xi,2,3,"th",18)(25,bi,2,2,"td",19),v(),C(26,20),u(27,Ci,2,0,"th",18)(28,vi,2,1,"td",19),v(),C(29,21),u(30,Si,2,0,"th",18)(31,Ii,2,1,"td",19),v(),C(32,22),u(33,Fi,2,0,"th",18)(34,wi,2,1,"td",19),v(),C(35,23),u(36,Ei,2,0,"th",18)(37,ki,2,1,"td",19),v(),C(38,24),u(39,Gi,2,0,"th",18)(40,Ti,2,1,"td",19),v(),C(41,25),u(42,Mi,2,0,"th",18)(43,Bi,2,1,"td",19),v(),C(44,26),u(45,Vi,2,0,"th",18)(46,qi,3,4,"td",19),v(),C(47,27),u(48,Di,2,0,"th",28)(49,Oi,8,1,"td",19),v(),u(50,Ai,1,0,"tr",29)(51,Ni,1,0,"tr",30),r(),u(52,Ri,3,0,"div",31),r(),p(53,"mat-paginator",32),r()()),n&2){let m=se(7);c(12),d("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),d("ngIf",i.selection.selected.length>0),c(8),d("dataSource",i.dataSource),c(28),d("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),d("matRowDefColumns",i.displayedColumns),c(),d("ngIf",i.dataSource.data.length==0),c(),d("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[de,q,N,ye,xe,_e,O,A,R,H,be,D,ue,ke,Ge,Me,De,Be,Te,Oe,Ve,qe,Ae,Ne,Q,U,he,fe,j,z,$,at],styles:[`app-batches-grid{display:flex;flex:1}
`],encapsulation:2});let t=a;return t})();var Hi=[{path:"",redirectTo:"batches",pathMatch:"full"},{path:"batches",component:nt},{path:"ingredients",component:tt}],gt=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=ce({type:a}),a.\u0275inj=me({imports:[ze.forChild(Hi),ze]});let t=a;return t})();var An=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=ce({type:a}),a.\u0275inj=me({imports:[ft,gt]});let t=a;return t})();export{An as ProductionModule};
