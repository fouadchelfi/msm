import{a as oe}from"./chunk-O36OTMU2.js";import{$a as we,A as p,Aa as Ce,Ab as He,B as d,Ba as xe,Bb as Le,C as r,Ca as Se,Cb as ze,D as i,Da as Y,Db as $e,E as u,Ea as b,Eb as W,F as y,Fa as q,G as C,Ga as R,H as F,Ha as H,I as h,Ia as ve,J as _,Ja as L,Jb as J,K as k,Ka as mt,L as G,La as st,M as T,Ma as z,N as _e,Na as ee,Nb as ft,O as m,Oa as te,P as x,Pa as ie,Q as D,Qa as $,Ra as be,Ta as B,U as he,Ua as Q,Ub as Be,Va as j,W as ge,Wa as P,Xa as ne,Ya as Ee,Z as X,Za as Fe,_ as O,_b as Qe,a as K,aa as at,ab as ct,bb as Pe,cb as Ie,d as ae,db as M,e as me,ec as _t,f as lt,fb as re,g as se,gb as dt,gc as ht,h as ce,hb as ut,ib as ke,j as de,jb as Ge,k as ue,kb as Te,lb as U,mb as pt,n as pe,p as N,pa as je,q as fe,r as S,s as v,sb as Me,tb as Ve,ub as Ne,v as c,vb as De,w as g,wb as Oe,xb as Ae,y as Z,ya as A,yb as qe,za as ye,zb as Re}from"./chunk-J3ZMDLLJ.js";var St=["firstFocused"];function vt(e,l){if(e&1&&u(0,"my-global-errors",30),e&2){let a=_();d("errors",a.errors)}}function bt(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Et(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Ft(e,l){if(e&1&&(y(0),r(1,"option",31),m(2),i(),C()),e&2){let a=l.$implicit;c(),d("value",a.code),c(),x(a.name)}}var it=(()=>{let l=class l{constructor(t,n,o,s,f){this.fb=t,this.dialogRef=n,this.data=o,this.customersHttp=s,this.snackBar=f,this.errors=[],this.provinces=dt,this.customerFormGroup=this.fb.group({id:[void 0],code:[""],name:["",[b.required]],debt:[0,[b.required]],postalCode:[""],province:[""],city:[""],address:[""],phoneNumberOne:[""],phoneNumberTow:[""],fax:[""],email:[""],website:[""],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(t){this.customersHttp.getOneById(t).subscribe({next:n=>{this.customerFormGroup.patchValue({id:n.id,code:n.code,name:n.name,debt:n.debt,postalCode:n.postalCode,province:n.province,city:n.city,address:n.address,phoneNumberOne:n.phoneNumberOne,phoneNumberTow:n.phoneNumberTow,fax:n.fax,email:n.email,website:n.website,notes:n.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.customerFormGroup.valid==!0?this.data.mode=="creation"?this.customersHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.customersHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.customerFormGroup.markAllAsTouched()}resetForm(){this.customerFormGroup.reset({id:void 0,code:"",name:"",debt:0,postalCode:"",province:"",city:"",address:"",phoneNumberOne:"",phoneNumberTow:"",fax:"",email:"",website:"",notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.customerFormGroup.markAsUntouched(),this.customerFormGroup.clearValidators(),this.customerFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.customerFormGroup.getRawValue())}getUpdate(){return K({},this.customerFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(n){return new(n||l)(g($),g(ke),g(Ge),g(J),g(U))},l.\u0275cmp=N({type:l,selectors:[["app-customer-form"]],viewQuery:function(n,o){if(n&1&&k(St,5),n&2){let s;G(s=T())&&(o.firstFocused=s.first)}},decls:75,vars:8,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","name","type","text","myInput",""],[4,"ngIf"],["formControlName","debt","type","number","myInput",""],["formControlName","province","myInput",""],[4,"ngFor","ngForOf"],["formControlName","city","type","text","myInput",""],["formControlName","address","type","text","myInput",""],["formControlName","phoneNumberOne","type","text","myInput",""],["formControlName","phoneNumberTow","type","text","myInput",""],["formControlName","fax","type","text","myInput",""],["formControlName","postalCode","type","text","myInput",""],["formControlName","email","type","email","myInput",""],["formControlName","website","type","text","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(n,o){if(n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),m(3),i(),r(4,"button",3),h("click",function(){return o.closeDialog()}),u(5,"i",4),i()(),p(6,vt,1,1,"my-global-errors",5),r(7,"div",6)(8,"form",7),u(9,"input",8),r(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),i(),u(14,"input",10,11),i(),r(16,"my-form-field")(17,"my-label",12),m(18,"Nom"),i(),u(19,"input",13),p(20,bt,2,0,"my-error",14),i(),r(21,"my-form-field")(22,"my-label",12),m(23,"Dette"),i(),u(24,"input",15),p(25,Et,2,0,"my-error",14),i()(),r(26,"div",9)(27,"my-form-field")(28,"my-label"),m(29,"Wilaya"),i(),r(30,"select",16),p(31,Ft,3,2,"ng-container",17),i()(),r(32,"my-form-field")(33,"my-label"),m(34,"Ville"),i(),u(35,"input",18),i()(),r(36,"my-form-field")(37,"my-label"),m(38,"Adresse"),i(),u(39,"input",19),i(),r(40,"div",9)(41,"my-form-field")(42,"my-label"),m(43,"Num-T\xE9l 1"),i(),u(44,"input",20),i(),r(45,"my-form-field")(46,"my-label"),m(47,"Num-T\xE9l 2"),i(),u(48,"input",21),i(),r(49,"my-form-field")(50,"my-label"),m(51,"Fax"),i(),u(52,"input",22),i()(),r(53,"div",9)(54,"my-form-field")(55,"my-label"),m(56,"Code postal"),i(),u(57,"input",23),i(),r(58,"my-form-field")(59,"my-label"),m(60,"Email"),i(),u(61,"input",24),i(),r(62,"my-form-field")(63,"my-label"),m(64,"Site web"),i(),u(65,"input",25),i()(),r(66,"my-form-field")(67,"my-label"),m(68,"Notes"),i(),u(69,"textarea",26),i()()(),r(70,"div",27)(71,"button",28),h("click",function(){return o.create()}),m(72,"Nouveau "),i(),r(73,"button",29),h("click",function(){return o.save()}),m(74,"Sauvegarder"),i()()()),n&2){let s,f;c(3),D(" ",o.data.mode=="creation"?"Nouveau ":"Modifier "," client "),c(3),d("ngIf",o.errors.length>0),c(2),d("formGroup",o.customerFormGroup),c(9),d("required",!0),c(3),d("ngIf",((s=o.customerFormGroup.get("name"))==null?null:s.invalid)&&(((s=o.customerFormGroup.get("name"))==null?null:s.dirty)||((s=o.customerFormGroup.get("name"))==null?null:s.touched))&&((s=o.customerFormGroup.get("name"))==null?null:s.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((f=o.customerFormGroup.get("debt"))==null?null:f.invalid)&&(((f=o.customerFormGroup.get("debt"))==null?null:f.dirty)||((f=o.customerFormGroup.get("debt"))==null?null:f.touched))&&((f=o.customerFormGroup.get("debt"))==null?null:f.getError("required"))),c(6),d("ngForOf",o.provinces)}},dependencies:[X,O,H,te,ie,Y,ve,ee,q,R,L,z,A,P,Ee,Q,j,ne,Fe],encapsulation:2});let e=l;return e})();var Vt=["firstFocused"];function Nt(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Dt(e,l){if(e&1){let a=F();r(0,"div",32)(1,"div",33)(2,"span"),m(3,"Filtrer"),i(),r(4,"button",34),h("click",function(){S(a);let n=_();return v(n.toggleFilterMenu())}),u(5,"i",35),i()(),r(6,"form",36)(7,"my-form-field")(8,"my-label"),m(9,"Nom *"),i(),u(10,"input",37,38),p(12,Nt,2,0,"my-error",39),i()(),r(13,"div",40)(14,"button",41),h("click",function(){S(a);let n=_();return v(n.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),i(),r(16,"button",11),h("click",function(){S(a);let n=_();return v(n.filterItems())}),m(17,"Appliquer"),i()()()}if(e&2){let a=_(),t;c(6),d("formGroup",a.customerFilterFormGroup),c(6),d("ngIf",((t=a.customerFilterFormGroup.get("name"))==null?null:t.invalid)&&(((t=a.customerFilterFormGroup.get("name"))==null?null:t.dirty)||((t=a.customerFilterFormGroup.get("name"))==null?null:t.touched))&&((t=a.customerFilterFormGroup.get("name"))==null?null:t.getError("required")))}}function Ot(e,l){if(e&1){let a=F();r(0,"button",42),h("click",function(){S(a);let n=_();return v(n.deleteSeleted())}),r(1,"div",43),u(2,"i",44),r(3,"span"),m(4),i()()()}if(e&2){let a=_();c(4),D("Supprimer (",a.selection.selected.length,")")}}function At(e,l){if(e&1){let a=F();r(0,"th",45)(1,"mat-checkbox",46),h("change",function(n){S(a);let o=_();return v(o.allSelectionChanged(n))}),i()()}if(e&2){let a=_();c(),d("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function qt(e,l){if(e&1){let a=F();r(0,"td",47)(1,"mat-checkbox",48),h("click",function(n){return n.stopPropagation()})("change",function(n){let s=S(a).$implicit,f=_();return v(f.selectionChanged(n,s))}),i()()}if(e&2){let a=l.$implicit,t=_();c(),d("checked",t.selection.isSelected(a))("aria-label",t.checkboxLabel(a))}}function Rt(e,l){e&1&&(r(0,"th",45),m(1,"Code "),i())}function Ht(e,l){if(e&1&&(r(0,"td",47),m(1),i()),e&2){let a=l.$implicit;c(),x(a.code)}}function Lt(e,l){e&1&&(r(0,"th",45),m(1,"Nom "),i())}function zt(e,l){if(e&1&&(r(0,"td",47),m(1),he(2,"myLimitTextLength"),i()),e&2){let a=l.$implicit;c(),x(ge(2,1,a.name,30))}}function $t(e,l){e&1&&(r(0,"th",45),m(1,"Dette "),i())}function Bt(e,l){if(e&1&&(r(0,"td",47),m(1),i()),e&2){let a=l.$implicit;c(),x(a.debt)}}function Qt(e,l){e&1&&(r(0,"th",45),m(1,"Num-T\xE9l 1"),i())}function jt(e,l){if(e&1&&(r(0,"td",47),m(1),i()),e&2){let a=l.$implicit;c(),x(a.phoneNumberOne)}}function Pt(e,l){e&1&&(r(0,"th",45),m(1,"Num-T\xE9l 2"),i())}function Ut(e,l){if(e&1&&(r(0,"td",47),m(1),i()),e&2){let a=l.$implicit;c(),x(a.phoneNumberTow)}}function Wt(e,l){e&1&&(r(0,"th",45),m(1,"Notes"),i())}function Jt(e,l){if(e&1&&(r(0,"td",47),m(1),i()),e&2){let a=l.$implicit;c(),x(a.notes)}}function Kt(e,l){e&1&&(r(0,"th",49),m(1,"Action"),i())}function Zt(e,l){if(e&1){let a=F();r(0,"td",47)(1,"div",50)(2,"button",51),u(3,"i",52),i(),r(4,"button",53),h("click",function(){let o=S(a).$implicit,s=_();return v(s.deleteItem(o))}),u(5,"i",54),i(),r(6,"button",53),h("click",function(){let o=S(a).$implicit,s=_();return v(s.newItem("edit",o.id))}),u(7,"i",55),i()()()}if(e&2){let a=l.$implicit,t=_();c(2),d("matTooltip",t.getTracabilityInfo(a))}}function Xt(e,l){e&1&&u(0,"tr",56)}function Yt(e,l){if(e&1){let a=F();r(0,"tr",57),h("dblclick",function(){let o=S(a).$implicit,s=_();return v(s.newItem("edit",o.id))}),i()}}function ei(e,l){e&1&&(r(0,"div",58)(1,"p",59),m(2,"Aucune donn\xE9e \xE0 afficher"),i()())}var nt=(()=>{let l=class l{isAllSelected(){let t=this.selection.selected.length,n=this.dataSource.data.length;return t===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,n,o,s,f){this.customersHttp=t,this.snackBar=n,this.fb=o,this.matDialog=s,this.traceability=f,this.dataSource=new $e([]),this.displayedColumns=["select","code","name","debt","phoneNumberOne","phoneNumberTow","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.customerFilterChanged=new Z,this.pageSize=oe.pagination.pageSize,this.customers=[],this.selection=new Ce(!0,[]),this.showFirstLastButtons=oe.pagination.showFirstLastButtons,this.customerFilterFormGroup=this.fb.group({name:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.customerFilterChanged).pipe(de({}),ue(()=>(this.isLoadingResults=!0,this.customersHttp.paginate(this.getFilterQuery).pipe(ce(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Ie(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",n=0){this.matDialog.open(it,{data:{id:n,mode:t},minWidth:"512px",minHeight:"90vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:o=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.customerFilterChanged.emit()}resetItemsFilterForm(){this.customerFilterFormGroup.reset({name:""}),this.customerFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,n){t&&this.selection.toggle(n)}deleteMany(t){let n=new URLSearchParams;t.forEach(s=>{n.append("id",s.id.toString())});let o=`?${n.toString()}`;this.customersHttp.deleteMany(o).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let t=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.customerFilterFormGroup.get("name")?.value};return M(n.pageIndex)&&t.append("pageIndex",n.pageIndex.toString()),M(n.pageSize)&&t.append("pageSize",n.pageSize.toString()),t.append("order","DESC"),M(n.label)&&t.append("name",n.label),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};l.\u0275fac=function(n){return new(n||l)(g(J),g(U),g($),g(Te),g(we))},l.\u0275cmp=N({type:l,selectors:[["app-customers-grid"]],viewQuery:function(n,o){if(n&1&&(k(B,5),k(W,5),k(Vt,5)),n&2){let s;G(s=T())&&(o.paginator=s.first),G(s=T())&&(o.sort=s.first),G(s=T())&&(o.firstFocused=s.first)}},decls:51,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","name"],["matColumnDef","debt"],["matColumnDef","phoneNumberOne"],["matColumnDef","phoneNumberTow"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","name","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,o){if(n&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Ventes / Clients"),i()(),r(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return o.toggleFilterMenu()}),r(8,"div",6),u(9,"i",7),r(10,"span"),m(11,"FILTRE"),i()()(),p(12,Dt,18,2,"ng-template",8),h("backdropClick",function(){return o.toggleFilterMenu()}),i(),r(13,"div",9),p(14,Ot,5,1,"button",10),r(15,"button",11),h("click",function(){return o.newItem()}),r(16,"div",12),u(17,"i",13),r(18,"span",14),m(19,"Client"),i()()()()(),r(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,At,2,3,"th",18)(25,qt,2,2,"td",19),C(),y(26,20),p(27,Rt,2,0,"th",18)(28,Ht,2,1,"td",19),C(),y(29,21),p(30,Lt,2,0,"th",18)(31,zt,3,4,"td",19),C(),y(32,22),p(33,$t,2,0,"th",18)(34,Bt,2,1,"td",19),C(),y(35,23),p(36,Qt,2,0,"th",18)(37,jt,2,1,"td",19),C(),y(38,24),p(39,Pt,2,0,"th",18)(40,Ut,2,1,"td",19),C(),y(41,25),p(42,Wt,2,0,"th",18)(43,Jt,2,1,"td",19),C(),y(44,26),p(45,Kt,2,0,"th",27)(46,Zt,8,1,"td",19),C(),p(47,Xt,1,0,"tr",28)(48,Yt,1,0,"tr",29),i(),p(49,ei,3,0,"div",30),i(),u(50,"mat-paginator",31),i()()),n&2){let s=_e(7);c(12),d("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",o.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),d("ngIf",o.selection.selected.length>0),c(8),d("dataSource",o.dataSource),c(25),d("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),c(),d("matRowDefColumns",o.displayedColumns),c(),d("ngIf",o.dataSource.data.length==0),c(),d("showFirstLastButtons",o.showFirstLastButtons)("length",o.resultsLength)("pageSize",o.pageSize)}},dependencies:[O,H,Y,q,R,L,z,be,A,ye,Me,Ve,De,Re,Oe,Ne,He,Ae,qe,Le,ze,B,W,Se,xe,P,Q,j,ne,ut],styles:[`app-customers-grid{display:flex;flex:1}
`],encapsulation:2});let e=l;return e})();var ti=["firstFocused"];function ii(e,l){if(e&1&&u(0,"my-global-errors",34),e&2){let a=_();d("errors",a.errors)}}function ni(e,l){if(e&1&&(y(0),r(1,"option",35),m(2),i(),C()),e&2){let a=l.$implicit;c(),d("value",a.id),c(),x(a.name)}}function ri(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function oi(e,l){if(e&1&&(y(0),r(1,"option",35),m(2),i(),C()),e&2){let a=l.$implicit;c(),d("value",a.id),c(),x(a.label)}}function li(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function ai(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function mi(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function si(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function ci(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function di(e,l){if(e&1&&(y(0),r(1,"option",35),m(2),i(),C()),e&2){let a=l.$implicit,t=_(2);c(),d("value",a.id),c(),x(t.getStockInfo(a))}}function ui(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function pi(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function fi(e,l){e&1&&(r(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function _i(e,l){e&1&&(r(0,"div",48)(1,"div",49),u(2,"div",50),i()())}function hi(e,l){if(e&1){let a=F();r(0,"button",51),h("click",function(){S(a);let n=_().index,o=_();return v(o.removeItem(n))}),u(1,"i",52),i()}}function gi(e,l){if(e&1){let a=F();r(0,"button",51),h("click",function(){S(a);let n=_().index,o=_();return v(o.recoverItem(n))}),u(1,"i",53),i()}}function yi(e,l){if(e&1&&(r(0,"div",36)(1,"div",37),u(2,"input",8)(3,"input",38)(4,"input",39),r(5,"my-form-field",40)(6,"my-label",13),m(7,"Stock"),i(),r(8,"select",41),p(9,di,3,2,"ng-container",15),i()(),r(10,"my-form-field",42)(11,"my-label",13),m(12,"Quantit\xE9"),i(),u(13,"input",43),p(14,ui,2,0,"my-error",16),i(),r(15,"my-form-field",42)(16,"my-label",13),m(17,"Prix de vente"),i(),u(18,"input",44),p(19,pi,2,0,"my-error",16),i(),r(20,"my-form-field",42)(21,"my-label",13),m(22,"Montant"),i(),u(23,"input",45),p(24,fi,2,0,"my-error",16),i(),p(25,_i,3,0,"div",46),i(),p(26,hi,2,0,"button",47)(27,gi,2,0,"button",47),i()),e&2){let a=l.$implicit,t=l.index,n=_(),o,s,f,E,w,I;d("formGroupName",t),c(6),d("required",!0),c(3),d("ngForOf",n.stocks),c(2),d("required",!0),c(3),d("ngIf",((o=a.get("quantity"))==null?null:o.invalid)&&(((o=a.get("quantity"))==null?null:o.dirty)||((o=a.get("quantity"))==null?null:o.touched))&&((o=a.get("quantity"))==null?null:o.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((s=a.get("salePrice"))==null?null:s.invalid)&&(((s=a.get("salePrice"))==null?null:s.dirty)||((s=a.get("salePrice"))==null?null:s.touched))&&((s=a.get("salePrice"))==null?null:s.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((f=a.get("amount"))==null?null:f.invalid)&&(((f=a.get("amount"))==null?null:f.dirty)||((f=a.get("amount"))==null?null:f.touched))&&((f=a.get("amount"))==null?null:f.getError("required"))),c(),d("ngIf",((E=a.get("mode"))==null?null:E.value)=="deletion"),c(),d("ngIf",((w=a.get("mode"))==null?null:w.value)!="deletion"),c(),d("ngIf",((I=a.get("mode"))==null?null:I.value)=="deletion")}}var rt=(()=>{let l=class l{get items(){return this.saleFormGroup.get("items")}constructor(t,n,o,s,f,E,w,I){this.fb=t,this.dialogRef=n,this.data=o,this.snackBar=s,this.salesHttp=f,this.customersHttp=E,this.moneySourcesHttp=w,this.stocksHttp=I,this.errors=[],this.customers=[],this.moneySources=[],this.stocks=[],this.saleFormGroup=this.fb.group({id:[void 0],code:[""],deliveryAmount:[0,[b.required]],payment:[0,[b.required]],totalQuantity:[{value:0,disabled:!0},[b.required]],totalAmount:[{value:0,disabled:!0},[b.required]],moneySourceId:[void 0,[b.required]],customerId:[void 0,[b.required]],date:[Pe(),[b.required]],notes:[""],items:this.fb.array([])})}ngOnInit(){lt([this.customersHttp.getAll(),this.moneySourcesHttp.getAll(),this.stocksHttp.getAll()]).subscribe({next:([t,n,o])=>{this.customers=t,this.moneySources=n,this.stocks=o,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChaged()}loadData(t){this.salesHttp.getOneById(t).subscribe({next:n=>{this.saleFormGroup.patchValue({id:n.id,code:n.code,deliveryAmount:n.deliveryAmount,payment:n.payment,totalQuantity:n.totalQuantity,totalAmount:n.totalAmount,moneySourceId:n.moneySourceId.id,customerId:n.customerId.id,date:ct(n.date),notes:n.notes}),this.items.clear(),n.items.forEach(o=>{this.items.push(this.fb.group({id:[o.id],stockId:[o.stockId.id,[b.required]],quantity:[o.quantity,[b.required]],salePrice:[o.salePrice,[b.required]],amount:[{value:o.amount,disabled:!0},[b.required]],mode:["update",[b.required]],oldMode:["update",[b.required]]}))})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.saleFormGroup.valid==!0?this.data.mode=="creation"?this.salesHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.salesHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.saleFormGroup.markAllAsTouched()}resetForm(){this.saleFormGroup.reset({id:void 0,code:"",deliveryAmount:0,payment:0,totalQuantity:0,totalAmount:0,moneySourceId:0,customerId:0,date:Pe(),notes:""},{emitEvent:!1}),this.items.clear()}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.saleFormGroup.markAsUntouched(),this.saleFormGroup.clearValidators(),this.saleFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.saleFormGroup.getRawValue())}getUpdate(){return K({},this.saleFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}createItem(){this.items.push(this.fb.group({id:[void 0],stockId:[void 0,[b.required]],quantity:[0,[b.required]],salePrice:[0,[b.required]],amount:[{value:0,disabled:!0},[b.required]],mode:["creation",[b.required]],oldMode:["creation",[b.required]]}))}removeItem(t){this.data.mode=="edit"?this.items.at(t).get("mode")?.setValue("deletion"):this.items.removeAt(t)}recoverItem(t){let n=this.items.at(t).get("oldMode")?.value;this.items.at(t).get("mode")?.setValue(n)}getStockInfo(t){return`${t.label} - ${t.categoryId?.label} - ${t.familyId?.label} *** Un stock avec une Quantit\xE9 de ${t.quantity} KG et Prix de vente : ${t.salePrice}`}handleFormChaged(){this.saleFormGroup.valueChanges.subscribe({next:t=>{let n=t?.items,o=0,s=0;n.forEach((f,E)=>{this.items.at(E).get("amount")?.setValue(re(f.quantity)*re(f.salePrice),{emitEvent:!1})}),n.forEach((f,E)=>{o+=re(f.quantity),s+=re(this.items.at(E).get("amount")?.value)}),s+=re(this.saleFormGroup.get("deliveryAmount")?.value),this.saleFormGroup.get("totalQuantity")?.setValue(o,{emitEvent:!1}),this.saleFormGroup.get("totalAmount")?.setValue(s,{emitEvent:!1})}})}};l.\u0275fac=function(n){return new(n||l)(g($),g(ke),g(Ge),g(U),g(Qe),g(J),g(Be),g(ft))},l.\u0275cmp=N({type:l,selectors:[["app-sale-form"]],viewQuery:function(n,o){if(n&1&&k(ti,5),n&2){let s;G(s=T())&&(o.firstFocused=s.first)}},decls:70,vars:18,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-3","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2","w-96"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],[3,"required"],["formControlName","customerId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-col","gap-y-2","w-64"],["formControlName","deliveryAmount","type","number","myInput","","size","small"],["formControlName","payment","type","number","myInput","","size","small"],["formControlName","totalQuantity","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"!-mt-1"],["formControlName","notes","myTextarea","","type","text"],["formArrayName","items"],[1,"mb-1"],[1,"flex","flex-col","mt-2"],["class","flex flex-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",1,"mt-2",3,"click"],[1,"ri-add-line","text-lg"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"],[1,"flex","flex-row",3,"formGroupName"],[1,"relative","flex","flex-row","gap-x-2"],["formControlName","mode","type","text",1,"!hidden"],["formControlName","oldMode","type","text",1,"!hidden"],[1,"w-[400px]"],["formControlName","stockId","myInput","","size","small"],[1,"w-48"],["formControlName","quantity","type","number","myInput","","size","small"],["formControlName","salePrice","type","number","myInput","","size","small"],["formControlName","amount","type","number","myInput","","size","small","myCalculableField",""],["class","absolute w-full h-full",4,"ngIf"],["class","mx-3 mt-2",3,"click",4,"ngIf"],[1,"absolute","w-full","h-full"],[1,"relative","h-full","bg-[rgba(255,0,0,0.05)]"],[1,"absolute","w-full","my-auto","top-0","bottom-0","h-[0.06rem]","bg-red-500"],[1,"mx-3","mt-2",3,"click"],[1,"ri-delete-bin-6-line","text-lg","text-red-500"],[1,"ri-device-recover-line","text-lg","text-blue-500"]],template:function(n,o){if(n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2),m(3),i(),r(4,"button",3),h("click",function(){return o.closeDialog()}),u(5,"i",4),i()(),p(6,ii,1,1,"my-global-errors",5),r(7,"div",6)(8,"form",7),u(9,"input",8),r(10,"div",9)(11,"div",10)(12,"my-form-field")(13,"my-label"),m(14,"Code"),i(),u(15,"input",11,12),i(),r(17,"my-form-field")(18,"my-label",13),m(19,"Client"),i(),r(20,"select",14),p(21,ni,3,2,"ng-container",15),i(),p(22,ri,2,0,"my-error",16),i(),r(23,"my-form-field")(24,"my-label",13),m(25,"Source d'argent"),i(),r(26,"select",17),p(27,oi,3,2,"ng-container",15),i(),p(28,li,2,0,"my-error",16),i()(),r(29,"div",18)(30,"my-form-field")(31,"my-label",13),m(32,"Montant de livraison"),i(),u(33,"input",19),p(34,ai,2,0,"my-error",16),i(),r(35,"my-form-field")(36,"my-label",13),m(37,"Versement"),i(),u(38,"input",20),p(39,mi,2,0,"my-error",16),i()(),r(40,"div",18)(41,"my-form-field")(42,"my-label",13),m(43,"Quantit\xE9 totale"),i(),u(44,"input",21),p(45,si,2,0,"my-error",16),i(),r(46,"my-form-field")(47,"my-label",13),m(48,"Montant total"),i(),u(49,"input",22),p(50,ci,2,0,"my-error",16),i()(),r(51,"my-form-field",23)(52,"my-label"),m(53,"Notes"),i(),u(54,"textarea",24),i()(),r(55,"div",25)(56,"span"),m(57,"Liste"),i(),u(58,"mat-divider",26),r(59,"div",27),p(60,yi,28,12,"div",28),i(),r(61,"button",29),h("click",function(){return o.createItem()}),u(62,"i",30),r(63,"span"),m(64,"Stock"),i()()()()(),r(65,"div",31)(66,"button",32),h("click",function(){return o.create()}),m(67,"Nouveau "),i(),r(68,"button",33),h("click",function(){return o.save()}),m(69,"Sauvegarder"),i()()()),n&2){let s,f,E,w,I,V;c(3),D(" ",o.data.mode=="creation"?"Nouveau ":"Modifier "," vente "),c(3),d("ngIf",o.errors.length>0),c(2),d("formGroup",o.saleFormGroup),c(10),d("required",!0),c(3),d("ngForOf",o.customers),c(),d("ngIf",((s=o.saleFormGroup.get("customerId"))==null?null:s.invalid)&&(((s=o.saleFormGroup.get("customerId"))==null?null:s.dirty)||((s=o.saleFormGroup.get("customerId"))==null?null:s.touched))&&((s=o.saleFormGroup.get("customerId"))==null?null:s.getError("required"))),c(2),d("required",!0),c(3),d("ngForOf",o.moneySources),c(),d("ngIf",((f=o.saleFormGroup.get("moneySourceId"))==null?null:f.invalid)&&(((f=o.saleFormGroup.get("moneySourceId"))==null?null:f.dirty)||((f=o.saleFormGroup.get("moneySourceId"))==null?null:f.touched))&&((f=o.saleFormGroup.get("moneySourceId"))==null?null:f.getError("required"))),c(3),d("required",!0),c(3),d("ngIf",((E=o.saleFormGroup.get("deliveryAmount"))==null?null:E.invalid)&&(((E=o.saleFormGroup.get("deliveryAmount"))==null?null:E.dirty)||((E=o.saleFormGroup.get("deliveryAmount"))==null?null:E.touched))&&((E=o.saleFormGroup.get("deliveryAmount"))==null?null:E.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((w=o.saleFormGroup.get("payment"))==null?null:w.invalid)&&(((w=o.saleFormGroup.get("payment"))==null?null:w.dirty)||((w=o.saleFormGroup.get("payment"))==null?null:w.touched))&&((w=o.saleFormGroup.get("payment"))==null?null:w.getError("required"))),c(3),d("required",!0),c(3),d("ngIf",((I=o.saleFormGroup.get("totalQuantity"))==null?null:I.invalid)&&(((I=o.saleFormGroup.get("totalQuantity"))==null?null:I.dirty)||((I=o.saleFormGroup.get("totalQuantity"))==null?null:I.touched))&&((I=o.saleFormGroup.get("totalQuantity"))==null?null:I.getError("required"))),c(2),d("required",!0),c(3),d("ngIf",((V=o.saleFormGroup.get("totalAmount"))==null?null:V.invalid)&&(((V=o.saleFormGroup.get("totalAmount"))==null?null:V.dirty)||((V=o.saleFormGroup.get("totalAmount"))==null?null:V.touched))&&((V=o.saleFormGroup.get("totalAmount"))==null?null:V.getError("required"))),c(10),d("ngForOf",o.items.controls)}},dependencies:[X,O,H,te,ie,Y,ve,ee,q,R,L,z,mt,st,A,pt,P,Ee,Q,j,ne,Fe,_t],encapsulation:2});let e=l;return e})();var Ci=["firstFocused"];function xi(e,l){if(e&1&&(y(0),r(1,"option",45),m(2),i(),C()),e&2){let a=l.$implicit;c(),d("value",a.id),c(),x(a.name)}}function Si(e,l){if(e&1&&(y(0),r(1,"option",45),m(2),i(),C()),e&2){let a=l.$implicit;c(),d("value",a.id),c(),x(a.label)}}function vi(e,l){if(e&1){let a=F();r(0,"div",34)(1,"div",35)(2,"span"),m(3,"Filtrer"),i(),r(4,"button",36),h("click",function(){S(a);let n=_();return v(n.toggleFilterMenu())}),u(5,"i",37),i()(),r(6,"form",38)(7,"my-form-field")(8,"my-label",39),m(9,"Client"),i(),r(10,"select",40),p(11,xi,3,2,"ng-container",41),i()(),r(12,"my-form-field")(13,"my-label",39),m(14,"Source d'argent"),i(),r(15,"select",42),p(16,Si,3,2,"ng-container",41),i()()(),r(17,"div",43)(18,"button",44),h("click",function(){S(a);let n=_();return v(n.resetItemsFilterForm())}),m(19,"R\xE9initialiser"),i(),r(20,"button",11),h("click",function(){S(a);let n=_();return v(n.filterItems())}),m(21,"Appliquer"),i()()()}if(e&2){let a=_();c(6),d("formGroup",a.saleFilterFormGroup),c(2),d("required",!0),c(3),d("ngForOf",a.customers),c(2),d("required",!0),c(3),d("ngForOf",a.moneySources)}}function bi(e,l){if(e&1){let a=F();r(0,"button",46),h("click",function(){S(a);let n=_();return v(n.deleteSeleted())}),r(1,"div",47),u(2,"i",48),r(3,"span"),m(4),i()()()}if(e&2){let a=_();c(4),D("Supprimer (",a.selection.selected.length,")")}}function Ei(e,l){if(e&1){let a=F();r(0,"th",49)(1,"mat-checkbox",50),h("change",function(n){S(a);let o=_();return v(o.allSelectionChanged(n))}),i()()}if(e&2){let a=_();c(),d("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Fi(e,l){if(e&1){let a=F();r(0,"td",51)(1,"mat-checkbox",52),h("click",function(n){return n.stopPropagation()})("change",function(n){let s=S(a).$implicit,f=_();return v(f.selectionChanged(n,s))}),i()()}if(e&2){let a=l.$implicit,t=_();c(),d("checked",t.selection.isSelected(a))("aria-label",t.checkboxLabel(a))}}function wi(e,l){e&1&&(r(0,"th",49),m(1,"Code "),i())}function Ii(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.code)}}function ki(e,l){e&1&&(r(0,"th",49),m(1,"Client "),i())}function Gi(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.customerId.name)}}function Ti(e,l){e&1&&(r(0,"th",49),m(1,"Source d'argent "),i())}function Mi(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.moneySourceId.label)}}function Vi(e,l){e&1&&(r(0,"th",49),m(1,"Montant de livraison"),i())}function Ni(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.deliveryAmount)}}function Di(e,l){e&1&&(r(0,"th",49),m(1,"Versement"),i())}function Oi(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.payment)}}function Ai(e,l){e&1&&(r(0,"th",49),m(1,"Quantit\xE9"),i())}function qi(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.totalQuantity)}}function Ri(e,l){e&1&&(r(0,"th",49),m(1,"Montant"),i())}function Hi(e,l){if(e&1&&(r(0,"td",51),m(1),i()),e&2){let a=l.$implicit;c(),x(a.totalAmount)}}function Li(e,l){e&1&&(r(0,"th",49),m(1,"Date"),i())}function zi(e,l){if(e&1&&(r(0,"td",51),m(1),he(2,"date"),i()),e&2){let a=l.$implicit;c(),x(ge(2,1,a.date,"dd/MM/yyyy"))}}function $i(e,l){e&1&&(r(0,"th",53),m(1,"Action"),i())}function Bi(e,l){if(e&1){let a=F();r(0,"td",51)(1,"div",54)(2,"button",55),u(3,"i",56),i(),r(4,"button",57),h("click",function(){let o=S(a).$implicit,s=_();return v(s.deleteItem(o))}),u(5,"i",58),i(),r(6,"button",57),h("click",function(){let o=S(a).$implicit,s=_();return v(s.newItem("edit",o.id))}),u(7,"i",59),i()()()}if(e&2){let a=l.$implicit,t=_();c(2),d("matTooltip",t.getTracabilityInfo(a))}}function Qi(e,l){e&1&&u(0,"tr",60)}function ji(e,l){if(e&1){let a=F();r(0,"tr",61),h("dblclick",function(){let o=S(a).$implicit,s=_();return v(s.newItem("edit",o.id))}),i()}}function Pi(e,l){e&1&&(r(0,"div",62)(1,"p",63),m(2,"Aucune donn\xE9e \xE0 afficher"),i()())}var ot=(()=>{let l=class l{isAllSelected(){let t=this.selection.selected.length,n=this.dataSource.data.length;return t===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,n,o,s,f,E,w){this.salesHttp=t,this.snackBar=n,this.fb=o,this.matDialog=s,this.traceability=f,this.customersHttp=E,this.moneySourcesHttp=w,this.dataSource=new $e([]),this.displayedColumns=["select","code","customerId.name","moneySourceId.label","deliveryAmount","payment","totalQuantity","totalAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.saleFilterChanged=new Z,this.pageSize=oe.pagination.pageSize,this.sales=[],this.selection=new Ce(!0,[]),this.showFirstLastButtons=oe.pagination.showFirstLastButtons,this.moneySources=[],this.customers=[],this.saleFilterFormGroup=this.fb.group({customerId:[void 0],moneySourceId:[void 0]})}ngOnInit(){this.customersHttp.getAll().subscribe({next:t=>{this.customers=t}}),this.moneySourcesHttp.getAll().subscribe({next:t=>{this.moneySources=t}})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.saleFilterChanged).pipe(de({}),ue(()=>(this.isLoadingResults=!0,this.salesHttp.paginate(this.getFilterQuery).pipe(ce(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Ie(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",n=0){this.matDialog.open(rt,{data:{id:n,mode:t},minWidth:"97vw",minHeight:"97vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:o=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.saleFilterChanged.emit()}resetItemsFilterForm(){this.saleFilterFormGroup.reset({customerId:void 0,moneySourceId:void 0}),this.saleFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,n){t&&this.selection.toggle(n)}deleteMany(t){let n=new URLSearchParams;t.forEach(s=>{n.append("id",s.id.toString())});let o=`?${n.toString()}`;this.salesHttp.deleteMany(o).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let t=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,customerId:this.saleFilterFormGroup.get("customerId")?.value,moneySourceId:this.saleFilterFormGroup.get("moneySourceId")?.value};return M(n.pageIndex)&&t.append("pageIndex",n.pageIndex.toString()),M(n.pageSize)&&t.append("pageSize",n.pageSize.toString()),t.append("order","DESC"),M(n.customerId)&&t.append("customerId",n.customerId),M(n.moneySourceId)&&t.append("moneySourceId",n.moneySourceId),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};l.\u0275fac=function(n){return new(n||l)(g(Qe),g(U),g($),g(Te),g(we),g(J),g(Be))},l.\u0275cmp=N({type:l,selectors:[["app-sales-grid"]],viewQuery:function(n,o){if(n&1&&(k(B,5),k(W,5),k(Ci,5)),n&2){let s;G(s=T())&&(o.paginator=s.first),G(s=T())&&(o.sort=s.first),G(s=T())&&(o.firstFocused=s.first)}},decls:57,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","customerId.name"],["matColumnDef","moneySourceId.label"],["matColumnDef","deliveryAmount"],["matColumnDef","payment"],["matColumnDef","totalQuantity"],["matColumnDef","totalAmount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],[3,"required"],["formControlName","customerId","myInput","","size","small"],[4,"ngFor","ngForOf"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,o){if(n&1&&(r(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Ventes"),i()(),r(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return o.toggleFilterMenu()}),r(8,"div",6),u(9,"i",7),r(10,"span"),m(11,"FILTRE"),i()()(),p(12,vi,22,5,"ng-template",8),h("backdropClick",function(){return o.toggleFilterMenu()}),i(),r(13,"div",9),p(14,bi,5,1,"button",10),r(15,"button",11),h("click",function(){return o.newItem()}),r(16,"div",12),u(17,"i",13),r(18,"span",14),m(19,"Vente"),i()()()()(),r(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,Ei,2,3,"th",18)(25,Fi,2,2,"td",19),C(),y(26,20),p(27,wi,2,0,"th",18)(28,Ii,2,1,"td",19),C(),y(29,21),p(30,ki,2,0,"th",18)(31,Gi,2,1,"td",19),C(),y(32,22),p(33,Ti,2,0,"th",18)(34,Mi,2,1,"td",19),C(),y(35,23),p(36,Vi,2,0,"th",18)(37,Ni,2,1,"td",19),C(),y(38,24),p(39,Di,2,0,"th",18)(40,Oi,2,1,"td",19),C(),y(41,25),p(42,Ai,2,0,"th",18)(43,qi,2,1,"td",19),C(),y(44,26),p(45,Ri,2,0,"th",18)(46,Hi,2,1,"td",19),C(),y(47,27),p(48,Li,2,0,"th",18)(49,zi,3,4,"td",19),C(),y(50,28),p(51,$i,2,0,"th",29)(52,Bi,8,1,"td",19),C(),p(53,Qi,1,0,"tr",30)(54,ji,1,0,"tr",31),i(),p(55,Pi,3,0,"div",32),i(),u(56,"mat-paginator",33),i()()),n&2){let s=_e(7);c(12),d("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",o.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),d("ngIf",o.selection.selected.length>0),c(8),d("dataSource",o.dataSource),c(31),d("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),c(),d("matRowDefColumns",o.displayedColumns),c(),d("ngIf",o.dataSource.data.length==0),c(),d("showFirstLastButtons",o.showFirstLastButtons)("length",o.resultsLength)("pageSize",o.pageSize)}},dependencies:[X,O,H,te,ie,ee,q,R,L,z,be,A,ye,Me,Ve,De,Re,Oe,Ne,He,Ae,qe,Le,ze,B,W,Se,xe,P,Q,j,at],styles:[`app-sales-grid{display:flex;flex:1}
`],encapsulation:2});let e=l;return e})();var Ui=[{path:"",redirectTo:"sales",pathMatch:"full"},{path:"sales",component:ot},{path:"customers",component:nt}],yt=(()=>{let l=class l{};l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=fe({type:l}),l.\u0275inj=pe({imports:[je.forChild(Ui),je]});let e=l;return e})();var Pn=(()=>{let l=class l{};l.\u0275fac=function(n){return new(n||l)},l.\u0275mod=fe({type:l}),l.\u0275inj=pe({imports:[ht,yt]});let e=l;return e})();export{Pn as SalesModule};
