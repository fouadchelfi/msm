import{a as ne}from"./chunk-O36OTMU2.js";import{$a as we,A as d,Aa as xe,Ab as Re,B as c,Ba as Ce,Bb as He,C as n,Ca as Se,Cb as Le,D as i,Da as Y,Db as ze,E as u,Ea as b,Eb as W,F as y,Fa as q,G as x,Ga as A,H as E,Ha as R,I as _,Ia as ve,Ib as J,J as h,Ja as H,K as k,Ka as mt,L as G,La as st,M as T,Ma as L,N as he,Na as ee,Nb as ft,O as m,Oa as te,P as C,Pa as ie,Q as D,Qa as z,Ra as be,Ta as B,U as _e,Ua as $,Ub as Be,Va as Q,W as ge,Wa as j,Xa as re,Ya as Fe,Z as X,Za as Ee,Zb as $e,_ as P,a as K,aa as at,ab as pt,bb as je,cb as Ie,d as ae,db as M,e as me,ec as ht,f as lt,fb as oe,g as se,gb as ct,gc as _t,h as pe,hb as ut,ib as ke,j as ce,jb as Ge,k as ue,kb as Te,lb as U,mb as dt,n as de,p as N,pa as Qe,q as fe,r as S,s as v,sb as Me,tb as Ve,ub as Ne,v as p,vb as De,w as g,wb as Pe,xb as Oe,y as Z,ya as O,yb as qe,za as ye,zb as Ae}from"./chunk-J3ZMDLLJ.js";var St=["firstFocused"];function vt(e,l){if(e&1&&u(0,"my-global-errors",34),e&2){let a=h();c("errors",a.errors)}}function bt(e,l){if(e&1&&(y(0),n(1,"option",35),m(2),i(),x()),e&2){let a=l.$implicit;p(),c("value",a.id),p(),C(a.name)}}function Ft(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Et(e,l){if(e&1&&(y(0),n(1,"option",35),m(2),i(),x()),e&2){let a=l.$implicit;p(),c("value",a.id),p(),C(a.label)}}function wt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function It(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function kt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Gt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Tt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Mt(e,l){if(e&1&&(y(0),n(1,"option",35),m(2),i(),x()),e&2){let a=l.$implicit,t=h(2);p(),c("value",a.id),p(),C(t.getStockInfo(a))}}function Vt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Nt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Dt(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function Pt(e,l){e&1&&(n(0,"div",48)(1,"div",49),u(2,"div",50),i()())}function Ot(e,l){if(e&1){let a=E();n(0,"button",51),_("click",function(){S(a);let r=h().index,o=h();return v(o.removeItem(r))}),u(1,"i",52),i()}}function qt(e,l){if(e&1){let a=E();n(0,"button",51),_("click",function(){S(a);let r=h().index,o=h();return v(o.recoverItem(r))}),u(1,"i",53),i()}}function At(e,l){if(e&1&&(n(0,"div",36)(1,"div",37),u(2,"input",8)(3,"input",38)(4,"input",39),n(5,"my-form-field",40)(6,"my-label",13),m(7,"Stock"),i(),n(8,"select",41),d(9,Mt,3,2,"ng-container",15),i()(),n(10,"my-form-field",42)(11,"my-label",13),m(12,"Quantit\xE9"),i(),u(13,"input",43),d(14,Vt,2,0,"my-error",16),i(),n(15,"my-form-field",42)(16,"my-label",13),m(17,"Prix de vente"),i(),u(18,"input",44),d(19,Nt,2,0,"my-error",16),i(),n(20,"my-form-field",42)(21,"my-label",13),m(22,"Montant"),i(),u(23,"input",45),d(24,Dt,2,0,"my-error",16),i(),d(25,Pt,3,0,"div",46),i(),d(26,Ot,2,0,"button",47)(27,qt,2,0,"button",47),i()),e&2){let a=l.$implicit,t=l.index,r=h(),o,s,f,F,w,I;c("formGroupName",t),p(6),c("required",!0),p(3),c("ngForOf",r.stocks),p(2),c("required",!0),p(3),c("ngIf",((o=a.get("quantity"))==null?null:o.invalid)&&(((o=a.get("quantity"))==null?null:o.dirty)||((o=a.get("quantity"))==null?null:o.touched))&&((o=a.get("quantity"))==null?null:o.getError("required"))),p(2),c("required",!0),p(3),c("ngIf",((s=a.get("salePrice"))==null?null:s.invalid)&&(((s=a.get("salePrice"))==null?null:s.dirty)||((s=a.get("salePrice"))==null?null:s.touched))&&((s=a.get("salePrice"))==null?null:s.getError("required"))),p(2),c("required",!0),p(3),c("ngIf",((f=a.get("amount"))==null?null:f.invalid)&&(((f=a.get("amount"))==null?null:f.dirty)||((f=a.get("amount"))==null?null:f.touched))&&((f=a.get("amount"))==null?null:f.getError("required"))),p(),c("ngIf",((F=a.get("mode"))==null?null:F.value)=="deletion"),p(),c("ngIf",((w=a.get("mode"))==null?null:w.value)!="deletion"),p(),c("ngIf",((I=a.get("mode"))==null?null:I.value)=="deletion")}}var it=(()=>{let l=class l{get items(){return this.purchaseFormGroup.get("items")}constructor(t,r,o,s,f,F,w,I){this.fb=t,this.dialogRef=r,this.data=o,this.snackBar=s,this.purchasesHttp=f,this.suppliersHttp=F,this.moneySourcesHttp=w,this.stocksHttp=I,this.errors=[],this.suppliers=[],this.moneySources=[],this.stocks=[],this.purchaseFormGroup=this.fb.group({id:[void 0],code:[""],cost:[0,[b.required]],payment:[0,[b.required]],totalQuantity:[{value:0,disabled:!0},[b.required]],totalAmount:[{value:0,disabled:!0},[b.required]],moneySourceId:[void 0,[b.required]],supplierId:[void 0,[b.required]],date:[je(),[b.required]],notes:[""],items:this.fb.array([])})}ngOnInit(){lt([this.suppliersHttp.getAll(),this.moneySourcesHttp.getAll(),this.stocksHttp.getAll()]).subscribe({next:([t,r,o])=>{this.suppliers=t,this.moneySources=r,this.stocks=o,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChaged()}loadData(t){this.purchasesHttp.getOneById(t).subscribe({next:r=>{this.purchaseFormGroup.patchValue({id:r.id,code:r.code,cost:r.cost,payment:r.payment,totalQuantity:r.totalQuantity,totalAmount:r.totalAmount,moneySourceId:r.moneySourceId.id,supplierId:r.supplierId.id,date:pt(r.date),notes:r.notes}),this.items.clear(),r.items.forEach(o=>{this.items.push(this.fb.group({id:[o.id],stockId:[o.stockId.id,[b.required]],quantity:[o.quantity,[b.required]],salePrice:[o.salePrice,[b.required]],amount:[{value:o.amount,disabled:!0},[b.required]],mode:["update",[b.required]],oldMode:["update",[b.required]]}))})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.purchaseFormGroup.valid==!0?this.data.mode=="creation"?this.purchasesHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.purchasesHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.purchaseFormGroup.markAllAsTouched()}resetForm(){this.purchaseFormGroup.reset({id:void 0,code:"",cost:0,payment:0,totalQuantity:0,totalAmount:0,moneySourceId:0,supplierId:0,date:je(),notes:""},{emitEvent:!1}),this.items.clear()}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.purchaseFormGroup.markAsUntouched(),this.purchaseFormGroup.clearValidators(),this.purchaseFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.purchaseFormGroup.getRawValue())}getUpdate(){return K({},this.purchaseFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}createItem(){this.items.push(this.fb.group({id:[void 0],stockId:[void 0,[b.required]],quantity:[0,[b.required]],salePrice:[0,[b.required]],amount:[{value:0,disabled:!0},[b.required]],mode:["creation",[b.required]],oldMode:["creation",[b.required]]}))}removeItem(t){this.data.mode=="edit"?this.items.at(t).get("mode")?.setValue("deletion"):this.items.removeAt(t)}recoverItem(t){let r=this.items.at(t).get("oldMode")?.value;this.items.at(t).get("mode")?.setValue(r)}getStockInfo(t){return`${t.label} - ${t.categoryId?.label} - ${t.familyId?.label} *** Un stock avec une Quantit\xE9 de ${t.quantity} KG et Prix de vente : ${t.salePrice}`}handleFormChaged(){this.purchaseFormGroup.valueChanges.subscribe({next:t=>{let r=t?.items,o=0,s=0;r.forEach((f,F)=>{this.items.at(F).get("amount")?.setValue(oe(f.quantity)*oe(f.salePrice),{emitEvent:!1})}),r.forEach((f,F)=>{o+=oe(f.quantity),s+=oe(this.items.at(F).get("amount")?.value)}),this.purchaseFormGroup.get("totalQuantity")?.setValue(o,{emitEvent:!1}),this.purchaseFormGroup.get("totalAmount")?.setValue(s,{emitEvent:!1})}})}};l.\u0275fac=function(r){return new(r||l)(g(z),g(ke),g(Ge),g(U),g($e),g(J),g(Be),g(ft))},l.\u0275cmp=N({type:l,selectors:[["app-purchase-form"]],viewQuery:function(r,o){if(r&1&&k(St,5),r&2){let s;G(s=T())&&(o.firstFocused=s.first)}},decls:70,vars:18,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-3","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2","w-96"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],[3,"required"],["formControlName","supplierId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-col","gap-y-2","w-64"],["formControlName","cost","type","number","myInput","","size","small"],["formControlName","payment","type","number","myInput","","size","small"],["formControlName","totalQuantity","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"!-mt-1"],["formControlName","notes","myTextarea","","type","text"],["formArrayName","items"],[1,"mb-1"],[1,"flex","flex-col","mt-2"],["class","flex flex-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",1,"mt-2",3,"click"],[1,"ri-add-line","text-lg"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"],[1,"flex","flex-row",3,"formGroupName"],[1,"relative","flex","flex-row","gap-x-2"],["formControlName","mode","type","text",1,"!hidden"],["formControlName","oldMode","type","text",1,"!hidden"],[1,"w-[400px]"],["formControlName","stockId","myInput","","size","small"],[1,"w-48"],["formControlName","quantity","type","number","myInput","","size","small"],["formControlName","salePrice","type","number","myInput","","size","small"],["formControlName","amount","type","number","myInput","","size","small","myCalculableField",""],["class","absolute w-full h-full",4,"ngIf"],["class","mx-3 mt-2",3,"click",4,"ngIf"],[1,"absolute","w-full","h-full"],[1,"relative","h-full","bg-[rgba(255,0,0,0.05)]"],[1,"absolute","w-full","my-auto","top-0","bottom-0","h-[0.06rem]","bg-red-500"],[1,"mx-3","mt-2",3,"click"],[1,"ri-delete-bin-6-line","text-lg","text-red-500"],[1,"ri-device-recover-line","text-lg","text-blue-500"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),m(3),i(),n(4,"button",3),_("click",function(){return o.closeDialog()}),u(5,"i",4),i()(),d(6,vt,1,1,"my-global-errors",5),n(7,"div",6)(8,"form",7),u(9,"input",8),n(10,"div",9)(11,"div",10)(12,"my-form-field")(13,"my-label"),m(14,"Code"),i(),u(15,"input",11,12),i(),n(17,"my-form-field")(18,"my-label",13),m(19,"Fournisseur"),i(),n(20,"select",14),d(21,bt,3,2,"ng-container",15),i(),d(22,Ft,2,0,"my-error",16),i(),n(23,"my-form-field")(24,"my-label",13),m(25,"Source d'argent"),i(),n(26,"select",17),d(27,Et,3,2,"ng-container",15),i(),d(28,wt,2,0,"my-error",16),i()(),n(29,"div",18)(30,"my-form-field")(31,"my-label",13),m(32,"Co\xFBt"),i(),u(33,"input",19),d(34,It,2,0,"my-error",16),i(),n(35,"my-form-field")(36,"my-label",13),m(37,"Versement"),i(),u(38,"input",20),d(39,kt,2,0,"my-error",16),i()(),n(40,"div",18)(41,"my-form-field")(42,"my-label",13),m(43,"Quantit\xE9 totale"),i(),u(44,"input",21),d(45,Gt,2,0,"my-error",16),i(),n(46,"my-form-field")(47,"my-label",13),m(48,"Montant total"),i(),u(49,"input",22),d(50,Tt,2,0,"my-error",16),i()(),n(51,"my-form-field",23)(52,"my-label"),m(53,"Notes"),i(),u(54,"textarea",24),i()(),n(55,"div",25)(56,"span"),m(57,"Liste"),i(),u(58,"mat-divider",26),n(59,"div",27),d(60,At,28,12,"div",28),i(),n(61,"button",29),_("click",function(){return o.createItem()}),u(62,"i",30),n(63,"span"),m(64,"Stock"),i()()()()(),n(65,"div",31)(66,"button",32),_("click",function(){return o.create()}),m(67,"Nouveau "),i(),n(68,"button",33),_("click",function(){return o.save()}),m(69,"Sauvegarder"),i()()()),r&2){let s,f,F,w,I,V;p(3),D(" ",o.data.mode=="creation"?"Nouvelle ":"Modifier "," achat "),p(3),c("ngIf",o.errors.length>0),p(2),c("formGroup",o.purchaseFormGroup),p(10),c("required",!0),p(3),c("ngForOf",o.suppliers),p(),c("ngIf",((s=o.purchaseFormGroup.get("supplierId"))==null?null:s.invalid)&&(((s=o.purchaseFormGroup.get("supplierId"))==null?null:s.dirty)||((s=o.purchaseFormGroup.get("supplierId"))==null?null:s.touched))&&((s=o.purchaseFormGroup.get("supplierId"))==null?null:s.getError("required"))),p(2),c("required",!0),p(3),c("ngForOf",o.moneySources),p(),c("ngIf",((f=o.purchaseFormGroup.get("moneySourceId"))==null?null:f.invalid)&&(((f=o.purchaseFormGroup.get("moneySourceId"))==null?null:f.dirty)||((f=o.purchaseFormGroup.get("moneySourceId"))==null?null:f.touched))&&((f=o.purchaseFormGroup.get("moneySourceId"))==null?null:f.getError("required"))),p(3),c("required",!0),p(3),c("ngIf",((F=o.purchaseFormGroup.get("cost"))==null?null:F.invalid)&&(((F=o.purchaseFormGroup.get("cost"))==null?null:F.dirty)||((F=o.purchaseFormGroup.get("cost"))==null?null:F.touched))&&((F=o.purchaseFormGroup.get("cost"))==null?null:F.getError("required"))),p(2),c("required",!0),p(3),c("ngIf",((w=o.purchaseFormGroup.get("payment"))==null?null:w.invalid)&&(((w=o.purchaseFormGroup.get("payment"))==null?null:w.dirty)||((w=o.purchaseFormGroup.get("payment"))==null?null:w.touched))&&((w=o.purchaseFormGroup.get("payment"))==null?null:w.getError("required"))),p(3),c("required",!0),p(3),c("ngIf",((I=o.purchaseFormGroup.get("totalQuantity"))==null?null:I.invalid)&&(((I=o.purchaseFormGroup.get("totalQuantity"))==null?null:I.dirty)||((I=o.purchaseFormGroup.get("totalQuantity"))==null?null:I.touched))&&((I=o.purchaseFormGroup.get("totalQuantity"))==null?null:I.getError("required"))),p(2),c("required",!0),p(3),c("ngIf",((V=o.purchaseFormGroup.get("totalAmount"))==null?null:V.invalid)&&(((V=o.purchaseFormGroup.get("totalAmount"))==null?null:V.dirty)||((V=o.purchaseFormGroup.get("totalAmount"))==null?null:V.touched))&&((V=o.purchaseFormGroup.get("totalAmount"))==null?null:V.getError("required"))),p(10),c("ngForOf",o.items.controls)}},dependencies:[X,P,R,te,ie,Y,ve,ee,q,A,H,L,mt,st,O,dt,j,Fe,$,Q,re,Ee,ht],encapsulation:2});let e=l;return e})();var Qt=["firstFocused"];function jt(e,l){if(e&1&&(y(0),n(1,"option",45),m(2),i(),x()),e&2){let a=l.$implicit;p(),c("value",a.id),p(),C(a.name)}}function Ut(e,l){if(e&1&&(y(0),n(1,"option",45),m(2),i(),x()),e&2){let a=l.$implicit;p(),c("value",a.id),p(),C(a.label)}}function Wt(e,l){if(e&1){let a=E();n(0,"div",34)(1,"div",35)(2,"span"),m(3,"Filtrer"),i(),n(4,"button",36),_("click",function(){S(a);let r=h();return v(r.toggleFilterMenu())}),u(5,"i",37),i()(),n(6,"form",38)(7,"my-form-field")(8,"my-label"),m(9,"Fournisseur"),i(),n(10,"select",39),d(11,jt,3,2,"ng-container",40),i()(),n(12,"my-form-field")(13,"my-label",41),m(14,"Source d'argent"),i(),n(15,"select",42),d(16,Ut,3,2,"ng-container",40),i()()(),n(17,"div",43)(18,"button",44),_("click",function(){S(a);let r=h();return v(r.resetItemsFilterForm())}),m(19,"R\xE9initialiser"),i(),n(20,"button",11),_("click",function(){S(a);let r=h();return v(r.filterItems())}),m(21,"Appliquer"),i()()()}if(e&2){let a=h();p(6),c("formGroup",a.purchaseFilterFormGroup),p(5),c("ngForOf",a.suppliers),p(2),c("required",!0),p(3),c("ngForOf",a.moneySources)}}function Jt(e,l){if(e&1){let a=E();n(0,"button",46),_("click",function(){S(a);let r=h();return v(r.deleteSeleted())}),n(1,"div",47),u(2,"i",48),n(3,"span"),m(4),i()()()}if(e&2){let a=h();p(4),D("Supprimer (",a.selection.selected.length,")")}}function Kt(e,l){if(e&1){let a=E();n(0,"th",49)(1,"mat-checkbox",50),_("change",function(r){S(a);let o=h();return v(o.allSelectionChanged(r))}),i()()}if(e&2){let a=h();p(),c("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Zt(e,l){if(e&1){let a=E();n(0,"td",51)(1,"mat-checkbox",52),_("click",function(r){return r.stopPropagation()})("change",function(r){let s=S(a).$implicit,f=h();return v(f.selectionChanged(r,s))}),i()()}if(e&2){let a=l.$implicit,t=h();p(),c("checked",t.selection.isSelected(a))("aria-label",t.checkboxLabel(a))}}function Xt(e,l){e&1&&(n(0,"th",49),m(1,"Code "),i())}function Yt(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.code)}}function ei(e,l){e&1&&(n(0,"th",49),m(1,"Fournisseur "),i())}function ti(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.supplierId.name)}}function ii(e,l){e&1&&(n(0,"th",49),m(1,"Source d'argent "),i())}function ri(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.moneySourceId.label)}}function ni(e,l){e&1&&(n(0,"th",49),m(1,"Co\xFBt"),i())}function oi(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.cost)}}function li(e,l){e&1&&(n(0,"th",49),m(1,"Versement"),i())}function ai(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.payment)}}function mi(e,l){e&1&&(n(0,"th",49),m(1,"Quantit\xE9"),i())}function si(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.totalQuantity)}}function pi(e,l){e&1&&(n(0,"th",49),m(1,"Montant"),i())}function ci(e,l){if(e&1&&(n(0,"td",51),m(1),i()),e&2){let a=l.$implicit;p(),C(a.totalAmount)}}function ui(e,l){e&1&&(n(0,"th",49),m(1,"Date"),i())}function di(e,l){if(e&1&&(n(0,"td",51),m(1),_e(2,"date"),i()),e&2){let a=l.$implicit;p(),C(ge(2,1,a.date,"dd/MM/yyyy"))}}function fi(e,l){e&1&&(n(0,"th",53),m(1,"Action"),i())}function hi(e,l){if(e&1){let a=E();n(0,"td",51)(1,"div",54)(2,"button",55),u(3,"i",56),i(),n(4,"button",57),_("click",function(){let o=S(a).$implicit,s=h();return v(s.deleteItem(o))}),u(5,"i",58),i(),n(6,"button",57),_("click",function(){let o=S(a).$implicit,s=h();return v(s.newItem("edit",o.id))}),u(7,"i",59),i()()()}if(e&2){let a=l.$implicit,t=h();p(2),c("matTooltip",t.getTracabilityInfo(a))}}function _i(e,l){e&1&&u(0,"tr",60)}function gi(e,l){if(e&1){let a=E();n(0,"tr",61),_("dblclick",function(){let o=S(a).$implicit,s=h();return v(s.newItem("edit",o.id))}),i()}}function yi(e,l){e&1&&(n(0,"div",62)(1,"p",63),m(2,"Aucune donn\xE9e \xE0 afficher"),i()())}var rt=(()=>{let l=class l{isAllSelected(){let t=this.selection.selected.length,r=this.dataSource.data.length;return t===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,r,o,s,f,F,w){this.purchasesHttp=t,this.snackBar=r,this.fb=o,this.matDialog=s,this.traceability=f,this.suppliersHttp=F,this.moneySourcesHttp=w,this.dataSource=new ze([]),this.displayedColumns=["select","code","supplierId.name","moneySourceId.label","cost","payment","totalQuantity","totalAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.purchaseFilterChanged=new Z,this.pageSize=ne.pagination.pageSize,this.purchases=[],this.selection=new xe(!0,[]),this.showFirstLastButtons=ne.pagination.showFirstLastButtons,this.moneySources=[],this.suppliers=[],this.purchaseFilterFormGroup=this.fb.group({supplierId:[void 0],moneySourceId:[void 0]})}ngOnInit(){this.suppliersHttp.getAll().subscribe({next:t=>{this.suppliers=t}}),this.moneySourcesHttp.getAll().subscribe({next:t=>{this.moneySources=t}})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.purchaseFilterChanged).pipe(ce({}),ue(()=>(this.isLoadingResults=!0,this.purchasesHttp.paginate(this.getFilterQuery).pipe(pe(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Ie(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",r=0){this.matDialog.open(it,{data:{id:r,mode:t},minWidth:"97vw",minHeight:"97vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:o=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.purchaseFilterChanged.emit()}resetItemsFilterForm(){this.purchaseFilterFormGroup.reset({supplierId:void 0,moneySourceId:void 0}),this.purchaseFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,r){t&&this.selection.toggle(r)}deleteMany(t){let r=new URLSearchParams;t.forEach(s=>{r.append("id",s.id.toString())});let o=`?${r.toString()}`;this.purchasesHttp.deleteMany(o).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let t=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,supplierId:this.purchaseFilterFormGroup.get("supplierId")?.value,moneySourceId:this.purchaseFilterFormGroup.get("moneySourceId")?.value};return M(r.pageIndex)&&t.append("pageIndex",r.pageIndex.toString()),M(r.pageSize)&&t.append("pageSize",r.pageSize.toString()),t.append("order","DESC"),M(r.supplierId)&&t.append("supplierId",r.supplierId),M(r.moneySourceId)&&t.append("moneySourceId",r.moneySourceId),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};l.\u0275fac=function(r){return new(r||l)(g($e),g(U),g(z),g(Te),g(we),g(J),g(Be))},l.\u0275cmp=N({type:l,selectors:[["app-purchases-grid"]],viewQuery:function(r,o){if(r&1&&(k(B,5),k(W,5),k(Qt,5)),r&2){let s;G(s=T())&&(o.paginator=s.first),G(s=T())&&(o.sort=s.first),G(s=T())&&(o.firstFocused=s.first)}},decls:57,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","supplierId.name"],["matColumnDef","moneySourceId.label"],["matColumnDef","cost"],["matColumnDef","payment"],["matColumnDef","totalQuantity"],["matColumnDef","totalAmount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","supplierId","myInput","","size","small"],[4,"ngFor","ngForOf"],[3,"required"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Achats"),i()(),n(4,"div",2)(5,"div",3)(6,"button",4,5),_("click",function(){return o.toggleFilterMenu()}),n(8,"div",6),u(9,"i",7),n(10,"span"),m(11,"FILTRE"),i()()(),d(12,Wt,22,4,"ng-template",8),_("backdropClick",function(){return o.toggleFilterMenu()}),i(),n(13,"div",9),d(14,Jt,5,1,"button",10),n(15,"button",11),_("click",function(){return o.newItem()}),n(16,"div",12),u(17,"i",13),n(18,"span",14),m(19,"Achat"),i()()()()(),n(20,"div")(21,"div",15)(22,"table",16),y(23,17),d(24,Kt,2,3,"th",18)(25,Zt,2,2,"td",19),x(),y(26,20),d(27,Xt,2,0,"th",18)(28,Yt,2,1,"td",19),x(),y(29,21),d(30,ei,2,0,"th",18)(31,ti,2,1,"td",19),x(),y(32,22),d(33,ii,2,0,"th",18)(34,ri,2,1,"td",19),x(),y(35,23),d(36,ni,2,0,"th",18)(37,oi,2,1,"td",19),x(),y(38,24),d(39,li,2,0,"th",18)(40,ai,2,1,"td",19),x(),y(41,25),d(42,mi,2,0,"th",18)(43,si,2,1,"td",19),x(),y(44,26),d(45,pi,2,0,"th",18)(46,ci,2,1,"td",19),x(),y(47,27),d(48,ui,2,0,"th",18)(49,di,3,4,"td",19),x(),y(50,28),d(51,fi,2,0,"th",29)(52,hi,8,1,"td",19),x(),d(53,_i,1,0,"tr",30)(54,gi,1,0,"tr",31),i(),d(55,yi,3,0,"div",32),i(),u(56,"mat-paginator",33),i()()),r&2){let s=he(7);p(12),c("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",o.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),p(2),c("ngIf",o.selection.selected.length>0),p(8),c("dataSource",o.dataSource),p(31),c("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),p(),c("matRowDefColumns",o.displayedColumns),p(),c("ngIf",o.dataSource.data.length==0),p(),c("showFirstLastButtons",o.showFirstLastButtons)("length",o.resultsLength)("pageSize",o.pageSize)}},dependencies:[X,P,R,te,ie,ee,q,A,H,L,be,O,ye,Me,Ve,De,Ae,Pe,Ne,Re,Oe,qe,He,Le,B,W,Se,Ce,j,$,Q,at],styles:[`app-purchases-grid{display:flex;flex:1}
`],encapsulation:2});let e=l;return e})();var xi=["firstFocused"];function Ci(e,l){if(e&1&&u(0,"my-global-errors",30),e&2){let a=h();c("errors",a.errors)}}function Si(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function vi(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function bi(e,l){if(e&1&&(y(0),n(1,"option",31),m(2),i(),x()),e&2){let a=l.$implicit;p(),c("value",a.code),p(),C(a.name)}}var nt=(()=>{let l=class l{constructor(t,r,o,s,f){this.fb=t,this.dialogRef=r,this.data=o,this.suppliersHttp=s,this.snackBar=f,this.errors=[],this.provinces=ct,this.supplierFormGroup=this.fb.group({id:[void 0],code:[""],name:["",[b.required]],debt:[0,[b.required]],postalCode:[""],province:[""],city:[""],address:[""],phoneNumberOne:[""],phoneNumberTow:[""],fax:[""],email:[""],website:[""],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(t){this.suppliersHttp.getOneById(t).subscribe({next:r=>{this.supplierFormGroup.patchValue({id:r.id,code:r.code,name:r.name,debt:r.debt,postalCode:r.postalCode,province:r.province,city:r.city,address:r.address,phoneNumberOne:r.phoneNumberOne,phoneNumberTow:r.phoneNumberTow,fax:r.fax,email:r.email,website:r.website,notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.supplierFormGroup.valid==!0?this.data.mode=="creation"?this.suppliersHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.suppliersHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.supplierFormGroup.markAllAsTouched()}resetForm(){this.supplierFormGroup.reset({id:void 0,code:"",name:"",debt:0,postalCode:"",province:"",city:"",address:"",phoneNumberOne:"",phoneNumberTow:"",fax:"",email:"",website:"",notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.supplierFormGroup.markAsUntouched(),this.supplierFormGroup.clearValidators(),this.supplierFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.supplierFormGroup.getRawValue())}getUpdate(){return K({},this.supplierFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(z),g(ke),g(Ge),g(J),g(U))},l.\u0275cmp=N({type:l,selectors:[["app-supplier-form"]],viewQuery:function(r,o){if(r&1&&k(xi,5),r&2){let s;G(s=T())&&(o.firstFocused=s.first)}},decls:75,vars:8,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","name","type","text","myInput",""],[4,"ngIf"],["formControlName","debt","type","number","myInput",""],["formControlName","province","myInput",""],[4,"ngFor","ngForOf"],["formControlName","city","type","text","myInput",""],["formControlName","address","type","text","myInput",""],["formControlName","phoneNumberOne","type","text","myInput",""],["formControlName","phoneNumberTow","type","text","myInput",""],["formControlName","fax","type","text","myInput",""],["formControlName","postalCode","type","text","myInput",""],["formControlName","email","type","email","myInput",""],["formControlName","website","type","text","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2),m(3),i(),n(4,"button",3),_("click",function(){return o.closeDialog()}),u(5,"i",4),i()(),d(6,Ci,1,1,"my-global-errors",5),n(7,"div",6)(8,"form",7),u(9,"input",8),n(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),i(),u(14,"input",10,11),i(),n(16,"my-form-field")(17,"my-label",12),m(18,"Nom"),i(),u(19,"input",13),d(20,Si,2,0,"my-error",14),i(),n(21,"my-form-field")(22,"my-label",12),m(23,"Dette"),i(),u(24,"input",15),d(25,vi,2,0,"my-error",14),i()(),n(26,"div",9)(27,"my-form-field")(28,"my-label"),m(29,"Wilaya"),i(),n(30,"select",16),d(31,bi,3,2,"ng-container",17),i()(),n(32,"my-form-field")(33,"my-label"),m(34,"Ville"),i(),u(35,"input",18),i()(),n(36,"my-form-field")(37,"my-label"),m(38,"Adresse"),i(),u(39,"input",19),i(),n(40,"div",9)(41,"my-form-field")(42,"my-label"),m(43,"Num-T\xE9l 1"),i(),u(44,"input",20),i(),n(45,"my-form-field")(46,"my-label"),m(47,"Num-T\xE9l 2"),i(),u(48,"input",21),i(),n(49,"my-form-field")(50,"my-label"),m(51,"Fax"),i(),u(52,"input",22),i()(),n(53,"div",9)(54,"my-form-field")(55,"my-label"),m(56,"Code postal"),i(),u(57,"input",23),i(),n(58,"my-form-field")(59,"my-label"),m(60,"Email"),i(),u(61,"input",24),i(),n(62,"my-form-field")(63,"my-label"),m(64,"Site web"),i(),u(65,"input",25),i()(),n(66,"my-form-field")(67,"my-label"),m(68,"Notes"),i(),u(69,"textarea",26),i()()(),n(70,"div",27)(71,"button",28),_("click",function(){return o.create()}),m(72,"Nouveau "),i(),n(73,"button",29),_("click",function(){return o.save()}),m(74,"Sauvegarder"),i()()()),r&2){let s,f;p(3),D(" ",o.data.mode=="creation"?"Nouveau ":"Modifier "," fournisseur "),p(3),c("ngIf",o.errors.length>0),p(2),c("formGroup",o.supplierFormGroup),p(9),c("required",!0),p(3),c("ngIf",((s=o.supplierFormGroup.get("name"))==null?null:s.invalid)&&(((s=o.supplierFormGroup.get("name"))==null?null:s.dirty)||((s=o.supplierFormGroup.get("name"))==null?null:s.touched))&&((s=o.supplierFormGroup.get("name"))==null?null:s.getError("required"))),p(2),c("required",!0),p(3),c("ngIf",((f=o.supplierFormGroup.get("debt"))==null?null:f.invalid)&&(((f=o.supplierFormGroup.get("debt"))==null?null:f.dirty)||((f=o.supplierFormGroup.get("debt"))==null?null:f.touched))&&((f=o.supplierFormGroup.get("debt"))==null?null:f.getError("required"))),p(6),c("ngForOf",o.provinces)}},dependencies:[X,P,R,te,ie,Y,ve,ee,q,A,H,L,O,j,Fe,$,Q,re,Ee],encapsulation:2});let e=l;return e})();var Fi=["firstFocused"];function Ei(e,l){e&1&&(n(0,"my-error"),m(1," Veuillez remplir ce champ. "),i())}function wi(e,l){if(e&1){let a=E();n(0,"div",32)(1,"div",33)(2,"span"),m(3,"Filtrer"),i(),n(4,"button",34),_("click",function(){S(a);let r=h();return v(r.toggleFilterMenu())}),u(5,"i",35),i()(),n(6,"form",36)(7,"my-form-field")(8,"my-label"),m(9,"Nom *"),i(),u(10,"input",37,38),d(12,Ei,2,0,"my-error",39),i()(),n(13,"div",40)(14,"button",41),_("click",function(){S(a);let r=h();return v(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),i(),n(16,"button",11),_("click",function(){S(a);let r=h();return v(r.filterItems())}),m(17,"Appliquer"),i()()()}if(e&2){let a=h(),t;p(6),c("formGroup",a.supplierFilterFormGroup),p(6),c("ngIf",((t=a.supplierFilterFormGroup.get("name"))==null?null:t.invalid)&&(((t=a.supplierFilterFormGroup.get("name"))==null?null:t.dirty)||((t=a.supplierFilterFormGroup.get("name"))==null?null:t.touched))&&((t=a.supplierFilterFormGroup.get("name"))==null?null:t.getError("required")))}}function Ii(e,l){if(e&1){let a=E();n(0,"button",42),_("click",function(){S(a);let r=h();return v(r.deleteSeleted())}),n(1,"div",43),u(2,"i",44),n(3,"span"),m(4),i()()()}if(e&2){let a=h();p(4),D("Supprimer (",a.selection.selected.length,")")}}function ki(e,l){if(e&1){let a=E();n(0,"th",45)(1,"mat-checkbox",46),_("change",function(r){S(a);let o=h();return v(o.allSelectionChanged(r))}),i()()}if(e&2){let a=h();p(),c("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Gi(e,l){if(e&1){let a=E();n(0,"td",47)(1,"mat-checkbox",48),_("click",function(r){return r.stopPropagation()})("change",function(r){let s=S(a).$implicit,f=h();return v(f.selectionChanged(r,s))}),i()()}if(e&2){let a=l.$implicit,t=h();p(),c("checked",t.selection.isSelected(a))("aria-label",t.checkboxLabel(a))}}function Ti(e,l){e&1&&(n(0,"th",45),m(1,"Code "),i())}function Mi(e,l){if(e&1&&(n(0,"td",47),m(1),i()),e&2){let a=l.$implicit;p(),C(a.code)}}function Vi(e,l){e&1&&(n(0,"th",45),m(1,"Nom "),i())}function Ni(e,l){if(e&1&&(n(0,"td",47),m(1),_e(2,"myLimitTextLength"),i()),e&2){let a=l.$implicit;p(),C(ge(2,1,a.name,30))}}function Di(e,l){e&1&&(n(0,"th",45),m(1,"Dette "),i())}function Pi(e,l){if(e&1&&(n(0,"td",47),m(1),i()),e&2){let a=l.$implicit;p(),C(a.debt)}}function Oi(e,l){e&1&&(n(0,"th",45),m(1,"Num-T\xE9l 1"),i())}function qi(e,l){if(e&1&&(n(0,"td",47),m(1),i()),e&2){let a=l.$implicit;p(),C(a.phoneNumberOne)}}function Ai(e,l){e&1&&(n(0,"th",45),m(1,"Num-T\xE9l 2"),i())}function Ri(e,l){if(e&1&&(n(0,"td",47),m(1),i()),e&2){let a=l.$implicit;p(),C(a.phoneNumberTow)}}function Hi(e,l){e&1&&(n(0,"th",45),m(1,"Notes"),i())}function Li(e,l){if(e&1&&(n(0,"td",47),m(1),i()),e&2){let a=l.$implicit;p(),C(a.notes)}}function zi(e,l){e&1&&(n(0,"th",49),m(1,"Action"),i())}function Bi(e,l){if(e&1){let a=E();n(0,"td",47)(1,"div",50)(2,"button",51),u(3,"i",52),i(),n(4,"button",53),_("click",function(){let o=S(a).$implicit,s=h();return v(s.deleteItem(o))}),u(5,"i",54),i(),n(6,"button",53),_("click",function(){let o=S(a).$implicit,s=h();return v(s.newItem("edit",o.id))}),u(7,"i",55),i()()()}if(e&2){let a=l.$implicit,t=h();p(2),c("matTooltip",t.getTracabilityInfo(a))}}function $i(e,l){e&1&&u(0,"tr",56)}function Qi(e,l){if(e&1){let a=E();n(0,"tr",57),_("dblclick",function(){let o=S(a).$implicit,s=h();return v(s.newItem("edit",o.id))}),i()}}function ji(e,l){e&1&&(n(0,"div",58)(1,"p",59),m(2,"Aucune donn\xE9e \xE0 afficher"),i()())}var ot=(()=>{let l=class l{isAllSelected(){let t=this.selection.selected.length,r=this.dataSource.data.length;return t===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,r,o,s,f){this.suppliersHttp=t,this.snackBar=r,this.fb=o,this.matDialog=s,this.traceability=f,this.dataSource=new ze([]),this.displayedColumns=["select","code","name","debt","phoneNumberOne","phoneNumberTow","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.supplierFilterChanged=new Z,this.pageSize=ne.pagination.pageSize,this.suppliers=[],this.selection=new xe(!0,[]),this.showFirstLastButtons=ne.pagination.showFirstLastButtons,this.supplierFilterFormGroup=this.fb.group({name:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.supplierFilterChanged).pipe(ce({}),ue(()=>(this.isLoadingResults=!0,this.suppliersHttp.paginate(this.getFilterQuery).pipe(pe(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Ie(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",r=0){this.matDialog.open(nt,{data:{id:r,mode:t},minWidth:"512px",minHeight:"90vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:o=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.supplierFilterChanged.emit()}resetItemsFilterForm(){this.supplierFilterFormGroup.reset({name:""}),this.supplierFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,r){t&&this.selection.toggle(r)}deleteMany(t){let r=new URLSearchParams;t.forEach(s=>{r.append("id",s.id.toString())});let o=`?${r.toString()}`;this.suppliersHttp.deleteMany(o).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let t=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,name:this.supplierFilterFormGroup.get("name")?.value};return M(r.pageIndex)&&t.append("pageIndex",r.pageIndex.toString()),M(r.pageSize)&&t.append("pageSize",r.pageSize.toString()),t.append("order","DESC"),M(r.name)&&t.append("name",r.name),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};l.\u0275fac=function(r){return new(r||l)(g(J),g(U),g(z),g(Te),g(we))},l.\u0275cmp=N({type:l,selectors:[["app-suppliers-grid"]],viewQuery:function(r,o){if(r&1&&(k(B,5),k(W,5),k(Fi,5)),r&2){let s;G(s=T())&&(o.paginator=s.first),G(s=T())&&(o.sort=s.first),G(s=T())&&(o.firstFocused=s.first)}},decls:51,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","name"],["matColumnDef","debt"],["matColumnDef","phoneNumberOne"],["matColumnDef","phoneNumberTow"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","name","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,o){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Achats / Fournisseurs"),i()(),n(4,"div",2)(5,"div",3)(6,"button",4,5),_("click",function(){return o.toggleFilterMenu()}),n(8,"div",6),u(9,"i",7),n(10,"span"),m(11,"FILTRE"),i()()(),d(12,wi,18,2,"ng-template",8),_("backdropClick",function(){return o.toggleFilterMenu()}),i(),n(13,"div",9),d(14,Ii,5,1,"button",10),n(15,"button",11),_("click",function(){return o.newItem()}),n(16,"div",12),u(17,"i",13),n(18,"span",14),m(19,"Fournisseur"),i()()()()(),n(20,"div")(21,"div",15)(22,"table",16),y(23,17),d(24,ki,2,3,"th",18)(25,Gi,2,2,"td",19),x(),y(26,20),d(27,Ti,2,0,"th",18)(28,Mi,2,1,"td",19),x(),y(29,21),d(30,Vi,2,0,"th",18)(31,Ni,3,4,"td",19),x(),y(32,22),d(33,Di,2,0,"th",18)(34,Pi,2,1,"td",19),x(),y(35,23),d(36,Oi,2,0,"th",18)(37,qi,2,1,"td",19),x(),y(38,24),d(39,Ai,2,0,"th",18)(40,Ri,2,1,"td",19),x(),y(41,25),d(42,Hi,2,0,"th",18)(43,Li,2,1,"td",19),x(),y(44,26),d(45,zi,2,0,"th",27)(46,Bi,8,1,"td",19),x(),d(47,$i,1,0,"tr",28)(48,Qi,1,0,"tr",29),i(),d(49,ji,3,0,"div",30),i(),u(50,"mat-paginator",31),i()()),r&2){let s=he(7);p(12),c("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",o.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),p(2),c("ngIf",o.selection.selected.length>0),p(8),c("dataSource",o.dataSource),p(25),c("matHeaderRowDef",o.displayedColumns)("matHeaderRowDefSticky",!0),p(),c("matRowDefColumns",o.displayedColumns),p(),c("ngIf",o.dataSource.data.length==0),p(),c("showFirstLastButtons",o.showFirstLastButtons)("length",o.resultsLength)("pageSize",o.pageSize)}},dependencies:[P,R,Y,q,A,H,L,be,O,ye,Me,Ve,De,Ae,Pe,Ne,Re,Oe,qe,He,Le,B,W,Se,Ce,j,$,Q,re,ut],styles:[`app-suppliers-grid{display:flex;flex:1}
`],encapsulation:2});let e=l;return e})();var Ui=[{path:"",redirectTo:"purchases",pathMatch:"full"},{path:"purchases",component:rt},{path:"suppliers",component:ot}],yt=(()=>{let l=class l{};l.\u0275fac=function(r){return new(r||l)},l.\u0275mod=fe({type:l}),l.\u0275inj=de({imports:[Qe.forChild(Ui),Qe]});let e=l;return e})();var Qr=(()=>{let l=class l{};l.\u0275fac=function(r){return new(r||l)},l.\u0275mod=fe({type:l}),l.\u0275inj=de({imports:[_t,yt]});let e=l;return e})();export{Qr as PurchasesModule};
