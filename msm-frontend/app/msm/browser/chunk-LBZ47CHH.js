import{a as X}from"./chunk-O36OTMU2.js";import{$a as ve,$b as lt,A as u,Aa as _e,Ab as qe,B as c,Ba as he,Bb as Oe,C as o,Ca as ge,Cb as Ae,D as r,Da as ee,Db as Ne,E as p,Ea as y,Eb as U,F as b,Fa as q,G as x,Ga as O,H as I,Ha as A,I as h,Ia as ye,J as _,Ja as N,K as k,Ka as tt,L as G,La as it,M as D,Ma as H,N as pe,Na as te,Nb as ot,O as d,Oa as ie,P as F,Pa as re,Q as M,Qa as L,Ra as be,Ta as z,Tb as W,U as Xe,Ua as Q,Ub as oe,Va as $,W as Ye,Wa as B,Xa as ne,Ya as xe,Z as Y,Za as Ce,_ as V,a as K,aa as et,ab as rt,ac as at,bb as Se,cb as Fe,d as ae,db as R,e as me,ec as mt,f as Je,fb as J,g as se,gc as gt,h as de,ib as Ee,j as ce,jb as we,k as ue,kb as Ie,lb as j,mb as nt,n as Ke,p as T,pa as st,q as Ze,r as C,s as v,sb as ke,tb as Ge,ub as De,v as s,vb as Re,w as g,wb as Te,xb as Me,y as Z,ya as P,yb as Ve,za as fe,zb as Pe}from"./chunk-J3ZMDLLJ.js";var Gt=["firstFocused"];function Dt(e,a){if(e&1&&p(0,"my-global-errors",33),e&2){let l=_();c("errors",l.errors)}}function Rt(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function Tt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Mt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Vt(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function Pt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function qt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Ot(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function At(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit,t=_(2);s(),c("value",l.id),s(),F(t.getStockInfo(l))}}function Nt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Ht(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Lt(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function zt(e,a){e&1&&(o(0,"div",47)(1,"div",48),p(2,"div",49),r()())}function Qt(e,a){if(e&1){let l=I();o(0,"button",50),h("click",function(){C(l);let n=_().index,i=_();return v(i.removeItem(n))}),p(1,"i",51),r()}}function $t(e,a){if(e&1){let l=I();o(0,"button",50),h("click",function(){C(l);let n=_().index,i=_();return v(i.recoverItem(n))}),p(1,"i",52),r()}}function Bt(e,a){if(e&1&&(o(0,"div",35)(1,"div",36),p(2,"input",8)(3,"input",37)(4,"input",38),o(5,"my-form-field",39)(6,"my-label",13),d(7,"Stock"),r(),o(8,"select",40),u(9,At,3,2,"ng-container",15),r()(),o(10,"my-form-field",41)(11,"my-label",13),d(12,"Quantit\xE9"),r(),p(13,"input",42),u(14,Nt,2,0,"my-error",16),r(),o(15,"my-form-field",41)(16,"my-label",13),d(17,"Prix de vente"),r(),p(18,"input",43),u(19,Ht,2,0,"my-error",16),r(),o(20,"my-form-field",41)(21,"my-label",13),d(22,"Montant"),r(),p(23,"input",44),u(24,Lt,2,0,"my-error",16),r(),u(25,zt,3,0,"div",45),r(),u(26,Qt,2,0,"button",46)(27,$t,2,0,"button",46),r()),e&2){let l=a.$implicit,t=a.index,n=_(),i,m,f,S,E,w;c("formGroupName",t),s(6),c("required",!0),s(3),c("ngForOf",n.stocks),s(2),c("required",!0),s(3),c("ngIf",((i=l.get("quantity"))==null?null:i.invalid)&&(((i=l.get("quantity"))==null?null:i.dirty)||((i=l.get("quantity"))==null?null:i.touched))&&((i=l.get("quantity"))==null?null:i.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((m=l.get("salePrice"))==null?null:m.invalid)&&(((m=l.get("salePrice"))==null?null:m.dirty)||((m=l.get("salePrice"))==null?null:m.touched))&&((m=l.get("salePrice"))==null?null:m.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((f=l.get("amount"))==null?null:f.invalid)&&(((f=l.get("amount"))==null?null:f.dirty)||((f=l.get("amount"))==null?null:f.touched))&&((f=l.get("amount"))==null?null:f.getError("required"))),s(),c("ngIf",((S=l.get("mode"))==null?null:S.value)=="deletion"),s(),c("ngIf",((E=l.get("mode"))==null?null:E.value)!="deletion"),s(),c("ngIf",((w=l.get("mode"))==null?null:w.value)=="deletion")}}var ct=(()=>{let a=class a{get items(){return this.distributionFormGroup.get("items")}constructor(t,n,i,m,f,S,E,w){this.fb=t,this.dialogRef=n,this.data=i,this.snackBar=m,this.distributionsHttp=f,this.premisesHttp=S,this.moneySourcesHttp=E,this.stocksHttp=w,this.errors=[],this.premises=[],this.moneySources=[],this.stocks=[],this.distributionFormGroup=this.fb.group({id:[void 0],code:[""],cash:[0,[y.required]],totalQuantity:[{value:0,disabled:!0},[y.required]],totalAmount:[{value:0,disabled:!0},[y.required]],moneySourceId:[void 0,[y.required]],premiseId:[void 0,[y.required]],date:[Se(),[y.required]],notes:[""],items:this.fb.array([])})}ngOnInit(){Je([this.premisesHttp.getAll(),this.moneySourcesHttp.getAll(),this.stocksHttp.getAll()]).subscribe({next:([t,n,i])=>{this.premises=t,this.moneySources=n,this.stocks=i,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChaged()}loadData(t){this.distributionsHttp.getOneById(t).subscribe({next:n=>{this.distributionFormGroup.patchValue({id:n.id,code:n.code,cash:n.cash,totalQuantity:n.totalQuantity,totalAmount:n.totalAmount,moneySourceId:n.moneySourceId.id,premiseId:n.premiseId.id,date:rt(n.date),notes:n.notes}),this.items.clear(),n.items.forEach(i=>{this.items.push(this.fb.group({id:[i.id],stockId:[i.stockId.id,[y.required]],quantity:[i.quantity,[y.required]],salePrice:[i.salePrice,[y.required]],amount:[{value:i.amount,disabled:!0},[y.required]],mode:["update",[y.required]],oldMode:["update",[y.required]]}))})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.distributionFormGroup.valid==!0?this.data.mode=="creation"?this.distributionsHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.distributionsHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.distributionFormGroup.markAllAsTouched()}resetForm(){this.distributionFormGroup.reset({id:void 0,code:"",cash:0,totalQuantity:0,totalAmount:0,moneySourceId:0,premiseId:0,date:Se(),notes:""},{emitEvent:!1}),this.items.clear()}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.distributionFormGroup.markAsUntouched(),this.distributionFormGroup.clearValidators(),this.distributionFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.distributionFormGroup.getRawValue())}getUpdate(){return K({},this.distributionFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}createItem(){this.items.push(this.fb.group({id:[void 0],stockId:[void 0,[y.required]],quantity:[0,[y.required]],salePrice:[0,[y.required]],amount:[{value:0,disabled:!0},[y.required]],mode:["creation",[y.required]],oldMode:["creation",[y.required]]}))}removeItem(t){this.data.mode=="edit"?this.items.at(t).get("mode")?.setValue("deletion"):this.items.removeAt(t)}recoverItem(t){let n=this.items.at(t).get("oldMode")?.value;this.items.at(t).get("mode")?.setValue(n)}getStockInfo(t){return`${t.label} - ${t.categoryId?.label} - ${t.familyId?.label} *** Un stock avec une Quantit\xE9 de ${t.quantity} KG et Prix de distribution : ${t.salePrice}`}handleFormChaged(){this.distributionFormGroup.valueChanges.subscribe({next:t=>{let n=t?.items,i=0,m=0;n.forEach((f,S)=>{this.items.at(S).get("amount")?.setValue(J(f.quantity)*J(f.salePrice),{emitEvent:!1})}),n.forEach((f,S)=>{i+=J(f.quantity),m+=J(this.items.at(S).get("amount")?.value)}),this.distributionFormGroup.get("totalQuantity")?.setValue(i,{emitEvent:!1}),this.distributionFormGroup.get("totalAmount")?.setValue(m,{emitEvent:!1})}})}};a.\u0275fac=function(n){return new(n||a)(g(L),g(Ee),g(we),g(j),g(lt),g(W),g(oe),g(ot))},a.\u0275cmp=T({type:a,selectors:[["app-distribution-form"]],viewQuery:function(n,i){if(n&1&&k(Gt,5),n&2){let m;G(m=D())&&(i.firstFocused=m.first)}},decls:65,vars:16,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-3","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2","w-96"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],[3,"required"],["formControlName","premiseId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"flex","flex-col","gap-y-2","w-64"],["formControlName","cash","type","number","myInput","","size","small"],["formControlName","moneySourceId","myInput","","size","small"],["formControlName","totalQuantity","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"!-mt-1"],["formControlName","notes","myTextarea","","type","text"],["formArrayName","items"],[1,"mb-1"],[1,"flex","flex-col","mt-2"],["class","flex flex-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",1,"mt-2",3,"click"],[1,"ri-add-line","text-lg"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"],[1,"flex","flex-row",3,"formGroupName"],[1,"relative","flex","flex-row","gap-x-2"],["formControlName","mode","type","text",1,"!hidden"],["formControlName","oldMode","type","text",1,"!hidden"],[1,"w-[400px]"],["formControlName","stockId","myInput","","size","small"],[1,"w-48"],["formControlName","quantity","type","number","myInput","","size","small"],["formControlName","salePrice","type","number","myInput","","size","small"],["formControlName","amount","type","number","myInput","","size","small","myCalculableField",""],["class","absolute w-full h-full",4,"ngIf"],["class","mx-3 mt-2",3,"click",4,"ngIf"],[1,"absolute","w-full","h-full"],[1,"relative","h-full","bg-[rgba(255,0,0,0.05)]"],[1,"absolute","w-full","my-auto","top-0","bottom-0","h-[0.06rem]","bg-red-500"],[1,"mx-3","mt-2",3,"click"],[1,"ri-delete-bin-6-line","text-lg","text-red-500"],[1,"ri-device-recover-line","text-lg","text-blue-500"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),d(3),r(),o(4,"button",3),h("click",function(){return i.closeDialog()}),p(5,"i",4),r()(),u(6,Dt,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),p(9,"input",8),o(10,"div",9)(11,"div",10)(12,"my-form-field")(13,"my-label"),d(14,"Code"),r(),p(15,"input",11,12),r(),o(17,"my-form-field")(18,"my-label",13),d(19,"Local"),r(),o(20,"select",14),u(21,Rt,3,2,"ng-container",15),r(),u(22,Tt,2,0,"my-error",16),r()(),o(23,"div",17)(24,"my-form-field")(25,"my-label",13),d(26,"Montant en esp\xE8ces"),r(),p(27,"input",18),u(28,Mt,2,0,"my-error",16),r(),o(29,"my-form-field")(30,"my-label",13),d(31,"Source d'argent"),r(),o(32,"select",19),u(33,Vt,3,2,"ng-container",15),r(),u(34,Pt,2,0,"my-error",16),r()(),o(35,"div",17)(36,"my-form-field")(37,"my-label",13),d(38,"Quantit\xE9 totale"),r(),p(39,"input",20),u(40,qt,2,0,"my-error",16),r(),o(41,"my-form-field")(42,"my-label",13),d(43,"Montant total"),r(),p(44,"input",21),u(45,Ot,2,0,"my-error",16),r()(),o(46,"my-form-field",22)(47,"my-label"),d(48,"Notes"),r(),p(49,"textarea",23),r()(),o(50,"div",24)(51,"span"),d(52,"Liste"),r(),p(53,"mat-divider",25),o(54,"div",26),u(55,Bt,28,12,"div",27),r(),o(56,"button",28),h("click",function(){return i.createItem()}),p(57,"i",29),o(58,"span"),d(59,"Stock"),r()()()()(),o(60,"div",30)(61,"button",31),h("click",function(){return i.create()}),d(62,"Nouveau "),r(),o(63,"button",32),h("click",function(){return i.save()}),d(64,"Sauvegarder"),r()()()),n&2){let m,f,S,E,w;s(3),M(" ",i.data.mode=="creation"?"Nouvelle ":"Modifier "," distribution "),s(3),c("ngIf",i.errors.length>0),s(2),c("formGroup",i.distributionFormGroup),s(10),c("required",!0),s(3),c("ngForOf",i.premises),s(),c("ngIf",((m=i.distributionFormGroup.get("premiseId"))==null?null:m.invalid)&&(((m=i.distributionFormGroup.get("premiseId"))==null?null:m.dirty)||((m=i.distributionFormGroup.get("premiseId"))==null?null:m.touched))&&((m=i.distributionFormGroup.get("premiseId"))==null?null:m.getError("required"))),s(3),c("required",!0),s(3),c("ngIf",((f=i.distributionFormGroup.get("cash"))==null?null:f.invalid)&&(((f=i.distributionFormGroup.get("cash"))==null?null:f.dirty)||((f=i.distributionFormGroup.get("cash"))==null?null:f.touched))&&((f=i.distributionFormGroup.get("cash"))==null?null:f.getError("required"))),s(2),c("required",!0),s(3),c("ngForOf",i.moneySources),s(),c("ngIf",((S=i.distributionFormGroup.get("moneySourceId"))==null?null:S.invalid)&&(((S=i.distributionFormGroup.get("moneySourceId"))==null?null:S.dirty)||((S=i.distributionFormGroup.get("moneySourceId"))==null?null:S.touched))&&((S=i.distributionFormGroup.get("moneySourceId"))==null?null:S.getError("required"))),s(3),c("required",!0),s(3),c("ngIf",((E=i.distributionFormGroup.get("totalQuantity"))==null?null:E.invalid)&&(((E=i.distributionFormGroup.get("totalQuantity"))==null?null:E.dirty)||((E=i.distributionFormGroup.get("totalQuantity"))==null?null:E.touched))&&((E=i.distributionFormGroup.get("totalQuantity"))==null?null:E.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((w=i.distributionFormGroup.get("totalAmount"))==null?null:w.invalid)&&(((w=i.distributionFormGroup.get("totalAmount"))==null?null:w.dirty)||((w=i.distributionFormGroup.get("totalAmount"))==null?null:w.touched))&&((w=i.distributionFormGroup.get("totalAmount"))==null?null:w.getError("required"))),s(10),c("ngForOf",i.items.controls)}},dependencies:[Y,V,A,ie,re,ee,ye,te,q,O,N,H,tt,it,P,nt,B,xe,Q,$,ne,Ce,mt],encapsulation:2});let e=a;return e})();var jt=["firstFocused"];function Ut(e,a){if(e&1&&(b(0),o(1,"option",44),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function Wt(e,a){if(e&1&&(b(0),o(1,"option",44),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function Jt(e,a){if(e&1){let l=I();o(0,"div",33)(1,"div",34)(2,"span"),d(3,"Filtrer"),r(),o(4,"button",35),h("click",function(){C(l);let n=_();return v(n.toggleFilterMenu())}),p(5,"i",36),r()(),o(6,"form",37)(7,"my-form-field")(8,"my-label",38),d(9,"Local"),r(),o(10,"select",39),u(11,Ut,3,2,"ng-container",40),r()(),o(12,"my-form-field")(13,"my-label",38),d(14,"Source d'argent"),r(),o(15,"select",41),u(16,Wt,3,2,"ng-container",40),r()()(),o(17,"div",42)(18,"button",43),h("click",function(){C(l);let n=_();return v(n.resetItemsFilterForm())}),d(19,"R\xE9initialiser"),r(),o(20,"button",11),h("click",function(){C(l);let n=_();return v(n.filterItems())}),d(21,"Appliquer"),r()()()}if(e&2){let l=_();s(6),c("formGroup",l.distributionFilterFormGroup),s(2),c("required",!0),s(3),c("ngForOf",l.premises),s(2),c("required",!0),s(3),c("ngForOf",l.moneySources)}}function Kt(e,a){if(e&1){let l=I();o(0,"button",45),h("click",function(){C(l);let n=_();return v(n.deleteSeleted())}),o(1,"div",46),p(2,"i",47),o(3,"span"),d(4),r()()()}if(e&2){let l=_();s(4),M("Supprimer (",l.selection.selected.length,")")}}function Zt(e,a){if(e&1){let l=I();o(0,"th",48)(1,"mat-checkbox",49),h("change",function(n){C(l);let i=_();return v(i.allSelectionChanged(n))}),r()()}if(e&2){let l=_();s(),c("checked",l.selection.hasValue()&&l.isAllSelected())("indeterminate",l.selection.hasValue()&&!l.isAllSelected())("aria-label",l.checkboxLabel())}}function Xt(e,a){if(e&1){let l=I();o(0,"td",50)(1,"mat-checkbox",51),h("click",function(n){return n.stopPropagation()})("change",function(n){let m=C(l).$implicit,f=_();return v(f.selectionChanged(n,m))}),r()()}if(e&2){let l=a.$implicit,t=_();s(),c("checked",t.selection.isSelected(l))("aria-label",t.checkboxLabel(l))}}function Yt(e,a){e&1&&(o(0,"th",48),d(1,"Code "),r())}function ei(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.code)}}function ti(e,a){e&1&&(o(0,"th",48),d(1,"Local "),r())}function ii(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.premiseId.label)}}function ri(e,a){e&1&&(o(0,"th",48),d(1,"Source d'argent "),r())}function ni(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.moneySourceId.label)}}function oi(e,a){e&1&&(o(0,"th",48),d(1,"Montant en esp\xE8ces"),r())}function li(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.cash)}}function ai(e,a){e&1&&(o(0,"th",48),d(1,"Quantit\xE9"),r())}function mi(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.totalQuantity)}}function si(e,a){e&1&&(o(0,"th",48),d(1,"Montant"),r())}function di(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.totalAmount)}}function ci(e,a){e&1&&(o(0,"th",48),d(1,"Date"),r())}function ui(e,a){if(e&1&&(o(0,"td",50),d(1),Xe(2,"date"),r()),e&2){let l=a.$implicit;s(),F(Ye(2,1,l.date,"dd/MM/yyyy"))}}function pi(e,a){e&1&&(o(0,"th",52),d(1,"Action"),r())}function fi(e,a){if(e&1){let l=I();o(0,"td",50)(1,"div",53)(2,"button",54),p(3,"i",55),r(),o(4,"button",56),h("click",function(){let i=C(l).$implicit,m=_();return v(m.deleteItem(i))}),p(5,"i",57),r(),o(6,"button",56),h("click",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),p(7,"i",58),r()()()}if(e&2){let l=a.$implicit,t=_();s(2),c("matTooltip",t.getTracabilityInfo(l))}}function _i(e,a){e&1&&p(0,"tr",59)}function hi(e,a){if(e&1){let l=I();o(0,"tr",60),h("dblclick",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),r()}}function gi(e,a){e&1&&(o(0,"div",61)(1,"p",62),d(2,"Aucune donn\xE9e \xE0 afficher"),r()())}var ut=(()=>{let a=class a{isAllSelected(){let t=this.selection.selected.length,n=this.dataSource.data.length;return t===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,n,i,m,f,S,E){this.distributionsHttp=t,this.snackBar=n,this.fb=i,this.matDialog=m,this.traceability=f,this.premisesHttp=S,this.moneySourcesHttp=E,this.dataSource=new Ne([]),this.displayedColumns=["select","code","premiseId.label","moneySourceId.label","cash","totalQuantity","totalAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.distributionFilterChanged=new Z,this.pageSize=X.pagination.pageSize,this.distributions=[],this.selection=new _e(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.moneySources=[],this.premises=[],this.distributionFilterFormGroup=this.fb.group({premiseId:[void 0],moneySourceId:[void 0]})}ngOnInit(){this.premisesHttp.getAll().subscribe({next:t=>{this.premises=t}}),this.moneySourcesHttp.getAll().subscribe({next:t=>{this.moneySources=t}})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.distributionFilterChanged).pipe(ce({}),ue(()=>(this.isLoadingResults=!0,this.distributionsHttp.paginate(this.getFilterQuery).pipe(de(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Fe(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",n=0){this.matDialog.open(ct,{data:{id:n,mode:t},minWidth:"97vw",minHeight:"97vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.distributionFilterChanged.emit()}resetItemsFilterForm(){this.distributionFilterFormGroup.reset({premiseId:void 0,moneySourceId:void 0}),this.distributionFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,n){t&&this.selection.toggle(n)}deleteMany(t){let n=new URLSearchParams;t.forEach(m=>{n.append("id",m.id.toString())});let i=`?${n.toString()}`;this.distributionsHttp.deleteMany(i).subscribe({next:m=>{m.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:m=>this.snackBar.open(m.message)})}get getFilterQuery(){let t=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,premiseId:this.distributionFilterFormGroup.get("premiseId")?.value,moneySourceId:this.distributionFilterFormGroup.get("moneySourceId")?.value};return R(n.pageIndex)&&t.append("pageIndex",n.pageIndex.toString()),R(n.pageSize)&&t.append("pageSize",n.pageSize.toString()),t.append("order","DESC"),R(n.premiseId)&&t.append("premiseId",n.premiseId),R(n.moneySourceId)&&t.append("moneySourceId",n.moneySourceId),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};a.\u0275fac=function(n){return new(n||a)(g(lt),g(j),g(L),g(Ie),g(ve),g(W),g(oe))},a.\u0275cmp=T({type:a,selectors:[["app-distributions-grid"]],viewQuery:function(n,i){if(n&1&&(k(z,5),k(U,5),k(jt,5)),n&2){let m;G(m=D())&&(i.paginator=m.first),G(m=D())&&(i.sort=m.first),G(m=D())&&(i.firstFocused=m.first)}},decls:54,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","premiseId.label"],["matColumnDef","moneySourceId.label"],["matColumnDef","cash"],["matColumnDef","totalQuantity"],["matColumnDef","totalAmount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],[3,"required"],["formControlName","premiseId","myInput","","size","small"],[4,"ngFor","ngForOf"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Distributions"),r()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),p(9,"i",7),o(10,"span"),d(11,"FILTRE"),r()()(),u(12,Jt,22,5,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),r(),o(13,"div",9),u(14,Kt,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),p(17,"i",13),o(18,"span",14),d(19,"Distribution"),r()()()()(),o(20,"div")(21,"div",15)(22,"table",16),b(23,17),u(24,Zt,2,3,"th",18)(25,Xt,2,2,"td",19),x(),b(26,20),u(27,Yt,2,0,"th",18)(28,ei,2,1,"td",19),x(),b(29,21),u(30,ti,2,0,"th",18)(31,ii,2,1,"td",19),x(),b(32,22),u(33,ri,2,0,"th",18)(34,ni,2,1,"td",19),x(),b(35,23),u(36,oi,2,0,"th",18)(37,li,2,1,"td",19),x(),b(38,24),u(39,ai,2,0,"th",18)(40,mi,2,1,"td",19),x(),b(41,25),u(42,si,2,0,"th",18)(43,di,2,1,"td",19),x(),b(44,26),u(45,ci,2,0,"th",18)(46,ui,3,4,"td",19),x(),b(47,27),u(48,pi,2,0,"th",28)(49,fi,8,1,"td",19),x(),u(50,_i,1,0,"tr",29)(51,hi,1,0,"tr",30),r(),u(52,gi,3,0,"div",31),r(),p(53,"mat-paginator",32),r()()),n&2){let m=pe(7);s(12),c("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),s(2),c("ngIf",i.selection.selected.length>0),s(8),c("dataSource",i.dataSource),s(28),c("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),s(),c("matRowDefColumns",i.displayedColumns),s(),c("ngIf",i.dataSource.data.length==0),s(),c("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[Y,V,A,ie,re,te,q,O,N,H,be,P,fe,ke,Ge,Re,Pe,Te,De,qe,Me,Ve,Oe,Ae,z,U,ge,he,B,Q,$,et],styles:[`app-distributions-grid{display:flex;flex:1}
`],encapsulation:2});let e=a;return e})();var yi=["firstFocused"];function bi(e,a){if(e&1&&p(0,"my-global-errors",19),e&2){let l=_();c("errors",l.errors)}}function xi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Ci(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}var pt=(()=>{let a=class a{constructor(t,n,i,m,f){this.fb=t,this.dialogRef=n,this.data=i,this.snackBar=m,this.premisesHttp=f,this.errors=[],this.premiseFormGroup=this.fb.group({id:[void 0],label:["",[y.required]],debt:[0,[y.required]],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(t){this.premisesHttp.getOneById(t).subscribe({next:n=>{this.premiseFormGroup.patchValue({id:n.id,label:n.label,debt:n.debt,notes:n.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.premiseFormGroup.valid==!0?this.data.mode=="creation"?this.premisesHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.premisesHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.premiseFormGroup.markAllAsTouched()}resetForm(){this.premiseFormGroup.reset({id:void 0,label:"",debt:0,notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.premiseFormGroup.markAsUntouched(),this.premiseFormGroup.clearValidators(),this.premiseFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.premiseFormGroup.getRawValue())}getUpdate(){return K({},this.premiseFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};a.\u0275fac=function(n){return new(n||a)(g(L),g(Ee),g(we),g(j),g(W))},a.\u0275cmp=T({type:a,selectors:[["app-premise-form"]],viewQuery:function(n,i){if(n&1&&k(yi,5),n&2){let m;G(m=D())&&(i.firstFocused=m.first)}},decls:31,vars:7,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3","h-64",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"w-80"],[3,"required"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],["formControlName","debt","type","text","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),d(3),r(),o(4,"button",3),h("click",function(){return i.closeDialog()}),p(5,"i",4),r()(),u(6,bi,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),p(9,"input",8),o(10,"my-form-field",9)(11,"my-label",10),d(12,"Libell\xE9"),r(),p(13,"input",11,12),u(15,xi,2,0,"my-error",13),r(),o(16,"my-form-field",9)(17,"my-label",10),d(18,"Dette"),r(),p(19,"input",14,12),u(21,Ci,2,0,"my-error",13),r(),o(22,"my-form-field",9)(23,"my-label"),d(24,"Notes"),r(),p(25,"textarea",15),r()()(),o(26,"div",16)(27,"button",17),h("click",function(){return i.create()}),d(28,"Nouvelle "),r(),o(29,"button",18),h("click",function(){return i.save()}),d(30,"Sauvegarder"),r()()()),n&2){let m,f;s(3),M(" ",i.data.mode=="creation"?"Nouveau":"Modifier"," local "),s(3),c("ngIf",i.errors.length>0),s(2),c("formGroup",i.premiseFormGroup),s(3),c("required",!0),s(4),c("ngIf",((m=i.premiseFormGroup.get("label"))==null?null:m.invalid)&&(((m=i.premiseFormGroup.get("label"))==null?null:m.dirty)||((m=i.premiseFormGroup.get("label"))==null?null:m.touched))&&((m=i.premiseFormGroup.get("label"))==null?null:m.getError("required"))),s(2),c("required",!0),s(4),c("ngIf",((f=i.premiseFormGroup.get("debt"))==null?null:f.invalid)&&(((f=i.premiseFormGroup.get("debt"))==null?null:f.dirty)||((f=i.premiseFormGroup.get("debt"))==null?null:f.touched))&&((f=i.premiseFormGroup.get("debt"))==null?null:f.getError("required")))}},dependencies:[V,A,ee,ye,q,O,N,H,P,B,xe,Q,$,ne,Ce],encapsulation:2});let e=a;return e})();var vi=["firstFocused"];function Si(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Fi(e,a){if(e&1){let l=I();o(0,"div",30)(1,"div",31)(2,"span"),d(3,"Filtrer"),r(),o(4,"button",32),h("click",function(){C(l);let n=_();return v(n.toggleFilterMenu())}),p(5,"i",33),r()(),o(6,"form",34)(7,"my-form-field")(8,"my-label"),d(9,"Libell\xE9"),r(),p(10,"input",35,36),u(12,Si,2,0,"my-error",37),r()(),o(13,"div",38)(14,"button",39),h("click",function(){C(l);let n=_();return v(n.resetItemsFilterForm())}),d(15,"R\xE9initialiser"),r(),o(16,"button",11),h("click",function(){C(l);let n=_();return v(n.filterItems())}),d(17,"Appliquer"),r()()()}if(e&2){let l=_(),t;s(6),c("formGroup",l.premiseFilterFormGroup),s(6),c("ngIf",((t=l.premiseFilterFormGroup.get("label"))==null?null:t.invalid)&&(((t=l.premiseFilterFormGroup.get("label"))==null?null:t.dirty)||((t=l.premiseFilterFormGroup.get("label"))==null?null:t.touched))&&((t=l.premiseFilterFormGroup.get("label"))==null?null:t.getError("required")))}}function Ei(e,a){if(e&1){let l=I();o(0,"button",40),h("click",function(){C(l);let n=_();return v(n.deleteSeleted())}),o(1,"div",41),p(2,"i",42),o(3,"span"),d(4),r()()()}if(e&2){let l=_();s(4),M("Supprimer (",l.selection.selected.length,")")}}function wi(e,a){if(e&1){let l=I();o(0,"th",43)(1,"mat-checkbox",44),h("change",function(n){C(l);let i=_();return v(i.allSelectionChanged(n))}),r()()}if(e&2){let l=_();s(),c("checked",l.selection.hasValue()&&l.isAllSelected())("indeterminate",l.selection.hasValue()&&!l.isAllSelected())("aria-label",l.checkboxLabel())}}function Ii(e,a){if(e&1){let l=I();o(0,"td",45)(1,"mat-checkbox",46),h("click",function(n){return n.stopPropagation()})("change",function(n){let m=C(l).$implicit,f=_();return v(f.selectionChanged(n,m))}),r()()}if(e&2){let l=a.$implicit,t=_();s(),c("checked",t.selection.isSelected(l))("aria-label",t.checkboxLabel(l))}}function ki(e,a){e&1&&(o(0,"th",43),d(1,"Code "),r())}function Gi(e,a){if(e&1&&(o(0,"td",45),d(1),r()),e&2){let l=a.$implicit;s(),F(l.code)}}function Di(e,a){e&1&&(o(0,"th",43),d(1,"Libell\xE9 "),r())}function Ri(e,a){if(e&1&&(o(0,"td",45),d(1),r()),e&2){let l=a.$implicit;s(),F(l.label)}}function Ti(e,a){e&1&&(o(0,"th",43),d(1,"Dette"),r())}function Mi(e,a){if(e&1&&(o(0,"td",45),d(1),r()),e&2){let l=a.$implicit;s(),F(l.debt)}}function Vi(e,a){e&1&&(o(0,"th",43),d(1,"Notes"),r())}function Pi(e,a){if(e&1&&(o(0,"td",45),d(1),r()),e&2){let l=a.$implicit;s(),F(l.notes)}}function qi(e,a){e&1&&(o(0,"th",47),d(1,"Action"),r())}function Oi(e,a){if(e&1){let l=I();o(0,"td",45)(1,"div",48)(2,"button",49),p(3,"i",50),r(),o(4,"button",51),h("click",function(){let i=C(l).$implicit,m=_();return v(m.deleteItem(i))}),p(5,"i",52),r(),o(6,"button",51),h("click",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),p(7,"i",53),r()()()}if(e&2){let l=a.$implicit,t=_();s(2),c("matTooltip",t.getTracabilityInfo(l))}}function Ai(e,a){e&1&&p(0,"tr",54)}function Ni(e,a){if(e&1){let l=I();o(0,"tr",55),h("dblclick",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),r()}}function Hi(e,a){e&1&&(o(0,"div",56)(1,"p",57),d(2,"Aucune donn\xE9e \xE0 afficher"),r()())}var ft=(()=>{let a=class a{isAllSelected(){let t=this.selection.selected.length,n=this.dataSource.data.length;return t===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,n,i,m,f){this.premisesHttp=t,this.snackBar=n,this.fb=i,this.matDialog=m,this.traceability=f,this.dataSource=new Ne([]),this.displayedColumns=["select","code","label","debt","notes","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.premiseFilterChanged=new Z,this.pageSize=X.pagination.pageSize,this.premises=[],this.selection=new _e(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.premiseFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.premiseFilterChanged).pipe(ce({}),ue(()=>(this.isLoadingResults=!0,this.premisesHttp.paginate(this.getFilterQuery).pipe(de(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Fe(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",n=0){this.matDialog.open(pt,{data:{id:n,mode:t},minHeight:"70vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.premiseFilterChanged.emit()}resetItemsFilterForm(){this.premiseFilterFormGroup.reset({label:""}),this.premiseFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,n){t&&this.selection.toggle(n)}deleteMany(t){let n=new URLSearchParams;t.forEach(m=>{n.append("id",m.id.toString())});let i=`?${n.toString()}`;this.premisesHttp.deleteMany(i).subscribe({next:m=>{m.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:m=>this.snackBar.open(m.message)})}get getFilterQuery(){let t=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.premiseFilterFormGroup.get("label")?.value};return R(n.pageIndex)&&t.append("pageIndex",n.pageIndex.toString()),R(n.pageSize)&&t.append("pageSize",n.pageSize.toString()),t.append("order","DESC"),R(n.label)&&t.append("label",n.label),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};a.\u0275fac=function(n){return new(n||a)(g(W),g(j),g(L),g(Ie),g(ve))},a.\u0275cmp=T({type:a,selectors:[["app-premises-grid"]],viewQuery:function(n,i){if(n&1&&(k(z,5),k(U,5),k(vi,5)),n&2){let m;G(m=D())&&(i.paginator=m.first),G(m=D())&&(i.sort=m.first),G(m=D())&&(i.firstFocused=m.first)}},decls:45,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","debt"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Distributions / Locaux"),r()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),p(9,"i",7),o(10,"span"),d(11,"FILTRE"),r()()(),u(12,Fi,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),r(),o(13,"div",9),u(14,Ei,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),p(17,"i",13),o(18,"span",14),d(19,"Local"),r()()()()(),o(20,"div")(21,"div",15)(22,"table",16),b(23,17),u(24,wi,2,3,"th",18)(25,Ii,2,2,"td",19),x(),b(26,20),u(27,ki,2,0,"th",18)(28,Gi,2,1,"td",19),x(),b(29,21),u(30,Di,2,0,"th",18)(31,Ri,2,1,"td",19),x(),b(32,22),u(33,Ti,2,0,"th",18)(34,Mi,2,1,"td",19),x(),b(35,23),u(36,Vi,2,0,"th",18)(37,Pi,2,1,"td",19),x(),b(38,24),u(39,qi,2,0,"th",25)(40,Oi,8,1,"td",19),x(),u(41,Ai,1,0,"tr",26)(42,Ni,1,0,"tr",27),r(),u(43,Hi,3,0,"div",28),r(),p(44,"mat-paginator",29),r()()),n&2){let m=pe(7);s(12),c("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),s(2),c("ngIf",i.selection.selected.length>0),s(8),c("dataSource",i.dataSource),s(19),c("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),s(),c("matRowDefColumns",i.displayedColumns),s(),c("ngIf",i.dataSource.data.length==0),s(),c("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,A,ee,q,O,N,H,be,P,fe,ke,Ge,Re,Pe,Te,De,qe,Me,Ve,Oe,Ae,z,U,ge,he,B,Q,$,ne],styles:[`app-premises-grid{display:flex;flex:1}
`],encapsulation:2});let e=a;return e})();var Li=["firstFocused"];function zi(e,a){if(e&1&&p(0,"my-global-errors",33),e&2){let l=_();c("errors",l.errors)}}function Qi(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function $i(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Bi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function ji(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function Ui(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Wi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Ji(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Ki(e,a){if(e&1&&(b(0),o(1,"option",34),d(2),r(),x()),e&2){let l=a.$implicit,t=_(2);s(),c("value",l.id),s(),F(t.getStockInfo(l))}}function Zi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Xi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function Yi(e,a){e&1&&(o(0,"my-error"),d(1," Veuillez remplir ce champ. "),r())}function er(e,a){e&1&&(o(0,"div",47)(1,"div",48),p(2,"div",49),r()())}function tr(e,a){if(e&1){let l=I();o(0,"button",50),h("click",function(){C(l);let n=_().index,i=_();return v(i.removeItem(n))}),p(1,"i",51),r()}}function ir(e,a){if(e&1){let l=I();o(0,"button",50),h("click",function(){C(l);let n=_().index,i=_();return v(i.recoverItem(n))}),p(1,"i",52),r()}}function rr(e,a){if(e&1&&(o(0,"div",35)(1,"div",36),p(2,"input",8)(3,"input",37)(4,"input",38),o(5,"my-form-field",39)(6,"my-label",13),d(7,"Stock"),r(),o(8,"select",40),u(9,Ki,3,2,"ng-container",15),r()(),o(10,"my-form-field",41)(11,"my-label",13),d(12,"Quantit\xE9"),r(),p(13,"input",42),u(14,Zi,2,0,"my-error",16),r(),o(15,"my-form-field",41)(16,"my-label",13),d(17,"Prix de vente"),r(),p(18,"input",43),u(19,Xi,2,0,"my-error",16),r(),o(20,"my-form-field",41)(21,"my-label",13),d(22,"Montant"),r(),p(23,"input",44),u(24,Yi,2,0,"my-error",16),r(),u(25,er,3,0,"div",45),r(),u(26,tr,2,0,"button",46)(27,ir,2,0,"button",46),r()),e&2){let l=a.$implicit,t=a.index,n=_(),i,m,f,S,E,w;c("formGroupName",t),s(6),c("required",!0),s(3),c("ngForOf",n.stocks),s(2),c("required",!0),s(3),c("ngIf",((i=l.get("quantity"))==null?null:i.invalid)&&(((i=l.get("quantity"))==null?null:i.dirty)||((i=l.get("quantity"))==null?null:i.touched))&&((i=l.get("quantity"))==null?null:i.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((m=l.get("salePrice"))==null?null:m.invalid)&&(((m=l.get("salePrice"))==null?null:m.dirty)||((m=l.get("salePrice"))==null?null:m.touched))&&((m=l.get("salePrice"))==null?null:m.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((f=l.get("amount"))==null?null:f.invalid)&&(((f=l.get("amount"))==null?null:f.dirty)||((f=l.get("amount"))==null?null:f.touched))&&((f=l.get("amount"))==null?null:f.getError("required"))),s(),c("ngIf",((S=l.get("mode"))==null?null:S.value)=="deletion"),s(),c("ngIf",((E=l.get("mode"))==null?null:E.value)!="deletion"),s(),c("ngIf",((w=l.get("mode"))==null?null:w.value)=="deletion")}}var _t=(()=>{let a=class a{get items(){return this.premiseReturnFormGroup.get("items")}constructor(t,n,i,m,f,S,E,w){this.fb=t,this.dialogRef=n,this.data=i,this.snackBar=m,this.premiseReturnsHttp=f,this.premisesHttp=S,this.moneySourcesHttp=E,this.stocksHttp=w,this.errors=[],this.premises=[],this.moneySources=[],this.stocks=[],this.premiseReturnFormGroup=this.fb.group({id:[void 0],code:[""],returnedCash:[0,[y.required]],totalQuantity:[{value:0,disabled:!0},[y.required]],totalAmount:[{value:0,disabled:!0},[y.required]],moneySourceId:[void 0,[y.required]],premiseId:[void 0,[y.required]],date:[Se(),[y.required]],notes:[""],items:this.fb.array([])})}ngOnInit(){Je([this.premisesHttp.getAll(),this.moneySourcesHttp.getAll(),this.stocksHttp.getAll()]).subscribe({next:([t,n,i])=>{this.premises=t,this.moneySources=n,this.stocks=i,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChaged()}loadData(t){this.premiseReturnsHttp.getOneById(t).subscribe({next:n=>{this.premiseReturnFormGroup.patchValue({id:n.id,code:n.code,returnedCash:n.returnedCash,totalQuantity:n.totalQuantity,totalAmount:n.totalAmount,moneySourceId:n.moneySourceId.id,premiseId:n.premiseId.id,date:rt(n.date),notes:n.notes}),this.items.clear(),n.items.forEach(i=>{this.items.push(this.fb.group({id:[i.id],stockId:[i.stockId.id,[y.required]],quantity:[i.quantity,[y.required]],salePrice:[i.salePrice,[y.required]],amount:[{value:i.amount,disabled:!0},[y.required]],mode:["update",[y.required]],oldMode:["update",[y.required]]}))})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.premiseReturnFormGroup.valid==!0?this.data.mode=="creation"?this.premiseReturnsHttp.create(this.getCreation()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:t.data.id,mode:"edit"},this.loadData(t.data.id)):this.errors=t.errors},error:t=>console.error(t)}):this.premiseReturnsHttp.update(this.data.id,this.getUpdate()).subscribe({next:t=>{t.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(t.data.id)):this.errors=t.errors},error:t=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.premiseReturnFormGroup.markAllAsTouched()}resetForm(){this.premiseReturnFormGroup.reset({id:void 0,code:"",returnedCash:0,totalQuantity:0,totalAmount:0,moneySourceId:0,premiseId:0,date:Se(),notes:""},{emitEvent:!1}),this.items.clear()}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.premiseReturnFormGroup.markAsUntouched(),this.premiseReturnFormGroup.clearValidators(),this.premiseReturnFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return K({},this.premiseReturnFormGroup.getRawValue())}getUpdate(){return K({},this.premiseReturnFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}createItem(){this.items.push(this.fb.group({id:[void 0],stockId:[void 0,[y.required]],quantity:[0,[y.required]],salePrice:[0,[y.required]],amount:[{value:0,disabled:!0},[y.required]],mode:["creation",[y.required]],oldMode:["creation",[y.required]]}))}removeItem(t){this.data.mode=="edit"?this.items.at(t).get("mode")?.setValue("deletion"):this.items.removeAt(t)}recoverItem(t){let n=this.items.at(t).get("oldMode")?.value;this.items.at(t).get("mode")?.setValue(n)}getStockInfo(t){return`${t.label} - ${t.categoryId?.label} - ${t.familyId?.label} *** Un stock avec une Quantit\xE9 de ${t.quantity} KG et Prix de premiseReturn : ${t.salePrice}`}handleFormChaged(){this.items.valueChanges.subscribe({next:t=>{let n=0,i=0;t.forEach((m,f)=>{this.items.at(f).get("amount")?.setValue(J(m.quantity)*J(m.salePrice),{emitEvent:!1})}),t.forEach((m,f)=>{n+=J(m.quantity),i+=J(this.items.at(f).get("amount")?.value)}),this.premiseReturnFormGroup.get("totalQuantity")?.setValue(n,{emitEvent:!1}),this.premiseReturnFormGroup.get("totalAmount")?.setValue(i,{emitEvent:!1})}})}};a.\u0275fac=function(n){return new(n||a)(g(L),g(Ee),g(we),g(j),g(at),g(W),g(oe),g(ot))},a.\u0275cmp=T({type:a,selectors:[["app-premise-return-form"]],viewQuery:function(n,i){if(n&1&&k(Li,5),n&2){let m;G(m=D())&&(i.firstFocused=m.first)}},decls:65,vars:16,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-3","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2","w-96"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],[3,"required"],["formControlName","premiseId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"flex","flex-col","gap-y-2","w-64"],["formControlName","returnedCash","type","number","myInput","","size","small"],["formControlName","moneySourceId","myInput","","size","small"],["formControlName","totalQuantity","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"!-mt-1"],["formControlName","notes","myTextarea","","type","text"],["formArrayName","items"],[1,"mb-1"],[1,"flex","flex-col","mt-2"],["class","flex flex-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","color","accent",1,"mt-2",3,"click"],[1,"ri-add-line","text-lg"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"],[1,"flex","flex-row",3,"formGroupName"],[1,"relative","flex","flex-row","gap-x-2"],["formControlName","mode","type","text",1,"!hidden"],["formControlName","oldMode","type","text",1,"!hidden"],[1,"w-[400px]"],["formControlName","stockId","myInput","","size","small"],[1,"w-48"],["formControlName","quantity","type","number","myInput","","size","small"],["formControlName","salePrice","type","number","myInput","","size","small"],["formControlName","amount","type","number","myInput","","size","small","myCalculableField",""],["class","absolute w-full h-full",4,"ngIf"],["class","mx-3 mt-2",3,"click",4,"ngIf"],[1,"absolute","w-full","h-full"],[1,"relative","h-full","bg-[rgba(255,0,0,0.05)]"],[1,"absolute","w-full","my-auto","top-0","bottom-0","h-[0.06rem]","bg-red-500"],[1,"mx-3","mt-2",3,"click"],[1,"ri-delete-bin-6-line","text-lg","text-red-500"],[1,"ri-device-recover-line","text-lg","text-blue-500"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),d(3),r(),o(4,"button",3),h("click",function(){return i.closeDialog()}),p(5,"i",4),r()(),u(6,zi,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),p(9,"input",8),o(10,"div",9)(11,"div",10)(12,"my-form-field")(13,"my-label"),d(14,"Code"),r(),p(15,"input",11,12),r(),o(17,"my-form-field")(18,"my-label",13),d(19,"Local"),r(),o(20,"select",14),u(21,Qi,3,2,"ng-container",15),r(),u(22,$i,2,0,"my-error",16),r()(),o(23,"div",17)(24,"my-form-field")(25,"my-label",13),d(26,"Esp\xE8ces retourn\xE9es"),r(),p(27,"input",18),u(28,Bi,2,0,"my-error",16),r(),o(29,"my-form-field")(30,"my-label",13),d(31,"Source d'argent"),r(),o(32,"select",19),u(33,ji,3,2,"ng-container",15),r(),u(34,Ui,2,0,"my-error",16),r()(),o(35,"div",17)(36,"my-form-field")(37,"my-label",13),d(38,"Quantit\xE9 totale"),r(),p(39,"input",20),u(40,Wi,2,0,"my-error",16),r(),o(41,"my-form-field")(42,"my-label",13),d(43,"Montant total"),r(),p(44,"input",21),u(45,Ji,2,0,"my-error",16),r()(),o(46,"my-form-field",22)(47,"my-label"),d(48,"Notes"),r(),p(49,"textarea",23),r()(),o(50,"div",24)(51,"span"),d(52,"Liste"),r(),p(53,"mat-divider",25),o(54,"div",26),u(55,rr,28,12,"div",27),r(),o(56,"button",28),h("click",function(){return i.createItem()}),p(57,"i",29),o(58,"span"),d(59,"Stock"),r()()()()(),o(60,"div",30)(61,"button",31),h("click",function(){return i.create()}),d(62,"Nouveau "),r(),o(63,"button",32),h("click",function(){return i.save()}),d(64,"Sauvegarder"),r()()()),n&2){let m,f,S,E,w;s(3),M(" ",i.data.mode=="creation"?"Nouveau ":"Modifier "," Retour "),s(3),c("ngIf",i.errors.length>0),s(2),c("formGroup",i.premiseReturnFormGroup),s(10),c("required",!0),s(3),c("ngForOf",i.premises),s(),c("ngIf",((m=i.premiseReturnFormGroup.get("premiseId"))==null?null:m.invalid)&&(((m=i.premiseReturnFormGroup.get("premiseId"))==null?null:m.dirty)||((m=i.premiseReturnFormGroup.get("premiseId"))==null?null:m.touched))&&((m=i.premiseReturnFormGroup.get("premiseId"))==null?null:m.getError("required"))),s(3),c("required",!0),s(3),c("ngIf",((f=i.premiseReturnFormGroup.get("returnedCash"))==null?null:f.invalid)&&(((f=i.premiseReturnFormGroup.get("returnedCash"))==null?null:f.dirty)||((f=i.premiseReturnFormGroup.get("returnedCash"))==null?null:f.touched))&&((f=i.premiseReturnFormGroup.get("returnedCash"))==null?null:f.getError("required"))),s(2),c("required",!0),s(3),c("ngForOf",i.moneySources),s(),c("ngIf",((S=i.premiseReturnFormGroup.get("moneySourceId"))==null?null:S.invalid)&&(((S=i.premiseReturnFormGroup.get("moneySourceId"))==null?null:S.dirty)||((S=i.premiseReturnFormGroup.get("moneySourceId"))==null?null:S.touched))&&((S=i.premiseReturnFormGroup.get("moneySourceId"))==null?null:S.getError("required"))),s(3),c("required",!0),s(3),c("ngIf",((E=i.premiseReturnFormGroup.get("totalQuantity"))==null?null:E.invalid)&&(((E=i.premiseReturnFormGroup.get("totalQuantity"))==null?null:E.dirty)||((E=i.premiseReturnFormGroup.get("totalQuantity"))==null?null:E.touched))&&((E=i.premiseReturnFormGroup.get("totalQuantity"))==null?null:E.getError("required"))),s(2),c("required",!0),s(3),c("ngIf",((w=i.premiseReturnFormGroup.get("totalAmount"))==null?null:w.invalid)&&(((w=i.premiseReturnFormGroup.get("totalAmount"))==null?null:w.dirty)||((w=i.premiseReturnFormGroup.get("totalAmount"))==null?null:w.touched))&&((w=i.premiseReturnFormGroup.get("totalAmount"))==null?null:w.getError("required"))),s(10),c("ngForOf",i.items.controls)}},dependencies:[Y,V,A,ie,re,ee,ye,te,q,O,N,H,tt,it,P,nt,B,xe,Q,$,ne,Ce,mt],encapsulation:2});let e=a;return e})();var nr=["firstFocused"];function or(e,a){if(e&1&&(b(0),o(1,"option",44),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function lr(e,a){if(e&1&&(b(0),o(1,"option",44),d(2),r(),x()),e&2){let l=a.$implicit;s(),c("value",l.id),s(),F(l.label)}}function ar(e,a){if(e&1){let l=I();o(0,"div",33)(1,"div",34)(2,"span"),d(3,"Filtrer"),r(),o(4,"button",35),h("click",function(){C(l);let n=_();return v(n.toggleFilterMenu())}),p(5,"i",36),r()(),o(6,"form",37)(7,"my-form-field")(8,"my-label",38),d(9,"Local"),r(),o(10,"select",39),u(11,or,3,2,"ng-container",40),r()(),o(12,"my-form-field")(13,"my-label",38),d(14,"Source d'argent"),r(),o(15,"select",41),u(16,lr,3,2,"ng-container",40),r()()(),o(17,"div",42)(18,"button",43),h("click",function(){C(l);let n=_();return v(n.resetItemsFilterForm())}),d(19,"R\xE9initialiser"),r(),o(20,"button",11),h("click",function(){C(l);let n=_();return v(n.filterItems())}),d(21,"Appliquer"),r()()()}if(e&2){let l=_();s(6),c("formGroup",l.premiseReturnFilterFormGroup),s(2),c("required",!0),s(3),c("ngForOf",l.premises),s(2),c("required",!0),s(3),c("ngForOf",l.moneySources)}}function mr(e,a){if(e&1){let l=I();o(0,"button",45),h("click",function(){C(l);let n=_();return v(n.deleteSeleted())}),o(1,"div",46),p(2,"i",47),o(3,"span"),d(4),r()()()}if(e&2){let l=_();s(4),M("Supprimer (",l.selection.selected.length,")")}}function sr(e,a){if(e&1){let l=I();o(0,"th",48)(1,"mat-checkbox",49),h("change",function(n){C(l);let i=_();return v(i.allSelectionChanged(n))}),r()()}if(e&2){let l=_();s(),c("checked",l.selection.hasValue()&&l.isAllSelected())("indeterminate",l.selection.hasValue()&&!l.isAllSelected())("aria-label",l.checkboxLabel())}}function dr(e,a){if(e&1){let l=I();o(0,"td",50)(1,"mat-checkbox",51),h("click",function(n){return n.stopPropagation()})("change",function(n){let m=C(l).$implicit,f=_();return v(f.selectionChanged(n,m))}),r()()}if(e&2){let l=a.$implicit,t=_();s(),c("checked",t.selection.isSelected(l))("aria-label",t.checkboxLabel(l))}}function cr(e,a){e&1&&(o(0,"th",48),d(1,"Code "),r())}function ur(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.code)}}function pr(e,a){e&1&&(o(0,"th",48),d(1,"Local "),r())}function fr(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.premiseId.label)}}function _r(e,a){e&1&&(o(0,"th",48),d(1,"Source d'argent "),r())}function hr(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.moneySourceId.label)}}function gr(e,a){e&1&&(o(0,"th",48),d(1,"Esp\xE8ces retourn\xE9es"),r())}function yr(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.returnedCash)}}function br(e,a){e&1&&(o(0,"th",48),d(1,"Quantit\xE9"),r())}function xr(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.totalQuantity)}}function Cr(e,a){e&1&&(o(0,"th",48),d(1,"Montant"),r())}function vr(e,a){if(e&1&&(o(0,"td",50),d(1),r()),e&2){let l=a.$implicit;s(),F(l.totalAmount)}}function Sr(e,a){e&1&&(o(0,"th",48),d(1,"Date"),r())}function Fr(e,a){if(e&1&&(o(0,"td",50),d(1),Xe(2,"date"),r()),e&2){let l=a.$implicit;s(),F(Ye(2,1,l.date,"dd/MM/yyyy"))}}function Er(e,a){e&1&&(o(0,"th",52),d(1,"Action"),r())}function wr(e,a){if(e&1){let l=I();o(0,"td",50)(1,"div",53)(2,"button",54),p(3,"i",55),r(),o(4,"button",56),h("click",function(){let i=C(l).$implicit,m=_();return v(m.deleteItem(i))}),p(5,"i",57),r(),o(6,"button",56),h("click",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),p(7,"i",58),r()()()}if(e&2){let l=a.$implicit,t=_();s(2),c("matTooltip",t.getTracabilityInfo(l))}}function Ir(e,a){e&1&&p(0,"tr",59)}function kr(e,a){if(e&1){let l=I();o(0,"tr",60),h("dblclick",function(){let i=C(l).$implicit,m=_();return v(m.newItem("edit",i.id))}),r()}}function Gr(e,a){e&1&&(o(0,"div",61)(1,"p",62),d(2,"Aucune donn\xE9e \xE0 afficher"),r()())}var ht=(()=>{let a=class a{isAllSelected(){let t=this.selection.selected.length,n=this.dataSource.data.length;return t===n}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(t){return t?`${this.selection.isSelected(t)?"deselect":"select"} row ${t.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(t,n,i,m,f,S,E){this.snackBar=t,this.fb=n,this.matDialog=i,this.traceability=m,this.premiseReturnsHttp=f,this.premisesHttp=S,this.moneySourcesHttp=E,this.dataSource=new Ne([]),this.displayedColumns=["select","code","premiseId.label","moneySourceId.label","returnedCash","totalQuantity","totalAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new Z,this.premiseReturnFilterChanged=new Z,this.pageSize=X.pagination.pageSize,this.premiseReturns=[],this.selection=new _e(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.moneySources=[],this.premises=[],this.premiseReturnFilterFormGroup=this.fb.group({premiseId:[void 0],moneySourceId:[void 0]})}ngOnInit(){this.premisesHttp.getAll().subscribe({next:t=>{this.premises=t}}),this.moneySourcesHttp.getAll().subscribe({next:t=>{this.moneySources=t}})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),se(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.premiseReturnFilterChanged).pipe(ce({}),ue(()=>(this.isLoadingResults=!0,this.premiseReturnsHttp.paginate(this.getFilterQuery).pipe(de(()=>ae(null))))),me(t=>(this.isLoadingResults=!1,this.isRateLimitReached=t?.data===null,Fe(t)?[]:(this.resultsLength=t?.count,t?.items)))).subscribe({next:t=>this.dataSource.data=t})}newItem(t="creation",n=0){this.matDialog.open(_t,{data:{id:n,mode:t},minWidth:"97vw",minHeight:"97vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(t){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([t])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.premiseReturnFilterChanged.emit()}resetItemsFilterForm(){this.premiseReturnFilterFormGroup.reset({premiseId:void 0,moneySourceId:void 0}),this.premiseReturnFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(t){t&&this.toggleAllRows()}selectionChanged(t,n){t&&this.selection.toggle(n)}deleteMany(t){let n=new URLSearchParams;t.forEach(m=>{n.append("id",m.id.toString())});let i=`?${n.toString()}`;this.premiseReturnsHttp.deleteMany(i).subscribe({next:m=>{m.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:m=>this.snackBar.open(m.message)})}get getFilterQuery(){let t=new URLSearchParams,n={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,premiseId:this.premiseReturnFilterFormGroup.get("premiseId")?.value,moneySourceId:this.premiseReturnFilterFormGroup.get("moneySourceId")?.value};return R(n.pageIndex)&&t.append("pageIndex",n.pageIndex.toString()),R(n.pageSize)&&t.append("pageSize",n.pageSize.toString()),t.append("order","DESC"),R(n.premiseId)&&t.append("premiseId",n.premiseId),R(n.moneySourceId)&&t.append("moneySourceId",n.moneySourceId),`?${t.toString()}`}getTracabilityInfo(t){return this.traceability.info(t)}};a.\u0275fac=function(n){return new(n||a)(g(j),g(L),g(Ie),g(ve),g(at),g(W),g(oe))},a.\u0275cmp=T({type:a,selectors:[["app-premise-returns-grid"]],viewQuery:function(n,i){if(n&1&&(k(z,5),k(U,5),k(nr,5)),n&2){let m;G(m=D())&&(i.paginator=m.first),G(m=D())&&(i.sort=m.first),G(m=D())&&(i.firstFocused=m.first)}},decls:54,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","premiseId.label"],["matColumnDef","moneySourceId.label"],["matColumnDef","returnedCash"],["matColumnDef","totalQuantity"],["matColumnDef","totalAmount"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],[3,"required"],["formControlName","premiseId","myInput","","size","small"],[4,"ngFor","ngForOf"],["formControlName","moneySourceId","myInput","","size","small"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(n,i){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),d(3,"Distributions / Retours"),r()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),p(9,"i",7),o(10,"span"),d(11,"FILTRE"),r()()(),u(12,ar,22,5,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),r(),o(13,"div",9),u(14,mr,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),p(17,"i",13),o(18,"span",14),d(19,"Retour"),r()()()()(),o(20,"div")(21,"div",15)(22,"table",16),b(23,17),u(24,sr,2,3,"th",18)(25,dr,2,2,"td",19),x(),b(26,20),u(27,cr,2,0,"th",18)(28,ur,2,1,"td",19),x(),b(29,21),u(30,pr,2,0,"th",18)(31,fr,2,1,"td",19),x(),b(32,22),u(33,_r,2,0,"th",18)(34,hr,2,1,"td",19),x(),b(35,23),u(36,gr,2,0,"th",18)(37,yr,2,1,"td",19),x(),b(38,24),u(39,br,2,0,"th",18)(40,xr,2,1,"td",19),x(),b(41,25),u(42,Cr,2,0,"th",18)(43,vr,2,1,"td",19),x(),b(44,26),u(45,Sr,2,0,"th",18)(46,Fr,3,4,"td",19),x(),b(47,27),u(48,Er,2,0,"th",28)(49,wr,8,1,"td",19),x(),u(50,Ir,1,0,"tr",29)(51,kr,1,0,"tr",30),r(),u(52,Gr,3,0,"div",31),r(),p(53,"mat-paginator",32),r()()),n&2){let m=pe(7);s(12),c("cdkConnectedOverlayOrigin",m)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),s(2),c("ngIf",i.selection.selected.length>0),s(8),c("dataSource",i.dataSource),s(28),c("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),s(),c("matRowDefColumns",i.displayedColumns),s(),c("ngIf",i.dataSource.data.length==0),s(),c("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[Y,V,A,ie,re,te,q,O,N,H,be,P,fe,ke,Ge,Re,Pe,Te,De,qe,Me,Ve,Oe,Ae,z,U,ge,he,B,Q,$,et],styles:[`app-premise-returns-grid{display:flex;flex:1}
`],encapsulation:2});let e=a;return e})();var Dr=[{path:"",redirectTo:"distributions",pathMatch:"full"},{path:"distributions",component:ut},{path:"premises",component:ft},{path:"returns",component:ht}],wt=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=Ze({type:a}),a.\u0275inj=Ke({imports:[st.forChild(Dr),st]});let e=a;return e})();var jn=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=Ze({type:a}),a.\u0275inj=Ke({imports:[gt,wt]});let e=a;return e})();export{jn as DistributionsModule};
