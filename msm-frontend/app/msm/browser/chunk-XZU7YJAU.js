import{a as X}from"./chunk-O36OTMU2.js";import{$a as be,A as p,Aa as de,Ab as Ae,B as u,Ba as pe,Bb as Le,C as o,Ca as fe,Cb as Oe,D as n,Da as W,Db as Re,E as d,Ea as E,Eb as U,F as y,Fa as L,G as C,Ga as O,Gb as wt,H as F,Ha as R,I as h,Ia as he,J as f,Ja as q,K as w,Kb as pt,L as k,Lb as ft,M as G,Ma as H,N as ce,Na as ge,Nb as Jt,O as m,Oa as _e,P as v,Pa as ye,Pb as kt,Q as M,Qa as B,Qb as Gt,Ra as Ce,T as Wt,Ta as z,U as We,Ua as P,Ub as dt,V as Zt,Va as Q,Vb as It,W as Xe,Wa as $,Xa as Z,Ya as xe,Z as Ze,Za as Se,_ as V,a as J,aa as ct,ab as ut,bb as Je,cb as ve,cc as Mt,d as ne,db as N,e as oe,ec as Tt,f as Nt,fb as T,fc as Kt,g as le,gc as Xt,h as ae,hb as Et,ib as Fe,j as se,jb as Ee,k as me,kb as we,lb as j,n as vt,p as D,pa as Dt,q as Ft,r as x,s as S,sb as ke,tb as Ge,ub as Ie,v as c,vb as Me,w as g,wb as Te,xb as Ne,y as K,ya as A,yb as De,za as ue,zb as Ve}from"./chunk-J3ZMDLLJ.js";var ei=["firstFocused"];function ti(t,l){if(t&1&&d(0,"my-global-errors",26),t&2){let a=f();u("errors",a.errors)}}function ii(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function ri(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function ni(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var Vt=(()=>{let l=class l{constructor(e,r,i,s,_){this.fb=e,this.dialogRef=r,this.data=i,this.sourcesHttp=s,this.snackBar=_,this.errors=[],this.sourceFormGroup=this.fb.group({id:[void 0],code:[""],label:["",[E.required]],nature:[void 0,[E.required]],amount:[0,[E.required]],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(e){this.sourcesHttp.getOneById(e).subscribe({next:r=>{this.sourceFormGroup.patchValue({id:r.id,code:r.code,label:r.label,nature:r.nature,amount:r.amount,notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.sourceFormGroup.valid==!0?this.data.mode=="creation"?this.sourcesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.sourcesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.sourceFormGroup.markAllAsTouched()}resetForm(){this.sourceFormGroup.reset({id:void 0,code:"",label:"",nature:void 0,amount:0,notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.sourceFormGroup.markAsUntouched(),this.sourceFormGroup.clearValidators(),this.sourceFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.sourceFormGroup.getRawValue())}getUpdate(){return J({},this.sourceFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(dt),g(j))},l.\u0275cmp=D({type:l,selectors:[["app-money-source-form"]],viewQuery:function(r,i){if(r&1&&w(ei,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:52,vars:9,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3","h-64",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","label","type","text","myInput",""],[4,"ngIf"],["formControlName","nature","myInput",""],["value","coffer"],["value","crate"],["value","bank"],["value","poste"],["value","consumption"],["formControlName","amount","type","number","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,ti,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),n(),d(14,"input",10,11),n(),o(16,"my-form-field")(17,"my-label",12),m(18,"Libell\xE9"),n(),d(19,"input",13,11),p(21,ii,2,0,"my-error",14),n()(),o(22,"div",9)(23,"my-form-field")(24,"my-label",12),m(25,"Nature"),n(),o(26,"select",15)(27,"option",16),m(28,"Coffre"),n(),o(29,"option",17),m(30,"Caisse"),n(),o(31,"option",18),m(32,"Banque"),n(),o(33,"option",19),m(34,"Poste"),n(),o(35,"option",20),m(36,"Consommation"),n()(),p(37,ri,2,0,"my-error",14),n(),o(38,"my-form-field")(39,"my-label",12),m(40,"Montant"),n(),d(41,"input",21),p(42,ni,2,0,"my-error",14),n()(),o(43,"my-form-field")(44,"my-label"),m(45,"Notes"),n(),d(46,"textarea",22),n()()(),o(47,"div",23)(48,"button",24),h("click",function(){return i.create()}),m(49,"Nouvelle "),n(),o(50,"button",25),h("click",function(){return i.save()}),m(51,"Sauvegarder"),n()()()),r&2){let s,_,b;c(3),M(" ",i.data.mode=="creation"?"Nouvelle":"Modifier"," Source "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.sourceFormGroup),c(9),u("required",!0),c(4),u("ngIf",((s=i.sourceFormGroup.get("label"))==null?null:s.invalid)&&(((s=i.sourceFormGroup.get("label"))==null?null:s.dirty)||((s=i.sourceFormGroup.get("label"))==null?null:s.touched))&&((s=i.sourceFormGroup.get("label"))==null?null:s.getError("required"))),c(3),u("required",!0),c(13),u("ngIf",((_=i.sourceFormGroup.get("nature"))==null?null:_.invalid)&&(((_=i.sourceFormGroup.get("nature"))==null?null:_.dirty)||((_=i.sourceFormGroup.get("nature"))==null?null:_.touched))&&((_=i.sourceFormGroup.get("nature"))==null?null:_.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((b=i.sourceFormGroup.get("amount"))==null?null:b.invalid)&&(((b=i.sourceFormGroup.get("amount"))==null?null:b.dirty)||((b=i.sourceFormGroup.get("amount"))==null?null:b.touched))&&((b=i.sourceFormGroup.get("amount"))==null?null:b.getError("required")))}},dependencies:[V,R,_e,ye,W,he,ge,L,O,q,H,A,$,xe,P,Q,Z,Se],encapsulation:2});let t=l;return t})();var oi=["firstFocused"];function li(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function ai(t,l){if(t&1){let a=F();o(0,"div",30)(1,"div",31)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",32),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",33),n()(),o(6,"form",34)(7,"my-form-field")(8,"my-label"),m(9,"Libell\xE9"),n(),d(10,"input",35,36),p(12,li,2,0,"my-error",37),n()(),o(13,"div",38)(14,"button",39),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),n(),o(16,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(17,"Appliquer"),n()()()}if(t&2){let a=f(),e;c(6),u("formGroup",a.sourceFilterFormGroup),c(6),u("ngIf",((e=a.sourceFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=a.sourceFilterFormGroup.get("label"))==null?null:e.dirty)||((e=a.sourceFilterFormGroup.get("label"))==null?null:e.touched))&&((e=a.sourceFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function si(t,l){if(t&1){let a=F();o(0,"button",40),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",41),d(2,"i",42),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function mi(t,l){if(t&1){let a=F();o(0,"th",43)(1,"mat-checkbox",44),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function ci(t,l){if(t&1){let a=F();o(0,"td",45)(1,"mat-checkbox",46),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function ui(t,l){t&1&&(o(0,"th",43),m(1,"Code "),n())}function di(t,l){if(t&1&&(o(0,"td",45),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function pi(t,l){t&1&&(o(0,"th",43),m(1,"Libell\xE9 "),n())}function fi(t,l){if(t&1&&(o(0,"td",45),m(1),n()),t&2){let a=l.$implicit;c(),v(a.label)}}function hi(t,l){t&1&&(o(0,"th",43),m(1,"Nature "),n())}function gi(t,l){if(t&1&&(o(0,"td",45),m(1),We(2,"mySourceNature"),n()),t&2){let a=l.$implicit;c(),v(Zt(2,1,a.nature))}}function _i(t,l){t&1&&(o(0,"th",43),m(1,"Montant "),n())}function yi(t,l){if(t&1&&(o(0,"td",45),m(1),n()),t&2){let a=l.$implicit;c(),v(a.amount)}}function Ci(t,l){t&1&&(o(0,"th",47),m(1,"Action"),n())}function xi(t,l){if(t&1){let a=F();o(0,"td",45)(1,"div",48)(2,"button",49),d(3,"i",50),n(),o(4,"button",51),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",52),n(),o(6,"button",51),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",53),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function Si(t,l){t&1&&d(0,"tr",54)}function bi(t,l){if(t&1){let a=F();o(0,"tr",55),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function vi(t,l){t&1&&(o(0,"div",56)(1,"p",57),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var At=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_){this.snackBar=e,this.fb=r,this.matDialog=i,this.traceability=s,this.sourcesHttp=_,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","nature","amount","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.sourceFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.sources=[],this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.sourceFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.sourceFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.sourcesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(Vt,{data:{id:r,mode:e},minWidth:"512px",disableClose:!0,minHeight:"90vh",autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.sourceFilterChanged.emit()}resetItemsFilterForm(){this.sourceFilterFormGroup.reset({label:""}),this.sourceFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.sourcesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.sourceFilterFormGroup.get("label")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.label)&&e.append("label",r.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(j),g(B),g(we),g(be),g(dt))},l.\u0275cmp=D({type:l,selectors:[["app-money-sources-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(oi,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:45,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","nature"],["matColumnDef","amount"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Sources"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,ai,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,si,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Source"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,mi,2,3,"th",18)(25,ci,2,2,"td",19),C(),y(26,20),p(27,ui,2,0,"th",18)(28,di,2,1,"td",19),C(),y(29,21),p(30,pi,2,0,"th",18)(31,fi,2,1,"td",19),C(),y(32,22),p(33,hi,2,0,"th",18)(34,gi,3,3,"td",19),C(),y(35,23),p(36,_i,2,0,"th",18)(37,yi,2,1,"td",19),C(),y(38,24),p(39,Ci,2,0,"th",25)(40,xi,8,1,"td",19),C(),p(41,Si,1,0,"tr",26)(42,bi,1,0,"tr",27),n(),p(43,vi,3,0,"div",28),n(),d(44,"mat-paginator",29),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(19),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,R,W,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,Z,Kt],styles:[`app-money-sources-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var Fi=["firstFocused"];function Ei(t,l){if(t&1&&d(0,"my-global-errors",23),t&2){let a=f();u("errors",a.errors)}}function wi(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function ki(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Gi(t,l){if(t&1&&(y(0),o(1,"option",24),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function Ii(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Mi(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var Lt=(()=>{let l=class l{constructor(e,r,i,s,_,b){this.fb=e,this.dialogRef=r,this.data=i,this.snackBar=s,this.chargesHttp=_,this.chargeNaturesHttp=b,this.errors=[],this.chargeNatures=[],this.chargeFormGroup=this.fb.group({id:[void 0],code:[""],label:["",[E.required]],chargeNatureId:[void 0,[E.required]],amount:[0,[E.required]],date:[Je(),[E.required]],notes:[""]})}ngOnInit(){this.chargeNaturesHttp.getAll().subscribe({next:e=>{this.chargeNatures=e,this.data.mode=="edit"&&this.loadData(this.data.id)}})}loadData(e){this.chargesHttp.getOneById(e).subscribe({next:r=>{this.chargeFormGroup.patchValue({id:r.id,code:r.code,label:r.label,chargeNatureId:r.chargeNatureId.id,amount:r.amount,date:ut(r.date),notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.chargeFormGroup.valid==!0?this.data.mode=="creation"?this.chargesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.chargesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.chargeFormGroup.markAllAsTouched()}resetForm(){this.chargeFormGroup.reset({id:void 0,code:"",label:"",chargeNatureId:void 0,amount:0,date:Je(),notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.chargeFormGroup.markAsUntouched(),this.chargeFormGroup.clearValidators(),this.chargeFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.chargeFormGroup.getRawValue())}getUpdate(){return J({},this.chargeFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(j),g(kt),g(ft))},l.\u0275cmp=D({type:l,selectors:[["app-charge-form"]],viewQuery:function(r,i){if(r&1&&w(Fi,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:48,vars:12,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","label","type","text","myInput",""],[4,"ngIf"],["formControlName","amount","type","number","myInput",""],["formControlName","chargeNatureId","myInput",""],[4,"ngFor","ngForOf"],["formControlName","date","type","date","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,Ei,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),n(),d(14,"input",10,11),n(),o(16,"my-form-field")(17,"my-label",12),m(18,"Libell\xE9"),n(),d(19,"input",13),p(20,wi,2,0,"my-error",14),n()(),o(21,"div",9)(22,"my-form-field")(23,"my-label",12),m(24,"Montant"),n(),d(25,"input",15),p(26,ki,2,0,"my-error",14),n(),o(27,"my-form-field")(28,"my-label",12),m(29,"Nature"),n(),o(30,"select",16),p(31,Gi,3,2,"ng-container",17),n(),p(32,Ii,2,0,"my-error",14),n()(),o(33,"div",9)(34,"my-form-field")(35,"my-label",12),m(36,"Date"),n(),d(37,"input",18),p(38,Mi,2,0,"my-error",14),n()(),o(39,"my-form-field")(40,"my-label"),m(41,"Notes"),n(),d(42,"textarea",19),n()()(),o(43,"div",20)(44,"button",21),h("click",function(){return i.create()}),m(45,"Nouveau "),n(),o(46,"button",22),h("click",function(){return i.save()}),m(47,"Sauvegarder"),n()()()),r&2){let s,_,b,I;c(3),M(" ",i.data.mode=="creation"?"Nouveau ":"Modifier "," charge "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.chargeFormGroup),c(9),u("required",!0),c(3),u("ngIf",((s=i.chargeFormGroup.get("label"))==null?null:s.invalid)&&(((s=i.chargeFormGroup.get("label"))==null?null:s.dirty)||((s=i.chargeFormGroup.get("label"))==null?null:s.touched))&&((s=i.chargeFormGroup.get("label"))==null?null:s.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((_=i.chargeFormGroup.get("amount"))==null?null:_.invalid)&&(((_=i.chargeFormGroup.get("amount"))==null?null:_.dirty)||((_=i.chargeFormGroup.get("amount"))==null?null:_.touched))&&((_=i.chargeFormGroup.get("amount"))==null?null:_.getError("required"))),c(2),u("required",!0),c(3),u("ngForOf",i.chargeNatures),c(),u("ngIf",((b=i.chargeFormGroup.get("chargeNatureId"))==null?null:b.invalid)&&(((b=i.chargeFormGroup.get("chargeNatureId"))==null?null:b.dirty)||((b=i.chargeFormGroup.get("chargeNatureId"))==null?null:b.touched))&&((b=i.chargeFormGroup.get("chargeNatureId"))==null?null:b.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((I=i.chargeFormGroup.get("date"))==null?null:I.invalid)&&(((I=i.chargeFormGroup.get("date"))==null?null:I.dirty)||((I=i.chargeFormGroup.get("date"))==null?null:I.touched))&&((I=i.chargeFormGroup.get("date"))==null?null:I.getError("required")))}},dependencies:[Ze,V,R,_e,ye,W,he,ge,L,O,q,H,A,$,xe,P,Q,Z,Se],encapsulation:2});let t=l;return t})();var Ni=["firstFocused"];function Di(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Vi(t,l){if(t&1){let a=F();o(0,"div",31)(1,"div",32)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",33),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",34),n()(),o(6,"form",35)(7,"my-form-field")(8,"my-label"),m(9,"Nom *"),n(),d(10,"input",36,37),p(12,Di,2,0,"my-error",38),n()(),o(13,"div",39)(14,"button",40),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),n(),o(16,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(17,"Appliquer"),n()()()}if(t&2){let a=f(),e;c(6),u("formGroup",a.chargeFilterFormGroup),c(6),u("ngIf",((e=a.chargeFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=a.chargeFilterFormGroup.get("label"))==null?null:e.dirty)||((e=a.chargeFilterFormGroup.get("label"))==null?null:e.touched))&&((e=a.chargeFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function Ai(t,l){if(t&1){let a=F();o(0,"button",41),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",42),d(2,"i",43),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function Li(t,l){if(t&1){let a=F();o(0,"th",44)(1,"mat-checkbox",45),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Oi(t,l){if(t&1){let a=F();o(0,"td",46)(1,"mat-checkbox",47),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function Ri(t,l){t&1&&(o(0,"th",44),m(1,"Code "),n())}function qi(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function Hi(t,l){t&1&&(o(0,"th",44),m(1,"Libell\xE9 "),n())}function Bi(t,l){if(t&1&&(o(0,"td",46),m(1),We(2,"myLimitTextLength"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.label,30))}}function zi(t,l){t&1&&(o(0,"th",44),m(1,"Montant "),n())}function Pi(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.amount)}}function Qi(t,l){t&1&&(o(0,"th",44),m(1,"Nature "),n())}function $i(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.chargeNatureId.label)}}function ji(t,l){t&1&&(o(0,"th",44),m(1,"Date "),n())}function Ui(t,l){if(t&1&&(o(0,"td",46),m(1),We(2,"date"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.date,"dd/MM/yyyy"))}}function Wi(t,l){t&1&&(o(0,"th",48),m(1,"Action"),n())}function Zi(t,l){if(t&1){let a=F();o(0,"td",46)(1,"div",49)(2,"button",50),d(3,"i",51),n(),o(4,"button",52),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",53),n(),o(6,"button",52),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",54),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function Ji(t,l){t&1&&d(0,"tr",55)}function Ki(t,l){if(t&1){let a=F();o(0,"tr",56),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function Xi(t,l){t&1&&(o(0,"div",57)(1,"p",58),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var Ot=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_){this.snackBar=e,this.fb=r,this.matDialog=i,this.traceability=s,this.chargesHttp=_,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","chargeNatureId.label","amount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.chargeFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.charges=[],this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.chargeFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.chargeFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.chargesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(Lt,{data:{id:r,mode:e},minWidth:"512px",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.chargeFilterChanged.emit()}resetItemsFilterForm(){this.chargeFilterFormGroup.reset({label:""}),this.chargeFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.chargesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.chargeFilterFormGroup.get("label")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.label)&&e.append("label",r.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(j),g(B),g(we),g(be),g(kt))},l.\u0275cmp=D({type:l,selectors:[["app-charges-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(Ni,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:48,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","amount"],["matColumnDef","chargeNatureId.label"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Charges"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,Vi,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,Ai,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Charge"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,Li,2,3,"th",18)(25,Oi,2,2,"td",19),C(),y(26,20),p(27,Ri,2,0,"th",18)(28,qi,2,1,"td",19),C(),y(29,21),p(30,Hi,2,0,"th",18)(31,Bi,3,4,"td",19),C(),y(32,22),p(33,zi,2,0,"th",18)(34,Pi,2,1,"td",19),C(),y(35,23),p(36,Qi,2,0,"th",18)(37,$i,2,1,"td",19),C(),y(38,24),p(39,ji,2,0,"th",18)(40,Ui,3,4,"td",19),C(),y(41,25),p(42,Wi,2,0,"th",26)(43,Zi,8,1,"td",19),C(),p(44,Ji,1,0,"tr",27)(45,Ki,1,0,"tr",28),n(),p(46,Xi,3,0,"div",29),n(),d(47,"mat-paginator",30),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(22),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,R,W,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,Z,ct,Et],styles:[`app-charges-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var Yi=["firstFocused"];function er(t,l){if(t&1&&d(0,"my-global-errors",18),t&2){let a=f();u("errors",a.errors)}}function tr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var Rt=(()=>{let l=class l{constructor(e,r,i,s,_){this.fb=e,this.dialogRef=r,this.data=i,this.chargeNaturesHttp=s,this.snackBar=_,this.errors=[],this.chargeNatureFormGroup=this.fb.group({id:[void 0],label:["",[E.required]],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(e){this.chargeNaturesHttp.getOneById(e).subscribe({next:r=>{this.chargeNatureFormGroup.patchValue({id:r.id,label:r.label,notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.chargeNatureFormGroup.valid==!0?this.data.mode=="creation"?this.chargeNaturesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.chargeNaturesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.chargeNatureFormGroup.markAllAsTouched()}resetForm(){this.chargeNatureFormGroup.reset({id:void 0,label:"",notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.chargeNatureFormGroup.markAsUntouched(),this.chargeNatureFormGroup.clearValidators(),this.chargeNatureFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.chargeNatureFormGroup.getRawValue())}getUpdate(){return J({},this.chargeNatureFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(ft),g(j))},l.\u0275cmp=D({type:l,selectors:[["app-charge-nature-form"]],viewQuery:function(r,i){if(r&1&&w(Yi,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:25,vars:5,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3","h-64",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"w-80"],[3,"required"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,er,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"my-form-field",9)(11,"my-label",10),m(12,"Libell\xE9"),n(),d(13,"input",11,12),p(15,tr,2,0,"my-error",13),n(),o(16,"my-form-field",9)(17,"my-label"),m(18,"Notes"),n(),d(19,"textarea",14),n()()(),o(20,"div",15)(21,"button",16),h("click",function(){return i.create()}),m(22,"Nouvelle "),n(),o(23,"button",17),h("click",function(){return i.save()}),m(24,"Sauvegarder"),n()()()),r&2){let s;c(3),M(" ",i.data.mode=="creation"?"Nouvelle":"Modifier"," nature charge "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.chargeNatureFormGroup),c(3),u("required",!0),c(4),u("ngIf",((s=i.chargeNatureFormGroup.get("label"))==null?null:s.invalid)&&(((s=i.chargeNatureFormGroup.get("label"))==null?null:s.dirty)||((s=i.chargeNatureFormGroup.get("label"))==null?null:s.touched))&&((s=i.chargeNatureFormGroup.get("label"))==null?null:s.getError("required")))}},dependencies:[V,R,W,he,L,O,q,H,A,$,xe,P,Q,Z,Se],encapsulation:2});let t=l;return t})();var ir=["firstFocused"];function rr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function nr(t,l){if(t&1){let a=F();o(0,"div",29)(1,"div",30)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",31),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",32),n()(),o(6,"form",33)(7,"my-form-field")(8,"my-label"),m(9,"Libell\xE9 *"),n(),d(10,"input",34,35),p(12,rr,2,0,"my-error",36),n()(),o(13,"div",37)(14,"button",38),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),n(),o(16,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(17,"Appliquer"),n()()()}if(t&2){let a=f(),e;c(6),u("formGroup",a.chargeNatureFilterFormGroup),c(6),u("ngIf",((e=a.chargeNatureFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=a.chargeNatureFilterFormGroup.get("label"))==null?null:e.dirty)||((e=a.chargeNatureFilterFormGroup.get("label"))==null?null:e.touched))&&((e=a.chargeNatureFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function or(t,l){if(t&1){let a=F();o(0,"button",39),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",40),d(2,"i",41),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function lr(t,l){if(t&1){let a=F();o(0,"th",42)(1,"mat-checkbox",43),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function ar(t,l){if(t&1){let a=F();o(0,"td",44)(1,"mat-checkbox",45),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function sr(t,l){t&1&&(o(0,"th",42),m(1,"Code "),n())}function mr(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function cr(t,l){t&1&&(o(0,"th",42),m(1,"Libell\xE9 "),n())}function ur(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.label)}}function dr(t,l){t&1&&(o(0,"th",42),m(1,"Notes"),n())}function pr(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.notes)}}function fr(t,l){t&1&&(o(0,"th",46),m(1,"Action"),n())}function hr(t,l){if(t&1){let a=F();o(0,"td",44)(1,"div",47)(2,"button",48),d(3,"i",49),n(),o(4,"button",50),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",51),n(),o(6,"button",50),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",52),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function gr(t,l){t&1&&d(0,"tr",53)}function _r(t,l){if(t&1){let a=F();o(0,"tr",54),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function yr(t,l){t&1&&(o(0,"div",55)(1,"p",56),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var qt=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_){this.ChargeNaturesHttp=e,this.snackBar=r,this.fb=i,this.matDialog=s,this.traceability=_,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","notes","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.chargeNatureFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.ChargeNatures=[],this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.chargeNatureFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.chargeNatureFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.ChargeNaturesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(Rt,{data:{id:r,mode:e},disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.chargeNatureFilterChanged.emit()}resetItemsFilterForm(){this.chargeNatureFilterFormGroup.reset({label:""}),this.chargeNatureFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.ChargeNaturesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.chargeNatureFilterFormGroup.get("label")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.label)&&e.append("label",r.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(ft),g(j),g(B),g(we),g(be))},l.\u0275cmp=D({type:l,selectors:[["app-charge-natures-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(ir,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:42,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Natures charges"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,nr,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,or,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Nature charge"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,lr,2,3,"th",18)(25,ar,2,2,"td",19),C(),y(26,20),p(27,sr,2,0,"th",18)(28,mr,2,1,"td",19),C(),y(29,21),p(30,cr,2,0,"th",18)(31,ur,2,1,"td",19),C(),y(32,22),p(33,dr,2,0,"th",18)(34,pr,2,1,"td",19),C(),y(35,23),p(36,fr,2,0,"th",24)(37,hr,8,1,"td",19),C(),p(38,gr,1,0,"tr",25)(39,_r,1,0,"tr",26),n(),p(40,yr,3,0,"div",27),n(),d(41,"mat-paginator",28),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(16),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,R,W,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,Z],styles:[`app-charge-natures-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var xr=["firstFocused"];function Sr(t,l){if(t&1&&d(0,"my-global-errors",41),t&2){let a=f();u("errors",a.errors)}}function br(t,l){if(t&1&&(y(0),o(1,"option",42),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function vr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Fr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Er(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function wr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function kr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Gr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Ir(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Mr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Tr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Nr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Dr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Vr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Ar(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Lr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Or(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Rr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function qr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Hr(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Br(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var Ht=(()=>{let l=class l{constructor(e,r,i,s,_,b,I){this.fb=e,this.dialogRef=r,this.data=i,this.snackBar=s,this.fencesHttp=_,this.categoriesHttp=b,this.stocksHttp=I,this.errors=[],this.categories=[],this.fenceFormGroup=this.fb.group({id:[void 0],code:[""],categoryId:[void 0,[E.required]],date:[Je(),[E.required]],inStockQuantity:[0,[E.required]],inStockAmount:[0,[E.required]],calculatedInStockQuantity:[{value:0,disabled:!0},[E.required]],calculatedInStockAmount:[{value:0,disabled:!0},[E.required]],totalCustomersSaleAmount:[{value:0,disabled:!0},[E.required]],totalPremisesSaleAmount:[{value:0,disabled:!0},[E.required]],totalPurchaseAmount:[{value:0,disabled:!0},[E.required]],totalCharges:[{value:0,disabled:!0},[E.required]],totalLosses:[{value:0,disabled:!0},[E.required]],totalEmployeesPayments:[{value:0,disabled:!0},[E.required]],totalEmployeesDebts:[{value:0,disabled:!0},[E.required]],totalSuppliersDebts:[{value:0,disabled:!0},[E.required]],totalCustomersDebts:[{value:0,disabled:!0},[E.required]],totalBatchesStocksAmount:[{value:0,disabled:!0},[E.required]],totalBatchesIngredientsAmount:[{value:0,disabled:!0},[E.required]],rawProfit:[{value:0,disabled:!0},[E.required]],marginProfit:[{value:0,disabled:!0},[E.required]],notes:[""]})}ngOnInit(){this.categoriesHttp.getAll().subscribe({next:e=>{this.categories=e,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.onStart(),this.handleFormChanged()}loadData(e){this.fencesHttp.getOneById(e).subscribe({next:r=>{this.fenceFormGroup.patchValue({id:r.id,code:r.code,categoryId:r.categoryId.id,date:ut(r.date),inStockQuantity:r.inStockQuantity,inStockAmount:r.inStockAmount,calculatedInStockQuantity:r.calculatedInStockQuantity,calculatedInStockAmount:r.calculatedInStockAmount,totalCustomersSaleAmount:r.totalCustomersSaleAmount,totalPremisesSaleAmount:r.totalPremisesSaleAmount,totalPurchaseAmount:r.totalPurchaseAmount,totalCharges:r.totalCharges,totalLosses:r.totalLosses,totalEmployeesPayments:r.totalEmployeesPayments,totalEmployeesDebts:r.totalEmployeesDebts,totalSuppliersDebts:r.totalSuppliersDebts,totalCustomersDebts:r.totalCustomersDebts,totalBatchesStocksAmount:r.totalBatchesStocksAmount,totalBatchesIngredientsAmount:r.totalBatchesIngredientsAmount,rawProfit:r.rawProfit,marginProfit:r.marginProfit,notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.fenceFormGroup.valid==!0?this.data.mode=="creation"?this.fencesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.fencesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.fenceFormGroup.markAllAsTouched()}resetForm(){this.fenceFormGroup.reset({id:void 0,code:"",categoryId:void 0,inStockQuantity:0,inStockAmount:0,calculatedInStockQuantity:0,calculatedInStockAmount:0,totalCustomersSaleAmount:0,totalPremisesSaleAmount:0,totalPurchaseAmount:0,totalCharges:0,totalLosses:0,totalEmployeesPayments:0,totalEmployeesDebts:0,totalSuppliersDebts:0,totalCustomersDebts:0,totalBatchesStocksAmount:0,totalBatchesIngredientsAmount:0,rawProfit:0,marginProfit:0,date:Je(),notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.fenceFormGroup.markAsUntouched(),this.fenceFormGroup.clearValidators(),this.fenceFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.fenceFormGroup.getRawValue())}getUpdate(){return J({},this.fenceFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}handleFormChanged(){this.fenceFormGroup.valueChanges.subscribe({next:e=>{Nt([this.fencesHttp.getStocksTotalQuantity(e?.categoryId),this.fencesHttp.getStocksTotalAmount(e?.categoryId),this.fencesHttp.getCustomersSalesTotalAmount(e?.categoryId),this.fencesHttp.getPremisesSalesTotalAmount(e?.categoryId),this.fencesHttp.getPurchasesTotalCost(e?.categoryId),this.fencesHttp.getBatchesTotalAmount(e?.categoryId)]).subscribe({next:([r,i,s,_,b,I])=>{this.fenceFormGroup.get("calculatedInStockQuantity")?.setValue(T(r.total),{emitEvent:!1}),this.fenceFormGroup.get("calculatedInStockAmount")?.setValue(T(i.total),{emitEvent:!1}),this.fenceFormGroup.get("totalCustomersSaleAmount")?.setValue(T(s.total),{emitEvent:!1}),this.fenceFormGroup.get("totalCustomersSaleAmount")?.setValue(T(_.total),{emitEvent:!1}),this.fenceFormGroup.get("totalPurchaseAmount")?.setValue(T(b.total),{emitEvent:!1}),this.fenceFormGroup.get("totalBatchesStocksAmount")?.setValue(T(I.totalItems),{emitEvent:!1}),this.fenceFormGroup.get("totalBatchesIngredientsAmount")?.setValue(T(I.totalIngredients),{emitEvent:!1}),this.fenceFormGroup.get("rawProfit")?.setValue(T(this.fenceFormGroup.get("totalCustomersSaleAmount")?.value)+T(this.fenceFormGroup.get("totalPremisesSaleAmount")?.value)-T(this.fenceFormGroup.get("totalPurchaseAmount")?.value),{emitEvent:!1});let Y=T(this.fenceFormGroup.get("rawProfit")?.value)-T(this.fenceFormGroup.get("totalCharges")?.value)-T(this.fenceFormGroup.get("totalLosses")?.value)-T(this.fenceFormGroup.get("totalEmployeesPayments")?.value)-T(this.fenceFormGroup.get("totalEmployeesDebts")?.value)-T(this.fenceFormGroup.get("totalSuppliersDebts")?.value)-T(this.fenceFormGroup.get("totalCustomersDebts")?.value)-T(this.fenceFormGroup.get("totalBatchesStocksAmount")?.value)-T(this.fenceFormGroup.get("totalBatchesIngredientsAmount")?.value)+T(this.fenceFormGroup.get("inStockAmount")?.value);this.fenceFormGroup.get("marginProfit")?.setValue(Y,{emitEvent:!1})}})}})}onStart(){Nt([this.fencesHttp.getChargesTotalAmount(),this.fencesHttp.getLossesTotalAmount(),this.fencesHttp.getEmployeesTotalPayments(),this.fencesHttp.getEmployeesTotalDebts(),this.fencesHttp.getSuppliersTotalDebts(),this.fencesHttp.getCustomersTotalDebts()]).subscribe({next:([e,r,i,s,_,b])=>{this.fenceFormGroup.get("totalCharges")?.setValue(T(e.total),{emitEvent:!1}),this.fenceFormGroup.get("totalLosses")?.setValue(T(r.total),{emitEvent:!1}),this.fenceFormGroup.get("totalEmployeesPayments")?.setValue(T(i.total),{emitEvent:!1}),this.fenceFormGroup.get("totalEmployeesDebts")?.setValue(T(s.total),{emitEvent:!1}),this.fenceFormGroup.get("totalSuppliersDebts")?.setValue(T(_.total),{emitEvent:!1}),this.fenceFormGroup.get("totalCustomersDebts")?.setValue(T(b.total),{emitEvent:!1})}})}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(j),g(Mt),g(wt),g(Jt))},l.\u0275cmp=D({type:l,selectors:[["app-fence-form"]],viewQuery:function(r,i){if(r&1&&w(xr,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:131,vars:42,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-2","mt-3",3,"formGroup"],[1,"flex","flex-row","gap-x-3"],[1,"flex","flex-col","gap-y-2"],["formControlName","id","type","number",1,"!hidden"],[1,"w-64"],[3,"required"],["formControlName","categoryId","myInput","","size","small"],[4,"ngFor","ngForOf"],[4,"ngIf"],["formControlName","code","type","text","myInput","","size","small"],["firstFocused",""],["formControlName","date","type","date","myInput","","size","small"],["formControlName","notes","myTextarea","","type","text"],["formControlName","inStockQuantity","type","number","myInput","","size","small"],["formControlName","inStockAmount","type","number","myInput","","size","small"],["formControlName","rawProfit","type","number","myInput","","size","small","myCalculableField",""],["formControlName","marginProfit","type","number","myInput","","size","small","myCalculableField",""],["formControlName","calculatedInStockQuantity","type","number","myInput","","myCalculableField","","size","small"],["formControlName","calculatedInStockAmount","type","number","myInput","","myCalculableField","","size","small"],["formControlName","totalCustomersSaleAmount","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalPremisesSaleAmount","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalPurchaseAmount","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalBatchesStocksAmount","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalBatchesIngredientsAmount","type","number","myInput","","size","small","myCalculableField",""],[1,"flex","flex-row","gap-x-5"],["formControlName","totalCharges","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalLosses","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalEmployeesPayments","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalEmployeesDebts","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalSuppliersDebts","type","number","myInput","","size","small","myCalculableField",""],["formControlName","totalCustomersDebts","type","number","myInput","","size","small","myCalculableField",""],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,Sr,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7)(9,"div",8)(10,"div",9),d(11,"input",10),o(12,"my-form-field",11)(13,"my-label",12),m(14,"Cat\xE9gorie"),n(),o(15,"select",13),p(16,br,3,2,"ng-container",14),n(),p(17,vr,2,0,"my-error",15),n(),o(18,"my-form-field",11)(19,"my-label"),m(20,"Code"),n(),d(21,"input",16,17),n(),o(23,"my-form-field",11)(24,"my-label",12),m(25,"Date"),n(),d(26,"input",18),p(27,Fr,2,0,"my-error",15),n(),o(28,"my-form-field",11)(29,"my-label"),m(30,"Notes"),n(),d(31,"textarea",19),n()(),o(32,"div",9)(33,"my-form-field",11)(34,"my-label",12),m(35,"Quantit\xE9 au stock"),n(),d(36,"input",20),p(37,Er,2,0,"my-error",15),n(),o(38,"my-form-field",11)(39,"my-label",12),m(40,"Montant de stock"),n(),d(41,"input",21),p(42,wr,2,0,"my-error",15),n(),o(43,"my-form-field",11)(44,"my-label",12),m(45,"B\xE9n\xE9fice brut"),n(),d(46,"input",22),p(47,kr,2,0,"my-error",15),n(),o(48,"my-form-field",11)(49,"my-label",12),m(50,"B\xE9n\xE9fice net"),n(),d(51,"input",23),p(52,Gr,2,0,"my-error",15),n()(),o(53,"div",9)(54,"my-form-field",11)(55,"my-label",12),m(56,"Quantit\xE9 au stock (Calcul\xE9e)"),n(),d(57,"input",24),p(58,Ir,2,0,"my-error",15),n(),o(59,"my-form-field",11)(60,"my-label",12),m(61,"Montant de stock (Calcul\xE9e)"),n(),d(62,"input",25),p(63,Mr,2,0,"my-error",15),n(),o(64,"my-form-field",11)(65,"my-label",12),m(66,"Total ventes (Clients)"),n(),d(67,"input",26),p(68,Tr,2,0,"my-error",15),n(),o(69,"my-form-field",11)(70,"my-label",12),m(71,"Total ventes (Locaux)"),n(),d(72,"input",27),p(73,Nr,2,0,"my-error",15),n(),o(74,"my-form-field",11)(75,"my-label",12),m(76,"Total achats"),n(),d(77,"input",28),p(78,Dr,2,0,"my-error",15),n(),o(79,"my-form-field",11)(80,"my-label",12),m(81,"Total lots (Stocks)"),n(),d(82,"input",29),p(83,Vr,2,0,"my-error",15),n(),o(84,"my-form-field",11)(85,"my-label",12),m(86,"Total lots (Ingr\xE9dients)"),n(),d(87,"input",30),p(88,Ar,2,0,"my-error",15),n()(),o(89,"div",9)(90,"div",31)(91,"my-form-field",11)(92,"my-label",12),m(93,"Total charges"),n(),d(94,"input",32),p(95,Lr,2,0,"my-error",15),n()(),o(96,"div",31)(97,"my-form-field",11)(98,"my-label",12),m(99,"Total pertes"),n(),d(100,"input",33),p(101,Or,2,0,"my-error",15),n()(),o(102,"div",31)(103,"my-form-field",11)(104,"my-label",12),m(105,"Total paiements employ\xE9es"),n(),d(106,"input",34),p(107,Rr,2,0,"my-error",15),n()(),o(108,"div",31)(109,"my-form-field",11)(110,"my-label",12),m(111,"Total dettes employ\xE9es"),n(),d(112,"input",35),p(113,qr,2,0,"my-error",15),n()(),o(114,"div",31)(115,"my-form-field",11)(116,"my-label",12),m(117,"Total dettes fournisseurs"),n(),d(118,"input",36),p(119,Hr,2,0,"my-error",15),n()(),o(120,"div",31)(121,"my-form-field",11)(122,"my-label",12),m(123,"Total dettes clients"),n(),d(124,"input",37),p(125,Br,2,0,"my-error",15),n()()()()()(),o(126,"div",38)(127,"button",39),h("click",function(){return i.create()}),m(128,"Nouveau "),n(),o(129,"button",40),h("click",function(){return i.save()}),m(130,"Cl\xF4turer"),n()()()),r&2){let s,_,b,I,Y,ee,te,ie,Ye,et,tt,it,rt,nt,ot,lt,at,st,mt;c(3),M(" ",i.data.mode=="creation"?"Nouveau":"Modifier"," Cl\xF4ture "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.fenceFormGroup),c(5),u("required",!0),c(3),u("ngForOf",i.categories),c(),u("ngIf",((s=i.fenceFormGroup.get("categoryId"))==null?null:s.invalid)&&(((s=i.fenceFormGroup.get("categoryId"))==null?null:s.dirty)||((s=i.fenceFormGroup.get("categoryId"))==null?null:s.touched))&&((s=i.fenceFormGroup.get("categoryId"))==null?null:s.getError("required"))),c(7),u("required",!0),c(3),u("ngIf",((_=i.fenceFormGroup.get("date"))==null?null:_.invalid)&&(((_=i.fenceFormGroup.get("date"))==null?null:_.dirty)||((_=i.fenceFormGroup.get("date"))==null?null:_.touched))&&((_=i.fenceFormGroup.get("date"))==null?null:_.getError("required"))),c(7),u("required",!0),c(3),u("ngIf",((b=i.fenceFormGroup.get("inStockQuantity"))==null?null:b.invalid)&&(((b=i.fenceFormGroup.get("inStockQuantity"))==null?null:b.dirty)||((b=i.fenceFormGroup.get("inStockQuantity"))==null?null:b.touched))&&((b=i.fenceFormGroup.get("inStockQuantity"))==null?null:b.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((I=i.fenceFormGroup.get("inStockAmount"))==null?null:I.invalid)&&(((I=i.fenceFormGroup.get("inStockAmount"))==null?null:I.dirty)||((I=i.fenceFormGroup.get("inStockAmount"))==null?null:I.touched))&&((I=i.fenceFormGroup.get("inStockAmount"))==null?null:I.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((Y=i.fenceFormGroup.get("rawProfit"))==null?null:Y.invalid)&&(((Y=i.fenceFormGroup.get("rawProfit"))==null?null:Y.dirty)||((Y=i.fenceFormGroup.get("rawProfit"))==null?null:Y.touched))&&((Y=i.fenceFormGroup.get("rawProfit"))==null?null:Y.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((ee=i.fenceFormGroup.get("marginProfit"))==null?null:ee.invalid)&&(((ee=i.fenceFormGroup.get("marginProfit"))==null?null:ee.dirty)||((ee=i.fenceFormGroup.get("marginProfit"))==null?null:ee.touched))&&((ee=i.fenceFormGroup.get("marginProfit"))==null?null:ee.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((te=i.fenceFormGroup.get("calculatedInStockQuantity"))==null?null:te.invalid)&&(((te=i.fenceFormGroup.get("calculatedInStockQuantity"))==null?null:te.dirty)||((te=i.fenceFormGroup.get("calculatedInStockQuantity"))==null?null:te.touched))&&((te=i.fenceFormGroup.get("calculatedInStockQuantity"))==null?null:te.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((ie=i.fenceFormGroup.get("calculatedInStockAmount"))==null?null:ie.invalid)&&(((ie=i.fenceFormGroup.get("calculatedInStockAmount"))==null?null:ie.dirty)||((ie=i.fenceFormGroup.get("calculatedInStockAmount"))==null?null:ie.touched))&&((ie=i.fenceFormGroup.get("calculatedInStockAmount"))==null?null:ie.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((Ye=i.fenceFormGroup.get("totalCustomersSaleAmount"))==null?null:Ye.invalid)&&(((Ye=i.fenceFormGroup.get("totalCustomersSaleAmount"))==null?null:Ye.dirty)||((Ye=i.fenceFormGroup.get("totalCustomersSaleAmount"))==null?null:Ye.touched))&&((Ye=i.fenceFormGroup.get("totalCustomersSaleAmount"))==null?null:Ye.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((et=i.fenceFormGroup.get("totalPremisesSaleAmount"))==null?null:et.invalid)&&(((et=i.fenceFormGroup.get("totalPremisesSaleAmount"))==null?null:et.dirty)||((et=i.fenceFormGroup.get("totalPremisesSaleAmount"))==null?null:et.touched))&&((et=i.fenceFormGroup.get("totalPremisesSaleAmount"))==null?null:et.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((tt=i.fenceFormGroup.get("totalPurchaseAmount"))==null?null:tt.invalid)&&(((tt=i.fenceFormGroup.get("totalPurchaseAmount"))==null?null:tt.dirty)||((tt=i.fenceFormGroup.get("totalPurchaseAmount"))==null?null:tt.touched))&&((tt=i.fenceFormGroup.get("totalPurchaseAmount"))==null?null:tt.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((it=i.fenceFormGroup.get("totalBatchesStocksAmount"))==null?null:it.invalid)&&(((it=i.fenceFormGroup.get("totalBatchesStocksAmount"))==null?null:it.dirty)||((it=i.fenceFormGroup.get("totalBatchesStocksAmount"))==null?null:it.touched))&&((it=i.fenceFormGroup.get("totalBatchesStocksAmount"))==null?null:it.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((rt=i.fenceFormGroup.get("totalBatchesIngredientsAmount"))==null?null:rt.invalid)&&(((rt=i.fenceFormGroup.get("totalBatchesIngredientsAmount"))==null?null:rt.dirty)||((rt=i.fenceFormGroup.get("totalBatchesIngredientsAmount"))==null?null:rt.touched))&&((rt=i.fenceFormGroup.get("totalBatchesIngredientsAmount"))==null?null:rt.getError("required"))),c(4),u("required",!0),c(3),u("ngIf",((nt=i.fenceFormGroup.get("totalCharges"))==null?null:nt.invalid)&&(((nt=i.fenceFormGroup.get("totalCharges"))==null?null:nt.dirty)||((nt=i.fenceFormGroup.get("totalCharges"))==null?null:nt.touched))&&((nt=i.fenceFormGroup.get("totalCharges"))==null?null:nt.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((ot=i.fenceFormGroup.get("totalLosses"))==null?null:ot.invalid)&&(((ot=i.fenceFormGroup.get("totalLosses"))==null?null:ot.dirty)||((ot=i.fenceFormGroup.get("totalLosses"))==null?null:ot.touched))&&((ot=i.fenceFormGroup.get("totalLosses"))==null?null:ot.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((lt=i.fenceFormGroup.get("totalEmployeesPayments"))==null?null:lt.invalid)&&(((lt=i.fenceFormGroup.get("totalEmployeesPayments"))==null?null:lt.dirty)||((lt=i.fenceFormGroup.get("totalEmployeesPayments"))==null?null:lt.touched))&&((lt=i.fenceFormGroup.get("totalEmployeesPayments"))==null?null:lt.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((at=i.fenceFormGroup.get("totalEmployeesDebts"))==null?null:at.invalid)&&(((at=i.fenceFormGroup.get("totalEmployeesDebts"))==null?null:at.dirty)||((at=i.fenceFormGroup.get("totalEmployeesDebts"))==null?null:at.touched))&&((at=i.fenceFormGroup.get("totalEmployeesDebts"))==null?null:at.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((st=i.fenceFormGroup.get("totalSuppliersDebts"))==null?null:st.invalid)&&(((st=i.fenceFormGroup.get("totalSuppliersDebts"))==null?null:st.dirty)||((st=i.fenceFormGroup.get("totalSuppliersDebts"))==null?null:st.touched))&&((st=i.fenceFormGroup.get("totalSuppliersDebts"))==null?null:st.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((mt=i.fenceFormGroup.get("totalCustomersDebts"))==null?null:mt.invalid)&&(((mt=i.fenceFormGroup.get("totalCustomersDebts"))==null?null:mt.dirty)||((mt=i.fenceFormGroup.get("totalCustomersDebts"))==null?null:mt.touched))&&((mt=i.fenceFormGroup.get("totalCustomersDebts"))==null?null:mt.getError("required")))}},dependencies:[Ze,V,R,_e,ye,W,he,ge,L,O,q,H,A,$,xe,P,Q,Z,Se,Tt],styles:[`app-fence-form{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var zr=["firstFocused"];function Pr(t,l){if(t&1&&(y(0),o(1,"option",45),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function Qr(t,l){if(t&1){let a=F();o(0,"div",36)(1,"div",37)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",38),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",39),n()(),o(6,"form",40)(7,"my-form-field")(8,"my-label"),m(9,"Cat\xE9gorie"),n(),o(10,"select",41),p(11,Pr,3,2,"ng-container",42),n()()(),o(12,"div",43)(13,"button",44),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(14,"R\xE9initialiser"),n(),o(15,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(16,"Appliquer"),n()()()}if(t&2){let a=f();c(6),u("formGroup",a.transferFilterFormGroup),c(5),u("ngForOf",a.categories)}}function $r(t,l){if(t&1){let a=F();o(0,"button",46),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",47),d(2,"i",48),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function jr(t,l){if(t&1){let a=F();o(0,"th",49)(1,"mat-checkbox",50),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Ur(t,l){if(t&1){let a=F();o(0,"td",51)(1,"mat-checkbox",52),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function Wr(t,l){t&1&&(o(0,"th",49),m(1,"Code "),n())}function Zr(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function Jr(t,l){t&1&&(o(0,"th",49),m(1,"Cat\xE9gorie "),n())}function Kr(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),v(a.categoryId.label)}}function Xr(t,l){t&1&&(o(0,"th",49)(1,"div",1)(2,"span"),m(3,"Quantit\xE9"),n(),o(4,"span",53),m(5,"r\xE9el"),n(),o(6,"span",54),m(7,"calcul\xE9e"),n()()())}function Yr(t,l){if(t&1&&(o(0,"td",51)(1,"div",1)(2,"span",55),m(3),n(),o(4,"span",56),m(5),n()()()),t&2){let a=l.$implicit;c(3),v(a.inStockQuantity),c(2),v(a.calculatedInStockQuantity)}}function en(t,l){t&1&&(o(0,"th",49)(1,"div",1)(2,"span"),m(3,"Montant"),n(),o(4,"span",53),m(5,"r\xE9el"),n(),o(6,"span",54),m(7,"calcul\xE9e"),n()()())}function tn(t,l){if(t&1&&(o(0,"td",51)(1,"div",1)(2,"span",55),m(3),n(),o(4,"span",56),m(5),n()()()),t&2){let a=l.$implicit;c(3),v(a.inStockAmount),c(2),v(a.calculatedInStockAmount)}}function rn(t,l){t&1&&(o(0,"th",49),m(1,"Montant d'achat"),n())}function nn(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),M(" ",a.totalPurchaseAmount," ")}}function on(t,l){t&1&&(o(0,"th",49),m(1,"Montant de vente"),n())}var ln=(t,l)=>[t,l];function an(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit,e=f();c(),M(" ",e.totalSales(Wt(1,ln,a.totalCustomersSaleAmount,a.totalPremisesSaleAmount))," ")}}function sn(t,l){t&1&&(o(0,"th",49),m(1,"Marge b\xE9n\xE9ficiaire (Net)"),n())}function mn(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),M(" ",a.marginProfit," ")}}function cn(t,l){t&1&&(o(0,"th",49),m(1,"Marge b\xE9n\xE9ficiaire (Brut)"),n())}function un(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),M(" ",a.rawProfit," ")}}function dn(t,l){t&1&&(o(0,"th",49),m(1,"Date "),n())}function pn(t,l){if(t&1&&(o(0,"td",51),m(1),We(2,"date"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.date,"dd/MM/yyyy"))}}function fn(t,l){t&1&&(o(0,"th",49),m(1,"Notes"),n())}function hn(t,l){if(t&1&&(o(0,"td",51),m(1),n()),t&2){let a=l.$implicit;c(),v(a.notes)}}function gn(t,l){t&1&&(o(0,"th",57),m(1,"Action"),n())}function _n(t,l){if(t&1){let a=F();o(0,"td",51)(1,"div",58)(2,"button",59),d(3,"i",60),n(),o(4,"button",61),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",62),n(),o(6,"button",61),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",63),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function yn(t,l){t&1&&d(0,"tr",64)}function Cn(t,l){if(t&1){let a=F();o(0,"tr",65),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function xn(t,l){t&1&&(o(0,"div",66)(1,"p",67),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var Bt=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_,b){this.snackBar=e,this.fb=r,this.matDialog=i,this.traceability=s,this.categoriesHttp=_,this.fencesHttp=b,this.dataSource=new Re([]),this.displayedColumns=["select","code","categoryId.label","inStockQuantity","inStockAmount","totalPurchaseAmount","totalSaleAmount","marginProfit","rawProfit","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.stockFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.categories=[],this.transferFilterFormGroup=this.fb.group({categoryId:[void 0]})}ngOnInit(){this.categoriesHttp.getAll().subscribe({next:e=>this.categories=e})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.stockFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.fencesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(Ht,{data:{id:r,mode:e},minWidth:"95vw",minHeight:"95vh",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.stockFilterChanged.emit()}resetItemsFilterForm(){this.transferFilterFormGroup.reset({categoryId:void 0}),this.stockFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.fencesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,categoryId:this.transferFilterFormGroup.get("categoryId")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.categoryId)&&e.append("categoryId",r.categoryId),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}totalSales(e){return e.reduce((r,i)=>T(r)+T(i),0)}};l.\u0275fac=function(r){return new(r||l)(g(j),g(B),g(we),g(be),g(wt),g(Mt))},l.\u0275cmp=D({type:l,selectors:[["app-fences-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(zr,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:63,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","!w-[calc(100vw-140px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","categoryId.label"],["matColumnDef","inStockQuantity"],["matColumnDef","inStockAmount"],["matColumnDef","totalPurchaseAmount"],["matColumnDef","totalSaleAmount"],["matColumnDef","marginProfit"],["matColumnDef","rawProfit"],["matColumnDef","date"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[500px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","categoryId","myInput",""],[4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],[1,"text-orange-500","!text-xs"],[1,"text-blue-500","!text-xs"],[1,"text-orange-500","!text-sm"],[1,"text-blue-500","!text-sm"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Cl\xF4tures"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,Qr,17,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,$r,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Cl\xF4ture"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,jr,2,3,"th",18)(25,Ur,2,2,"td",19),C(),y(26,20),p(27,Wr,2,0,"th",18)(28,Zr,2,1,"td",19),C(),y(29,21),p(30,Jr,2,0,"th",18)(31,Kr,2,1,"td",19),C(),y(32,22),p(33,Xr,8,0,"th",18)(34,Yr,6,2,"td",19),C(),y(35,23),p(36,en,8,0,"th",18)(37,tn,6,2,"td",19),C(),y(38,24),p(39,rn,2,0,"th",18)(40,nn,2,1,"td",19),C(),y(41,25),p(42,on,2,0,"th",18)(43,an,2,4,"td",19),C(),y(44,26),p(45,sn,2,0,"th",18)(46,mn,2,1,"td",19),C(),y(47,27),p(48,cn,2,0,"th",18)(49,un,2,1,"td",19),C(),y(50,28),p(51,dn,2,0,"th",18)(52,pn,3,4,"td",19),C(),y(53,29),p(54,fn,2,0,"th",18)(55,hn,2,1,"td",19),C(),y(56,30),p(57,gn,2,0,"th",31)(58,_n,8,1,"td",19),C(),p(59,yn,1,0,"tr",32)(60,Cn,1,0,"tr",33),n(),p(61,xn,3,0,"div",34),n(),d(62,"mat-paginator",35),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(37),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[Ze,V,R,_e,ye,ge,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,ct],styles:[`app-fences-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var Sn=["firstFocused"];function bn(t,l){if(t&1&&d(0,"my-global-errors",23),t&2){let a=f();u("errors",a.errors)}}function vn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Fn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function En(t,l){if(t&1&&(y(0),o(1,"option",24),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function wn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function kn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var zt=(()=>{let l=class l{constructor(e,r,i,s,_,b){this.fb=e,this.dialogRef=r,this.data=i,this.snackBar=s,this.lossesHttp=_,this.losseNaturesHttp=b,this.errors=[],this.losseNatures=[],this.losseFormGroup=this.fb.group({id:[void 0],code:[""],label:["",[E.required]],losseNatureId:[void 0,[E.required]],amount:[0,[E.required]],date:[Je(),[E.required]],notes:[""]})}ngOnInit(){this.losseNaturesHttp.getAll().subscribe({next:e=>{this.losseNatures=e,this.data.mode=="edit"&&this.loadData(this.data.id)}})}loadData(e){this.lossesHttp.getOneById(e).subscribe({next:r=>{this.losseFormGroup.patchValue({id:r.id,code:r.code,label:r.label,losseNatureId:r.losseNatureId.id,amount:r.amount,date:ut(r.date),notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.losseFormGroup.valid==!0?this.data.mode=="creation"?this.lossesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.lossesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.losseFormGroup.markAllAsTouched()}resetForm(){this.losseFormGroup.reset({id:void 0,code:"",label:"",losseNatureId:void 0,amount:0,date:Je(),notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.losseFormGroup.markAsUntouched(),this.losseFormGroup.clearValidators(),this.losseFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.losseFormGroup.getRawValue())}getUpdate(){return J({},this.losseFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(j),g(Gt),g(pt))},l.\u0275cmp=D({type:l,selectors:[["app-losse-form"]],viewQuery:function(r,i){if(r&1&&w(Sn,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:48,vars:12,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","label","type","text","myInput",""],[4,"ngIf"],["formControlName","amount","type","number","myInput",""],["formControlName","losseNatureId","myInput",""],[4,"ngFor","ngForOf"],["formControlName","date","type","date","myInput",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,bn,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),n(),d(14,"input",10,11),n(),o(16,"my-form-field")(17,"my-label",12),m(18,"Libell\xE9"),n(),d(19,"input",13),p(20,vn,2,0,"my-error",14),n()(),o(21,"div",9)(22,"my-form-field")(23,"my-label",12),m(24,"Montant"),n(),d(25,"input",15),p(26,Fn,2,0,"my-error",14),n(),o(27,"my-form-field")(28,"my-label",12),m(29,"Nature"),n(),o(30,"select",16),p(31,En,3,2,"ng-container",17),n(),p(32,wn,2,0,"my-error",14),n()(),o(33,"div",9)(34,"my-form-field")(35,"my-label",12),m(36,"Date"),n(),d(37,"input",18),p(38,kn,2,0,"my-error",14),n()(),o(39,"my-form-field")(40,"my-label"),m(41,"Notes"),n(),d(42,"textarea",19),n()()(),o(43,"div",20)(44,"button",21),h("click",function(){return i.create()}),m(45,"Nouveau "),n(),o(46,"button",22),h("click",function(){return i.save()}),m(47,"Sauvegarder"),n()()()),r&2){let s,_,b,I;c(3),M(" ",i.data.mode=="creation"?"Nouveau ":"Modifier "," perte "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.losseFormGroup),c(9),u("required",!0),c(3),u("ngIf",((s=i.losseFormGroup.get("label"))==null?null:s.invalid)&&(((s=i.losseFormGroup.get("label"))==null?null:s.dirty)||((s=i.losseFormGroup.get("label"))==null?null:s.touched))&&((s=i.losseFormGroup.get("label"))==null?null:s.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((_=i.losseFormGroup.get("amount"))==null?null:_.invalid)&&(((_=i.losseFormGroup.get("amount"))==null?null:_.dirty)||((_=i.losseFormGroup.get("amount"))==null?null:_.touched))&&((_=i.losseFormGroup.get("amount"))==null?null:_.getError("required"))),c(2),u("required",!0),c(3),u("ngForOf",i.losseNatures),c(),u("ngIf",((b=i.losseFormGroup.get("losseNatureId"))==null?null:b.invalid)&&(((b=i.losseFormGroup.get("losseNatureId"))==null?null:b.dirty)||((b=i.losseFormGroup.get("losseNatureId"))==null?null:b.touched))&&((b=i.losseFormGroup.get("losseNatureId"))==null?null:b.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((I=i.losseFormGroup.get("date"))==null?null:I.invalid)&&(((I=i.losseFormGroup.get("date"))==null?null:I.dirty)||((I=i.losseFormGroup.get("date"))==null?null:I.touched))&&((I=i.losseFormGroup.get("date"))==null?null:I.getError("required")))}},dependencies:[Ze,V,R,_e,ye,W,he,ge,L,O,q,H,A,$,xe,P,Q,Z,Se],encapsulation:2});let t=l;return t})();var Gn=["firstFocused"];function In(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Mn(t,l){if(t&1){let a=F();o(0,"div",31)(1,"div",32)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",33),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",34),n()(),o(6,"form",35)(7,"my-form-field")(8,"my-label"),m(9,"Nom *"),n(),d(10,"input",36,37),p(12,In,2,0,"my-error",38),n()(),o(13,"div",39)(14,"button",40),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),n(),o(16,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(17,"Appliquer"),n()()()}if(t&2){let a=f(),e;c(6),u("formGroup",a.losseFilterFormGroup),c(6),u("ngIf",((e=a.losseFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=a.losseFilterFormGroup.get("label"))==null?null:e.dirty)||((e=a.losseFilterFormGroup.get("label"))==null?null:e.touched))&&((e=a.losseFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function Tn(t,l){if(t&1){let a=F();o(0,"button",41),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",42),d(2,"i",43),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function Nn(t,l){if(t&1){let a=F();o(0,"th",44)(1,"mat-checkbox",45),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Dn(t,l){if(t&1){let a=F();o(0,"td",46)(1,"mat-checkbox",47),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function Vn(t,l){t&1&&(o(0,"th",44),m(1,"Code "),n())}function An(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function Ln(t,l){t&1&&(o(0,"th",44),m(1,"Libell\xE9 "),n())}function On(t,l){if(t&1&&(o(0,"td",46),m(1),We(2,"myLimitTextLength"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.label,30))}}function Rn(t,l){t&1&&(o(0,"th",44),m(1,"Montant "),n())}function qn(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.amount)}}function Hn(t,l){t&1&&(o(0,"th",44),m(1,"Nature "),n())}function Bn(t,l){if(t&1&&(o(0,"td",46),m(1),n()),t&2){let a=l.$implicit;c(),v(a.losseNatureId.label)}}function zn(t,l){t&1&&(o(0,"th",44),m(1,"Date "),n())}function Pn(t,l){if(t&1&&(o(0,"td",46),m(1),We(2,"date"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.date,"dd/MM/yyyy"))}}function Qn(t,l){t&1&&(o(0,"th",48),m(1,"Action"),n())}function $n(t,l){if(t&1){let a=F();o(0,"td",46)(1,"div",49)(2,"button",50),d(3,"i",51),n(),o(4,"button",52),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",53),n(),o(6,"button",52),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",54),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function jn(t,l){t&1&&d(0,"tr",55)}function Un(t,l){if(t&1){let a=F();o(0,"tr",56),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function Wn(t,l){t&1&&(o(0,"div",57)(1,"p",58),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var Pt=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_){this.snackBar=e,this.fb=r,this.matDialog=i,this.traceability=s,this.lossesHttp=_,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","losseNatureId.label","amount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.losseFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.losses=[],this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.losseFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.losseFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.lossesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(zt,{data:{id:r,mode:e},minWidth:"512px",disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.losseFilterChanged.emit()}resetItemsFilterForm(){this.losseFilterFormGroup.reset({label:""}),this.losseFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.lossesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.losseFilterFormGroup.get("label")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.label)&&e.append("label",r.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(j),g(B),g(we),g(be),g(Gt))},l.\u0275cmp=D({type:l,selectors:[["app-losses-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(Gn,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:48,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","amount"],["matColumnDef","losseNatureId.label"],["matColumnDef","date"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Pertes"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,Mn,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,Tn,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Perte"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,Nn,2,3,"th",18)(25,Dn,2,2,"td",19),C(),y(26,20),p(27,Vn,2,0,"th",18)(28,An,2,1,"td",19),C(),y(29,21),p(30,Ln,2,0,"th",18)(31,On,3,4,"td",19),C(),y(32,22),p(33,Rn,2,0,"th",18)(34,qn,2,1,"td",19),C(),y(35,23),p(36,Hn,2,0,"th",18)(37,Bn,2,1,"td",19),C(),y(38,24),p(39,zn,2,0,"th",18)(40,Pn,3,4,"td",19),C(),y(41,25),p(42,Qn,2,0,"th",26)(43,$n,8,1,"td",19),C(),p(44,jn,1,0,"tr",27)(45,Un,1,0,"tr",28),n(),p(46,Wn,3,0,"div",29),n(),d(47,"mat-paginator",30),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(22),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,R,W,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,Z,ct,Et],styles:[`app-losses-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var Zn=["firstFocused"];function Jn(t,l){if(t&1&&d(0,"my-global-errors",18),t&2){let a=f();u("errors",a.errors)}}function Kn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var Qt=(()=>{let l=class l{constructor(e,r,i,s,_){this.fb=e,this.dialogRef=r,this.data=i,this.losseNaturesHttp=s,this.snackBar=_,this.errors=[],this.losseNatureFormGroup=this.fb.group({id:[void 0],label:["",[E.required]],notes:[""]})}ngOnInit(){this.data.mode=="edit"&&this.loadData(this.data.id)}loadData(e){this.losseNaturesHttp.getOneById(e).subscribe({next:r=>{this.losseNatureFormGroup.patchValue({id:r.id,label:r.label,notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.losseNatureFormGroup.valid==!0?this.data.mode=="creation"?this.losseNaturesHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.data={id:e.data.id,mode:"edit"},this.loadData(e.data.id)):this.errors=e.errors},error:e=>console.error(e)}):this.losseNaturesHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.losseNatureFormGroup.markAllAsTouched()}resetForm(){this.losseNatureFormGroup.reset({id:void 0,label:"",notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.losseNatureFormGroup.markAsUntouched(),this.losseNatureFormGroup.clearValidators(),this.losseNatureFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.losseNatureFormGroup.getRawValue())}getUpdate(){return J({},this.losseNatureFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(pt),g(j))},l.\u0275cmp=D({type:l,selectors:[["app-losse-nature-form"]],viewQuery:function(r,i){if(r&1&&w(Zn,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:25,vars:5,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3","h-64",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"w-80"],[3,"required"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,Jn,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"my-form-field",9)(11,"my-label",10),m(12,"Libell\xE9"),n(),d(13,"input",11,12),p(15,Kn,2,0,"my-error",13),n(),o(16,"my-form-field",9)(17,"my-label"),m(18,"Notes"),n(),d(19,"textarea",14),n()()(),o(20,"div",15)(21,"button",16),h("click",function(){return i.create()}),m(22,"Nouvelle "),n(),o(23,"button",17),h("click",function(){return i.save()}),m(24,"Sauvegarder"),n()()()),r&2){let s;c(3),M(" ",i.data.mode=="creation"?"Nouvelle":"Modifier"," nature perte "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.losseNatureFormGroup),c(3),u("required",!0),c(4),u("ngIf",((s=i.losseNatureFormGroup.get("label"))==null?null:s.invalid)&&(((s=i.losseNatureFormGroup.get("label"))==null?null:s.dirty)||((s=i.losseNatureFormGroup.get("label"))==null?null:s.touched))&&((s=i.losseNatureFormGroup.get("label"))==null?null:s.getError("required")))}},dependencies:[V,R,W,he,L,O,q,H,A,$,xe,P,Q,Z,Se],encapsulation:2});let t=l;return t})();var Xn=["firstFocused"];function Yn(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function eo(t,l){if(t&1){let a=F();o(0,"div",29)(1,"div",30)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",31),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",32),n()(),o(6,"form",33)(7,"my-form-field")(8,"my-label"),m(9,"Libell\xE9 *"),n(),d(10,"input",34,35),p(12,Yn,2,0,"my-error",36),n()(),o(13,"div",37)(14,"button",38),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(15,"R\xE9initialiser"),n(),o(16,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(17,"Appliquer"),n()()()}if(t&2){let a=f(),e;c(6),u("formGroup",a.losseNatureFilterFormGroup),c(6),u("ngIf",((e=a.losseNatureFilterFormGroup.get("label"))==null?null:e.invalid)&&(((e=a.losseNatureFilterFormGroup.get("label"))==null?null:e.dirty)||((e=a.losseNatureFilterFormGroup.get("label"))==null?null:e.touched))&&((e=a.losseNatureFilterFormGroup.get("label"))==null?null:e.getError("required")))}}function to(t,l){if(t&1){let a=F();o(0,"button",39),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",40),d(2,"i",41),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function io(t,l){if(t&1){let a=F();o(0,"th",42)(1,"mat-checkbox",43),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function ro(t,l){if(t&1){let a=F();o(0,"td",44)(1,"mat-checkbox",45),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function no(t,l){t&1&&(o(0,"th",42),m(1,"Code "),n())}function oo(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function lo(t,l){t&1&&(o(0,"th",42),m(1,"Libell\xE9 "),n())}function ao(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.label)}}function so(t,l){t&1&&(o(0,"th",42),m(1,"Notes"),n())}function mo(t,l){if(t&1&&(o(0,"td",44),m(1),n()),t&2){let a=l.$implicit;c(),v(a.notes)}}function co(t,l){t&1&&(o(0,"th",46),m(1,"Action"),n())}function uo(t,l){if(t&1){let a=F();o(0,"td",44)(1,"div",47)(2,"button",48),d(3,"i",49),n(),o(4,"button",50),h("click",function(){let i=x(a).$implicit,s=f();return S(s.deleteItem(i))}),d(5,"i",51),n(),o(6,"button",50),h("click",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),d(7,"i",52),n()()()}if(t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function po(t,l){t&1&&d(0,"tr",53)}function fo(t,l){if(t&1){let a=F();o(0,"tr",54),h("dblclick",function(){let i=x(a).$implicit,s=f();return S(s.newItem("edit",i.id))}),n()}}function ho(t,l){t&1&&(o(0,"div",55)(1,"p",56),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var $t=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_){this.LosseNaturesHttp=e,this.snackBar=r,this.fb=i,this.matDialog=s,this.traceability=_,this.dataSource=new Re([]),this.displayedColumns=["select","code","label","notes","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.losseNatureFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.LosseNatures=[],this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.losseNatureFilterFormGroup=this.fb.group({label:[""]})}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.losseNatureFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.LosseNaturesHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(Qt,{data:{id:r,mode:e},disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.losseNatureFilterChanged.emit()}resetItemsFilterForm(){this.losseNatureFilterFormGroup.reset({label:""}),this.losseNatureFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.LosseNaturesHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,label:this.losseNatureFilterFormGroup.get("label")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.label)&&e.append("label",r.label),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(pt),g(j),g(B),g(we),g(be))},l.\u0275cmp=D({type:l,selectors:[["app-losse-natures-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(Xn,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:42,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","label"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",3,"dblclick",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[400px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],["formControlName","label","type","text","myInput",""],["firstFocused",""],[4,"ngIf"],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-icon-button","",3,"click"],[1,"ri-delete-bin-6-line","text-red-600"],[1,"ri-pencil-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer",3,"dblclick"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Natures pertes"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,eo,18,2,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,to,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Nature perte"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,io,2,3,"th",18)(25,ro,2,2,"td",19),C(),y(26,20),p(27,no,2,0,"th",18)(28,oo,2,1,"td",19),C(),y(29,21),p(30,lo,2,0,"th",18)(31,ao,2,1,"td",19),C(),y(32,22),p(33,so,2,0,"th",18)(34,mo,2,1,"td",19),C(),y(35,23),p(36,co,2,0,"th",24)(37,uo,8,1,"td",19),C(),p(38,po,1,0,"tr",25)(39,fo,1,0,"tr",26),n(),p(40,ho,3,0,"div",27),n(),d(41,"mat-paginator",28),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(16),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[V,R,W,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,Z],styles:[`app-losse-natures-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var go=["firstFocused"];function _o(t,l){if(t&1&&d(0,"my-global-errors",29),t&2){let a=f();u("errors",a.errors)}}function yo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Co(t,l){if(t&1&&(y(0),o(1,"option",30),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function xo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function So(t,l){if(t&1&&(y(0),o(1,"option",30),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function bo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function vo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Fo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function Eo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function wo(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}function ko(t,l){t&1&&(o(0,"my-error"),m(1," Veuillez remplir ce champ. "),n())}var jt=(()=>{let l=class l{constructor(e,r,i,s,_,b){this.fb=e,this.dialogRef=r,this.data=i,this.snackBar=s,this.transfersHttp=_,this.sourcesHttp=b,this.errors=[],this.sources=[],this.transferFormGroup=this.fb.group({id:[void 0],code:[""],fromMoneySourceId:[void 0,[E.required]],toMoneySourceId:[void 0,[E.required]],amount:[0,[E.required]],oldFromMoneySourceAmount:[{value:0,disabled:!0},[E.required]],newFromMoneySourceAmount:[{value:0,disabled:!0},[E.required]],oldToMoneySourceAmount:[{value:0,disabled:!0},[E.required]],newToMoneySourceAmount:[{value:0,disabled:!0},[E.required]],date:[Je(),[E.required]],notes:[""]})}ngOnInit(){this.sourcesHttp.getAll().subscribe({next:e=>{this.sources=e,this.data.mode=="edit"&&this.loadData(this.data.id)}}),this.handleFormChanged()}loadData(e){this.transfersHttp.getOneById(e).subscribe({next:r=>{this.transferFormGroup.patchValue({id:r.id,code:r.code,fromMoneySourceId:r.fromMoneySourceId.id,toMoneySourceId:r.toMoneySourceId.id,amount:r.amount,oldFromMoneySourceAmount:r.oldFromMoneySourceAmount,newFromMoneySourceAmount:r.newFromMoneySourceAmount,oldToMoneySourceAmount:r.oldToMoneySourceAmount,newToMoneySourceAmount:r.newToMoneySourceAmount,date:ut(r.date),notes:r.notes})}})}ngAfterViewInit(){setTimeout(()=>{this.firstFocused.nativeElement.focus()},300)}save(){this.errors=[],this.transferFormGroup.valid==!0?this.data.mode=="creation"?this.transfersHttp.create(this.getCreation()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.create()):this.errors=e.errors},error:e=>console.error(e)}):this.transfersHttp.update(this.data.id,this.getUpdate()).subscribe({next:e=>{e.success?(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.loadData(e.data.id)):this.errors=e.errors},error:e=>this.snackBar.open("L'op\xE9ration a \xE9chou\xE9","\u274C",{duration:7e3})}):this.transferFormGroup.markAllAsTouched()}resetForm(){this.transferFormGroup.reset({id:void 0,code:"",fromMoneySourceId:void 0,toMoneySourceId:void 0,amount:0,oldFromMoneySourceAmount:0,newFromMoneySourceAmount:0,oldToMoneySourceAmount:0,newToMoneySourceAmount:0,date:Je(),notes:""},{emitEvent:!1})}create(){this.resetForm(),this.firstFocused.nativeElement.focus(),this.transferFormGroup.markAsUntouched(),this.transferFormGroup.clearValidators(),this.transferFormGroup.clearAsyncValidators(),this.data={id:0,mode:"creation"}}getCreation(){return J({},this.transferFormGroup.getRawValue())}getUpdate(){return J({},this.transferFormGroup.getRawValue())}closeDialog(){this.dialogRef.close()}handleFormChanged(){this.transferFormGroup.get("fromMoneySourceId")?.valueChanges.subscribe({next:e=>{this.sourcesHttp.getOneById(e).subscribe({next:r=>{this.transferFormGroup.get("oldFromMoneySourceAmount")?.setValue(r.amount),this.transferFormGroup.get("newFromMoneySourceAmount")?.setValue(r.amount)}})}}),this.transferFormGroup.get("toMoneySourceId")?.valueChanges.subscribe({next:e=>{this.sourcesHttp.getOneById(e).subscribe({next:r=>{this.transferFormGroup.get("oldToMoneySourceAmount")?.setValue(r.amount),this.transferFormGroup.get("newToMoneySourceAmount")?.setValue(r.amount)}})}}),this.transferFormGroup.get("amount")?.valueChanges.subscribe({next:e=>{let r=T(this.transferFormGroup.get("oldFromMoneySourceAmount")?.value),i=T(this.transferFormGroup.get("oldToMoneySourceAmount")?.value);this.transferFormGroup.get("newFromMoneySourceAmount")?.setValue(r-T(e)),this.transferFormGroup.get("newToMoneySourceAmount")?.setValue(i+T(e))}})}};l.\u0275fac=function(r){return new(r||l)(g(B),g(Fe),g(Ee),g(j),g(It),g(dt))},l.\u0275cmp=D({type:l,selectors:[["app-money-source-transfer-form"]],viewQuery:function(r,i){if(r&1&&w(go,5),r&2){let s;k(s=G())&&(i.firstFocused=s.first)}},decls:76,vars:21,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"text-lg","font-medium"],[3,"click"],[1,"ri-close-line","text-2xl"],["class","px-3",3,"errors",4,"ngIf"],[1,"dialog-content"],[1,"flex","flex-col","gap-y-5","mt-3",3,"formGroup"],["formControlName","id","type","number",1,"!hidden"],[1,"inline-fields"],["formControlName","code","type","text","myInput",""],["firstFocused",""],[3,"required"],["formControlName","date","type","date","myInput",""],[4,"ngIf"],["formControlName","fromMoneySourceId","myInput",""],[4,"ngFor","ngForOf"],[1,"mt-10"],[1,"ri-arrow-right-line","text-xl"],["formControlName","toMoneySourceId","myInput",""],["formControlName","oldFromMoneySourceAmount","type","number","myInput","","myCalculableField",""],["formControlName","amount","type","number","myInput",""],["formControlName","oldToMoneySourceAmount","type","number","myInput","","myCalculableField",""],["formControlName","newFromMoneySourceAmount","type","number","myInput","","myCalculableField",""],["formControlName","newToMoneySourceAmount","type","number","myInput","","myCalculableField",""],["formControlName","notes","myTextarea","","type","text"],[1,"dialog-actions"],["mat-stroked-button","",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"px-3",3,"errors"],[3,"value"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2),m(3),n(),o(4,"button",3),h("click",function(){return i.closeDialog()}),d(5,"i",4),n()(),p(6,_o,1,1,"my-global-errors",5),o(7,"div",6)(8,"form",7),d(9,"input",8),o(10,"div",9)(11,"my-form-field")(12,"my-label"),m(13,"Code"),n(),d(14,"input",10,11),n(),o(16,"my-form-field")(17,"my-label",12),m(18,"Date"),n(),d(19,"input",13),p(20,yo,2,0,"my-error",14),n()(),o(21,"div",9)(22,"my-form-field")(23,"my-label",12),m(24,"Source (Cr\xE9dit)"),n(),o(25,"select",15),p(26,Co,3,2,"ng-container",16),n(),p(27,xo,2,0,"my-error",14),n(),o(28,"div",17),d(29,"i",18),n(),o(30,"my-form-field")(31,"my-label",12),m(32,"Source (D\xE9bit)"),n(),o(33,"select",19),p(34,So,3,2,"ng-container",16),n(),p(35,bo,2,0,"my-error",14),n()(),o(36,"div",9)(37,"my-form-field")(38,"my-label",12),m(39,"Solde actuel (Cr\xE9dit)"),n(),d(40,"input",20),p(41,vo,2,0,"my-error",14),n(),o(42,"div",17),d(43,"i",18),n(),o(44,"my-form-field")(45,"my-label",12),m(46,"Montant"),n(),d(47,"input",21),p(48,Fo,2,0,"my-error",14),n(),o(49,"div",17),d(50,"i",18),n(),o(51,"my-form-field")(52,"my-label",12),m(53,"Solde actuel (D\xE9bit)"),n(),d(54,"input",22),p(55,Eo,2,0,"my-error",14),n()(),o(56,"div",9)(57,"my-form-field")(58,"my-label",12),m(59,"Nouveau solde (Cr\xE9dit)"),n(),d(60,"input",23),p(61,wo,2,0,"my-error",14),n(),o(62,"my-form-field")(63,"my-label",12),m(64,"Nouveau solde (D\xE9bit)"),n(),d(65,"input",24),p(66,ko,2,0,"my-error",14),n()(),o(67,"my-form-field")(68,"my-label"),m(69,"Notes"),n(),d(70,"textarea",25),n()()(),o(71,"div",26)(72,"button",27),h("click",function(){return i.create()}),m(73,"Nouveau "),n(),o(74,"button",28),h("click",function(){return i.save()}),m(75,"Sauvegarder"),n()()()),r&2){let s,_,b,I,Y,ee,te,ie;c(3),M(" ",i.data.mode=="creation"?"Nouveau":"Modifier"," transfer "),c(3),u("ngIf",i.errors.length>0),c(2),u("formGroup",i.transferFormGroup),c(9),u("required",!0),c(3),u("ngIf",((s=i.transferFormGroup.get("date"))==null?null:s.invalid)&&(((s=i.transferFormGroup.get("date"))==null?null:s.dirty)||((s=i.transferFormGroup.get("date"))==null?null:s.touched))&&((s=i.transferFormGroup.get("date"))==null?null:s.getError("required"))),c(3),u("required",!0),c(3),u("ngForOf",i.sources),c(),u("ngIf",((_=i.transferFormGroup.get("fromMoneySourceId"))==null?null:_.invalid)&&(((_=i.transferFormGroup.get("fromMoneySourceId"))==null?null:_.dirty)||((_=i.transferFormGroup.get("fromMoneySourceId"))==null?null:_.touched))&&((_=i.transferFormGroup.get("fromMoneySourceId"))==null?null:_.getError("required"))),c(4),u("required",!0),c(3),u("ngForOf",i.sources),c(),u("ngIf",((b=i.transferFormGroup.get("toMoneySourceId"))==null?null:b.invalid)&&(((b=i.transferFormGroup.get("toMoneySourceId"))==null?null:b.dirty)||((b=i.transferFormGroup.get("toMoneySourceId"))==null?null:b.touched))&&((b=i.transferFormGroup.get("toMoneySourceId"))==null?null:b.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((I=i.transferFormGroup.get("oldFromMoneySourceAmount"))==null?null:I.invalid)&&(((I=i.transferFormGroup.get("oldFromMoneySourceAmount"))==null?null:I.dirty)||((I=i.transferFormGroup.get("oldFromMoneySourceAmount"))==null?null:I.touched))&&((I=i.transferFormGroup.get("oldFromMoneySourceAmount"))==null?null:I.getError("required"))),c(4),u("required",!0),c(3),u("ngIf",((Y=i.transferFormGroup.get("amount"))==null?null:Y.invalid)&&(((Y=i.transferFormGroup.get("amount"))==null?null:Y.dirty)||((Y=i.transferFormGroup.get("amount"))==null?null:Y.touched))&&((Y=i.transferFormGroup.get("amount"))==null?null:Y.getError("required"))),c(4),u("required",!0),c(3),u("ngIf",((ee=i.transferFormGroup.get("oldToMoneySourceAmount"))==null?null:ee.invalid)&&(((ee=i.transferFormGroup.get("oldToMoneySourceAmount"))==null?null:ee.dirty)||((ee=i.transferFormGroup.get("oldToMoneySourceAmount"))==null?null:ee.touched))&&((ee=i.transferFormGroup.get("oldToMoneySourceAmount"))==null?null:ee.getError("required"))),c(3),u("required",!0),c(3),u("ngIf",((te=i.transferFormGroup.get("newFromMoneySourceAmount"))==null?null:te.invalid)&&(((te=i.transferFormGroup.get("newFromMoneySourceAmount"))==null?null:te.dirty)||((te=i.transferFormGroup.get("newFromMoneySourceAmount"))==null?null:te.touched))&&((te=i.transferFormGroup.get("newFromMoneySourceAmount"))==null?null:te.getError("required"))),c(2),u("required",!0),c(3),u("ngIf",((ie=i.transferFormGroup.get("newToMoneySourceAmount"))==null?null:ie.invalid)&&(((ie=i.transferFormGroup.get("newToMoneySourceAmount"))==null?null:ie.dirty)||((ie=i.transferFormGroup.get("newToMoneySourceAmount"))==null?null:ie.touched))&&((ie=i.transferFormGroup.get("newToMoneySourceAmount"))==null?null:ie.getError("required")))}},dependencies:[Ze,V,R,_e,ye,W,he,ge,L,O,q,H,A,$,xe,P,Q,Z,Se,Tt],styles:[`app-money-source-transfer-form{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var Go=["firstFocused"];function Io(t,l){if(t&1&&(y(0),o(1,"option",47),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function Mo(t,l){if(t&1&&(y(0),o(1,"option",47),m(2),n(),C()),t&2){let a=l.$implicit;c(),u("value",a.id),c(),v(a.label)}}function To(t,l){if(t&1){let a=F();o(0,"div",33)(1,"div",34)(2,"span"),m(3,"Filtrer"),n(),o(4,"button",35),h("click",function(){x(a);let r=f();return S(r.toggleFilterMenu())}),d(5,"i",36),n()(),o(6,"form",37)(7,"div",38)(8,"my-form-field")(9,"my-label",39),m(10,"Source (Cr\xE9dit)"),n(),o(11,"select",40),p(12,Io,3,2,"ng-container",41),n()(),o(13,"div",42),d(14,"i",43),n(),o(15,"my-form-field")(16,"my-label",39),m(17,"Source (D\xE9bit)"),n(),o(18,"select",44),p(19,Mo,3,2,"ng-container",41),n()()()(),o(20,"div",45)(21,"button",46),h("click",function(){x(a);let r=f();return S(r.resetItemsFilterForm())}),m(22,"R\xE9initialiser"),n(),o(23,"button",11),h("click",function(){x(a);let r=f();return S(r.filterItems())}),m(24,"Appliquer"),n()()()}if(t&2){let a=f();c(6),u("formGroup",a.transferFilterFormGroup),c(3),u("required",!0),c(3),u("ngForOf",a.sources),c(4),u("required",!0),c(3),u("ngForOf",a.sources)}}function No(t,l){if(t&1){let a=F();o(0,"button",48),h("click",function(){x(a);let r=f();return S(r.deleteSeleted())}),o(1,"div",49),d(2,"i",50),o(3,"span"),m(4),n()()()}if(t&2){let a=f();c(4),M("Supprimer (",a.selection.selected.length,")")}}function Do(t,l){if(t&1){let a=F();o(0,"th",51)(1,"mat-checkbox",52),h("change",function(r){x(a);let i=f();return S(i.allSelectionChanged(r))}),n()()}if(t&2){let a=f();c(),u("checked",a.selection.hasValue()&&a.isAllSelected())("indeterminate",a.selection.hasValue()&&!a.isAllSelected())("aria-label",a.checkboxLabel())}}function Vo(t,l){if(t&1){let a=F();o(0,"td",53)(1,"mat-checkbox",54),h("click",function(r){return r.stopPropagation()})("change",function(r){let s=x(a).$implicit,_=f();return S(_.selectionChanged(r,s))}),n()()}if(t&2){let a=l.$implicit,e=f();c(),u("checked",e.selection.isSelected(a))("aria-label",e.checkboxLabel(a))}}function Ao(t,l){t&1&&(o(0,"th",51),m(1,"Code "),n())}function Lo(t,l){if(t&1&&(o(0,"td",53),m(1),n()),t&2){let a=l.$implicit;c(),v(a.code)}}function Oo(t,l){t&1&&(o(0,"th",51),m(1,"Transfert"),n())}function Ro(t,l){if(t&1&&(o(0,"td",53)(1,"div",55),m(2),d(3,"i",56),m(4),n()()),t&2){let a=l.$implicit;c(2),M(" ",a.fromMoneySourceId.label," "),c(2),M(" ",a.toMoneySourceId.label," ")}}function qo(t,l){t&1&&(o(0,"th",51),m(1,"Montant"),n())}function Ho(t,l){if(t&1&&(o(0,"td",53),m(1),n()),t&2){let a=l.$implicit;c(),v(a.amount)}}function Bo(t,l){t&1&&(o(0,"th",51),m(1,"Source (Cr\xE9dit) "),n())}function zo(t,l){if(t&1&&(o(0,"td",53)(1,"div",55),m(2),d(3,"i",56),m(4),n()()),t&2){let a=l.$implicit;c(2),M(" ",a.oldFromMoneySourceAmount," "),c(2),M(" ",a.newFromMoneySourceAmount," ")}}function Po(t,l){t&1&&(o(0,"th",51),m(1,"Source (D\xE9bit)"),n())}function Qo(t,l){if(t&1&&(o(0,"td",53)(1,"div",55),m(2),d(3,"i",56),m(4),n()()),t&2){let a=l.$implicit;c(2),M(" ",a.oldToMoneySourceAmount," "),c(2),M(" ",a.newToMoneySourceAmount," ")}}function $o(t,l){t&1&&(o(0,"th",51),m(1,"Date "),n())}function jo(t,l){if(t&1&&(o(0,"td",53),m(1),We(2,"date"),n()),t&2){let a=l.$implicit;c(),v(Xe(2,1,a.date,"dd/MM/yyyy"))}}function Uo(t,l){t&1&&(o(0,"th",51),m(1,"Notes"),n())}function Wo(t,l){if(t&1&&(o(0,"td",53),m(1),n()),t&2){let a=l.$implicit;c(),v(a.notes)}}function Zo(t,l){t&1&&(o(0,"th",57),m(1,"Action"),n())}function Jo(t,l){if(t&1&&(o(0,"td",53)(1,"div",58)(2,"button",59),d(3,"i",60),n()()()),t&2){let a=l.$implicit,e=f();c(2),u("matTooltip",e.getTracabilityInfo(a))}}function Ko(t,l){t&1&&d(0,"tr",61)}function Xo(t,l){t&1&&d(0,"tr",62)}function Yo(t,l){t&1&&(o(0,"div",63)(1,"p",64),m(2,"Aucune donn\xE9e \xE0 afficher"),n()())}var Ut=(()=>{let l=class l{isAllSelected(){let e=this.selection.selected.length,r=this.dataSource.data.length;return e===r}toggleAllRows(){if(this.isAllSelected()){this.selection.clear();return}this.selection.select(...this.dataSource.data)}checkboxLabel(e){return e?`${this.selection.isSelected(e)?"deselect":"select"} row ${e.position+1}`:`${this.isAllSelected()?"deselect":"select"} all`}constructor(e,r,i,s,_,b){this.snackBar=e,this.fb=r,this.matDialog=i,this.traceability=s,this.sourcesHttp=_,this.moneySourceTransfersHttp=b,this.dataSource=new Re([]),this.displayedColumns=["select","code","transfer","amount","fromMoneySourceAmount","toMoneySourceAmount","date","actions"],this.resultsLength=0,this.isLoadingResults=!0,this.isRateLimitReached=!1,this.isFilterMenuOpen=!1,this.refreshGrid=new K,this.stockFilterChanged=new K,this.pageSize=X.pagination.pageSize,this.selection=new de(!0,[]),this.showFirstLastButtons=X.pagination.showFirstLastButtons,this.sources=[],this.transferFilterFormGroup=this.fb.group({fromMoneySourceId:[void 0],toMoneySourceId:[void 0]})}ngOnInit(){this.sourcesHttp.getAll().subscribe({next:e=>this.sources=e})}ngAfterViewInit(){this.sort.sortChange.subscribe({next:()=>this.paginator.pageIndex=0}),le(this.sort.sortChange,this.paginator.page,this.refreshGrid,this.stockFilterChanged).pipe(se({}),me(()=>(this.isLoadingResults=!0,this.moneySourceTransfersHttp.paginate(this.getFilterQuery).pipe(ae(()=>ne(null))))),oe(e=>(this.isLoadingResults=!1,this.isRateLimitReached=e?.data===null,ve(e)?[]:(this.resultsLength=e?.count,e?.items)))).subscribe({next:e=>this.dataSource.data=e})}newItem(e="creation",r=0){this.matDialog.open(jt,{data:{id:r,mode:e},disableClose:!0,autoFocus:!1}).afterClosed().subscribe({next:i=>this.refreshGrid.emit()})}deleteItem(e){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany([e])}deleteSeleted(){confirm("Etes-vous s\xFBr de ce que vous faites ?")&&this.deleteMany(this.selection.selected)}filterItems(){this.stockFilterChanged.emit()}resetItemsFilterForm(){this.transferFilterFormGroup.reset({fromMoneySourceId:void 0,toMoneySourceId:void 0}),this.stockFilterChanged.emit()}toggleFilterMenu(){this.isFilterMenuOpen=!this.isFilterMenuOpen,this.isFilterMenuOpen&&setTimeout(()=>{this.firstFocused?.nativeElement.focus()},200)}allSelectionChanged(e){e&&this.toggleAllRows()}selectionChanged(e,r){e&&this.selection.toggle(r)}deleteMany(e){let r=new URLSearchParams;e.forEach(s=>{r.append("id",s.id.toString())});let i=`?${r.toString()}`;this.moneySourceTransfersHttp.deleteMany(i).subscribe({next:s=>{s.success&&(this.snackBar.open("Op\xE9ration r\xE9ussie","\u2714",{duration:7e3}),this.refreshGrid.emit(),this.selection.clear())},error:s=>this.snackBar.open(s.message)})}get getFilterQuery(){let e=new URLSearchParams,r={pageIndex:this.paginator.pageIndex,pageSize:this.pageSize,fromMoneySourceId:this.transferFilterFormGroup.get("fromMoneySourceId")?.value,toMoneySourceId:this.transferFilterFormGroup.get("toMoneySourceId")?.value};return N(r.pageIndex)&&e.append("pageIndex",r.pageIndex.toString()),N(r.pageSize)&&e.append("pageSize",r.pageSize.toString()),e.append("order","DESC"),N(r.fromMoneySourceId)&&e.append("fromMoneySourceId",r.fromMoneySourceId),N(r.toMoneySourceId)&&e.append("toMoneySourceId",r.toMoneySourceId),`?${e.toString()}`}getTracabilityInfo(e){return this.traceability.info(e)}};l.\u0275fac=function(r){return new(r||l)(g(j),g(B),g(we),g(be),g(dt),g(It))},l.\u0275cmp=D({type:l,selectors:[["app-money-source-transfers-grid"]],viewQuery:function(r,i){if(r&1&&(w(z,5),w(U,5),w(Go,5)),r&2){let s;k(s=G())&&(i.paginator=s.first),k(s=G())&&(i.sort=s.first),k(s=G())&&(i.firstFocused=s.first)}},decls:54,vars:12,consts:[[1,"flex","flex-1","flex-col","p-3","bg-secondary-50","gap-y-2"],[1,"flex","flex-col"],[1,"flex","flex-row","justify-between","items-center"],[1,"relative"],["mat-button","","cdkOverlayOrigin","",3,"click"],["trigger","cdkOverlayOrigin"],[1,"space-x-2"],[1,"ri-equalizer-line","text-lg"],["cdkConnectedOverlay","",3,"cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","backdropClick"],[1,"flex","flex-row","items-center","gap-x-3"],["mat-stroked-button","","color","warn","class","!border-red-700 !border",3,"click",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"!flex","!flex-row","!items-center","!space-x-2"],[1,"ri-add-line","text-lg"],[1,"text-white"],[1,"relative","flex-1","overflow-auto","!h-[calc(100vh-185px)]","bg-white","rounded","shadow"],["mat-table","","matSort","","matSortActive","createdAt","matSortDisableClear","","matSortDirection","desc",1,"w-full",3,"dataSource"],["matColumnDef","select"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","code"],["matColumnDef","transfer"],["matColumnDef","amount"],["matColumnDef","fromMoneySourceAmount"],["matColumnDef","toMoneySourceAmount"],["matColumnDef","date"],["matColumnDef","notes"],["matColumnDef","actions"],["mat-header-cell","","class","!text-center w-20 ",4,"matHeaderCellDef"],["mat-header-row","","class","!bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:!bg-slate-50 cursor-pointer",4,"matRowDef","matRowDefColumns"],["class","flex flex-row items-center space-x-1 p-4",4,"ngIf"],["aria-label","S\xE9lectionnez la page des r\xE9sultats de recherche d'apc kouba",1,"!flex","!justify-start","!bg-transparent",3,"showFirstLastButtons","length","pageSize"],[1,"flex","flex-col","min-w-[500px]","max-h-[80vh]","overflow-auto","bg-white","shadow-lg","border","border-gray-200","rounded-sm"],[1,"flex","flex-row","items-center","justify-between","px-4","py-2","bg-slate-100"],[3,"click"],[1,"ri-close-line"],[1,"flex","flex-col","!text-sm","gap-y-2","p-5",3,"formGroup"],[1,"inline-fields"],[3,"required"],["formControlName","fromMoneySourceId","myInput",""],[4,"ngFor","ngForOf"],[1,"mt-9"],[1,"ri-arrow-right-line","text-xl","text-primary","font-medium"],["formControlName","toMoneySourceId","myInput",""],[1,"flex","flex-row","justify-between","p-6"],["mat-stroked-button","","color","secondary",3,"click"],[3,"value"],["mat-stroked-button","","color","warn",1,"!border-red-700","!border",3,"click"],[1,"flex","flex-row","items-center","gap-x-2"],[1,"ri-delete-bin-6-line","text-lg"],["mat-header-cell",""],["color","primary",3,"checked","indeterminate","aria-label","change"],["mat-cell",""],["color","primary",3,"checked","aria-label","click","change"],[1,"font-medium"],[1,"ri-arrow-right-line","text-sm","text-primary","font-medium"],["mat-header-cell","",1,"!text-center","w-20"],[1,"flex","flex-row","items-center","space-x-2"],["mat-icon-button","",3,"matTooltip"],[1,"ri-information-line"],["mat-header-row","",1,"!bg-gray-50"],["mat-row","",1,"hover:!bg-slate-50","cursor-pointer"],[1,"flex","flex-row","items-center","space-x-1","p-4"],[1,"text-sm","font-light","text-black"]],template:function(r,i){if(r&1&&(o(0,"div",0)(1,"div",1)(2,"h3"),m(3,"Tr\xE9soreries / Transferts d'argent"),n()(),o(4,"div",2)(5,"div",3)(6,"button",4,5),h("click",function(){return i.toggleFilterMenu()}),o(8,"div",6),d(9,"i",7),o(10,"span"),m(11,"FILTRE"),n()()(),p(12,To,25,5,"ng-template",8),h("backdropClick",function(){return i.toggleFilterMenu()}),n(),o(13,"div",9),p(14,No,5,1,"button",10),o(15,"button",11),h("click",function(){return i.newItem()}),o(16,"div",12),d(17,"i",13),o(18,"span",14),m(19,"Transfer"),n()()()()(),o(20,"div")(21,"div",15)(22,"table",16),y(23,17),p(24,Do,2,3,"th",18)(25,Vo,2,2,"td",19),C(),y(26,20),p(27,Ao,2,0,"th",18)(28,Lo,2,1,"td",19),C(),y(29,21),p(30,Oo,2,0,"th",18)(31,Ro,5,2,"td",19),C(),y(32,22),p(33,qo,2,0,"th",18)(34,Ho,2,1,"td",19),C(),y(35,23),p(36,Bo,2,0,"th",18)(37,zo,5,2,"td",19),C(),y(38,24),p(39,Po,2,0,"th",18)(40,Qo,5,2,"td",19),C(),y(41,25),p(42,$o,2,0,"th",18)(43,jo,3,4,"td",19),C(),y(44,26),p(45,Uo,2,0,"th",18)(46,Wo,2,1,"td",19),C(),y(47,27),p(48,Zo,2,0,"th",28)(49,Jo,4,1,"td",19),C(),p(50,Ko,1,0,"tr",29)(51,Xo,1,0,"tr",30),n(),p(52,Yo,3,0,"div",31),n(),d(53,"mat-paginator",32),n()()),r&2){let s=ce(7);c(12),u("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",i.isFilterMenuOpen)("cdkConnectedOverlayHasBackdrop",!0),c(2),u("ngIf",i.selection.selected.length>0),c(8),u("dataSource",i.dataSource),c(28),u("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),c(),u("matRowDefColumns",i.displayedColumns),c(),u("ngIf",i.dataSource.data.length==0),c(),u("showFirstLastButtons",i.showFirstLastButtons)("length",i.resultsLength)("pageSize",i.pageSize)}},dependencies:[Ze,V,R,_e,ye,ge,L,O,q,H,Ce,A,ue,ke,Ge,Me,Ve,Te,Ie,Ae,Ne,De,Le,Oe,z,U,fe,pe,$,P,Q,ct],styles:[`app-money-source-transfers-grid{display:flex;flex:1}
`],encapsulation:2});let t=l;return t})();var el=[{path:"",redirectTo:"money-sources",pathMatch:"full"},{path:"money-sources",component:At},{path:"charges",component:Ot},{path:"charge-natures",component:qt},{path:"losses",component:Pt},{path:"losse-natures",component:$t},{path:"fences",component:Bt},{path:"money-source-transfers",component:Ut}],Yt=(()=>{let l=class l{};l.\u0275fac=function(r){return new(r||l)},l.\u0275mod=Ft({type:l}),l.\u0275inj=vt({imports:[Dt.forChild(el),Dt]});let t=l;return t})();var Hs=(()=>{let l=class l{};l.\u0275fac=function(r){return new(r||l)},l.\u0275mod=Ft({type:l}),l.\u0275inj=vt({imports:[Xt,Yt]});let t=l;return t})();export{Hs as TreasuriesModule};
